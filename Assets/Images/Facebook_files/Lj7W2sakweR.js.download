if (self.CavalryLogger) { CavalryLogger.start_js(["usnc8"]); }

__d("MessageBorderType",[],(function a(b,c,d,e,f,g){f.exports={FLOWERS:"flowers"};}),null);
__d("MessageCustomizationType",[],(function a(b,c,d,e,f,g){f.exports={BORDER:"border"};}),null);
__d("TextWithEntitiesMetadataType",[],(function a(b,c,d,e,f,g){f.exports={NONE:0,CONCEPT:1,INTENT:2};}),null);
__d('isWebGLEnabled',[],(function a(b,c,d,e,f,g){'use strict';var h=null;function i(){try{var l=document.createElement('canvas');return Boolean(window.WebGLRenderingContext)&&Boolean(l.getContext('webgl')||l.getContext('experimental-webgl'));}catch(k){return false;}}function j(){if(h===null)h=i();return h;}f.exports=j;}),null);
__d('P2PTriggersUtils',['P2PGKValues'],(function a(b,c,d,e,f,g){var h=/\$((\d{1,3}(,\d{3})*)|\d+)(\.\d{1,2})?(?=\s|\.\s|\,\s|$|\.$|\,$|\?|\!|\")/,i={canSeeTriggers:function j(k){if(!c('P2PGKValues').P2PEnabled)return false;return true;},getMatches:function j(k){return k.match(h);}};f.exports=i;}),null);
__d('MercuryMessageBody.react',['cx','fbt','BootloadedComponent.react','EmojiRenderer','EmoticonsList','EmoticonEmojiList','EmployeeLinkMatcher','EmployeeLinkRanges','JSResource','Link.react','MercuryConfig','MessengerSupportedEmoji','MessengerTextWithEntities.react','P2PTriggersUtils','React','TextWithEntities.react','TextWithEntitiesMetadataType','URI','URLMatcher','emptyFunction','getURLRanges','ifRequired','shouldAddMRefParam'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PropTypes,m=function o(){m=c('emptyFunction');c('ifRequired')('ChatAppActions',function(p){p.setInitialDisplayDone();});};j=babelHelpers.inherits(n,c('React').PureComponent);k=j&&j.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=k.constructor).call.apply(o,[this].concat(r)),this.targetBlankLinkInterpolator=function(t,u){if(u.className)return c('React').createElement('span',{className:u.className},t);if(u.id){var v={};if(!this.props.isFromViewer&&this.props.threadCustomColor)v.color=this.props.threadCustomColor;return (c('React').createElement(c('Link.react'),{className:"_ih-",href:u.url,style:v},t));}if(u.entity&&u.entity.url){var w=new (c('URI'))(u.entity.url.replace(/#+$/,''));if(c('shouldAddMRefParam')(w))w.addQueryData({__mref:'message_bubble'});return (c('React').createElement(c('Link.react'),{href:{url:w.toString(),shimhash:u.entity.shimhash},s:u.entity.s,target:'_blank'},t));}else if(!u.entity)switch(u.type){case c('TextWithEntitiesMetadataType').NONE:return (c('React').createElement('span',{className:"_2y9",title:JSON.stringify(u.data)},t));default:return t;}return t;}.bind(this),p;}n.prototype.render=function(){var o=this.props,p=o.body,q=o.ranges,r=o.metaRanges;p=p||'';if(p.startsWith('?OTR'))return (c('React').createElement('span',{className:"_89h"},i._("[encrypted message]")));p=p.replace(/\s+$/,'');if(p.length===0)return null;var s=false,t=!!(this.props.threadID&&c('P2PTriggersUtils').canSeeTriggers(this.props.threadID)&&c('P2PTriggersUtils').getMatches(p));if(q&&q.length||r&&r.length||c('EmoticonsList').noncapturingRegexp.test(p)||c('EmojiRenderer').containsEmoji(p)||c('URLMatcher').match(p)||c('EmployeeLinkMatcher').isMatch(p)||t||c('MercuryConfig').MessengerNewEmojiGK&&(c('MessengerSupportedEmoji').findEmoji(p)||c('EmoticonEmojiList').noncapturingRegexp.test(p)))s=true;if(!s){m();return c('React').createElement('span',{className:this.props.className},p);}if(q==undefined)q=c('getURLRanges')(p);if(q==undefined){q=c('EmployeeLinkRanges').get(p);}else{q=q.concat(c('EmployeeLinkRanges').get(p));q=q.filter(function(w){return w!=undefined;});}var u={className:this.props.className,interpolator:this.targetBlankLinkInterpolator,metaRanges:this.props.metaRanges,ranges:q,renderEmoji:true,renderEmoticons:true,text:p},v=c('React').createElement(c('TextWithEntities.react'),u);m();if(t){return (c('React').createElement(c('BootloadedComponent.react'),babelHelpers['extends']({bootloadPlaceholder:v,bootloadLoader:c('JSResource')('TextWithEntitiesAndP2P.react').__setRef('MercuryMessageBody.react')},u,{getMessengerEmote:this.$MercuryMessageBody1,isSupportedEmoji:this.$MercuryMessageBody2,threadID:this.props.threadID})));}else if(c('MercuryConfig').MessengerNewEmojiGK){return (c('React').createElement(c('MessengerTextWithEntities.react'),u));}else return v;};n.prototype.$MercuryMessageBody2=function(o){return !!c('MessengerSupportedEmoji').emoji[o];};n.prototype.$MercuryMessageBody1=function(o){var p=c('EmoticonEmojiList').emote2emojis[o];return c('MessengerSupportedEmoji').emoji[p]?p:null;};n.propTypes={body:l.string,customLike:l.object,isFromViewer:l.bool,metaRanges:l.array,ranges:l.array,threadCustomColor:l.string,threadID:l.string};f.exports=n;}),null);
__d('MessengerWebViewReactionsTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:MessengerWebViewReactionsLoggerConfig',this.$MessengerWebViewReactionsTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:MessengerWebViewReactionsLoggerConfig',this.$MessengerWebViewReactionsTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$MessengerWebViewReactionsTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$MessengerWebViewReactionsTypedLogger1=babelHelpers['extends']({},this.$MessengerWebViewReactionsTypedLogger1,j);return this;};h.prototype.setEmojiGroup=function(j){this.$MessengerWebViewReactionsTypedLogger1.emoji_group=j;return this;};h.prototype.setEmojiGroupCount=function(j){this.$MessengerWebViewReactionsTypedLogger1.emoji_group_count=j;return this;};h.prototype.setEvent=function(j){this.$MessengerWebViewReactionsTypedLogger1.event=j;return this;};h.prototype.setMid=function(j){this.$MessengerWebViewReactionsTypedLogger1.mid=j;return this;};h.prototype.setSenderID=function(j){this.$MessengerWebViewReactionsTypedLogger1.sender_id=j;return this;};h.prototype.setVC=function(j){this.$MessengerWebViewReactionsTypedLogger1.vc=j;return this;};var i={emoji_group:true,emoji_group_count:true,event:true,mid:true,sender_id:true,vc:true};f.exports=h;}),null);
__d('ChatTypingIndicator.react',['cx','fbt','ChatConfig','Image.react','MercuryParticipants','MercuryTypingAnimation.react','ReactComponentWithPureRenderMixin','React'],(function a(b,c,d,e,f,g,h,i){var j=c('React').PropTypes,k=c('ChatConfig').get('chattab_rounded_profile',false),l=c('React').createClass({displayName:'ChatTypingIndicator',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{userID:j.string,showName:j.bool},render:function n(){var o=void 0;if(this.props.userID)o=c('MercuryParticipants').getNow(this.props.userID);if(!o)return null;return (c('React').createElement('div',{className:"_4tdt"},m(o),this._renderBubble()));},getBubble:function n(){return this.refs.bubble;},_renderBubble:function n(){var o=this.props.showName;return (c('React').createElement('div',{className:"_4tdv"},c('React').createElement('div',{className:"_5wd4"+(' '+"_1nc7")+(' '+"_2cnu")+(o?' '+"_5ysy":'')},c('React').createElement('div',{className:"_5wd9"+(' '+"_n4o")},c('React').createElement('div',{className:"_5w1r"+(' '+"_5wdf")+(' '+"_3_om")},c('React').createElement(c('MercuryTypingAnimation.react'),{className:"_5x7x",ref:'bubble'}))))));}});function m(n){var o=i._("{name}",[i.param('name',n.name)]);return (c('React').createElement('div',{className:"_31o4"+(k?' '+"_3njy":'')},c('React').createElement('a',{'aria-label':o,className:"_4tdw",'data-hover':'tooltip','data-tooltip-content':o,'data-tooltip-position':'left',href:n.href||'#',ref:'link'},c('React').createElement(c('Image.react'),{src:n.image_src,ref:'image'}))));}f.exports=l;}),null);
__d('ChatTypingIndicators.react',['fbt','ChatTypingIndicator.react','DOM','MercuryIDs','MercuryThreadInformer','MercuryThreads','MercuryTypingReceiver','MercuryParticipants','React','ReactDOM','SubscriptionsHandler','TooltipData','createObjectFrom','emptyFunction'],(function a(b,c,d,e,f,g,h){var i=c('MercuryThreads').get(),j=c('React').PropTypes,k=c('React').createClass({displayName:'ChatTypingIndicators',propTypes:{indicatorClass:j.func,indicatorsWillShow:j.func,indicatorsDidShow:j.func,rootClassName:j.string,threadID:j.string.isRequired,viewer:j.string.isRequired},getDefaultProps:function l(){return {indicatorClass:c('ChatTypingIndicator.react'),indicatorsWillShow:c('emptyFunction'),indicatorsDidShow:c('emptyFunction')};},getInitialState:function l(){return {typingUserIDs:[]};},componentDidMount:function l(){var m=c('MercuryThreadInformer').getForFBID(this.props.viewer),n=c('MercuryTypingReceiver').getForFBID(this.props.viewer);this._subscriptions=new (c('SubscriptionsHandler'))();this._subscriptions.addSubscriptions(n.addRetroactiveListener('state-changed',this.typingStateChanged),m.subscribe('messages-received',this.messagesReceived));},componentWillReceiveProps:function l(m){if(m.threadID!=this.props.threadID)this.setState({typingUserIDs:[]});},componentWillUpdate:function l(m,n){if(n.typingUserIDs.length>0)this.props.indicatorsWillShow();},componentDidUpdate:function l(){if(this.state.typingUserIDs.length>0)this.props.indicatorsDidShow();c('MercuryParticipants').getMulti(this.state.typingUserIDs,function(m){if(this.isMounted())this.state.typingUserIDs.forEach(function(n){var o=m[n],p=this.refs[n]&&this.refs[n].getBubble();if(p&&o)c('TooltipData').set(c('ReactDOM').findDOMNode(p),this.renderTooltip(o.short_name),'above','left');}.bind(this));}.bind(this));},componentWillUnmount:function l(){this._subscriptions.release();},render:function l(){if(!c('MercuryIDs').isValid(this.props.threadID))return null;var m=i.getThreadMetaNow(this.props.threadID);if(m&&!m.is_subscribed)return null;var n=c('MercuryIDs').isGroupChat(this.props.threadID);return (c('React').createElement('div',{className:this.props.rootClassName},this.state.typingUserIDs.map(function(o){return (this._renderTypingIndicator(o,!!n));}.bind(this))));},_renderTypingIndicator:function l(m,n){var o=this.props.indicatorClass;return (c('React').createElement(o,{key:m,ref:m,showName:n,userID:m}));},renderTooltip:function l(m){var n=c('DOM').create('span');c('ReactDOM').render(c('React').createElement('span',null,h._("{name} is typing...",[h.param('name',m)])),n);return n;},typingStateChanged:function l(m){if(this.props.threadID in m)this.setState({typingUserIDs:m[this.props.threadID].slice().sort()});},messagesReceived:function l(m,n){if(this.props.threadID in n){var o=n[this.props.threadID],p=c('createObjectFrom')(o.map(function(q){return q.author;}));this.setState({typingUserIDs:this.state.typingUserIDs.filter(function(q){return !p[q];}).sort()});}}});f.exports=k;}),null);
__d('MessengerReactionsUtil',['EmojiFormat'],(function a(b,c,d,e,f,g){'use strict';var h=[[128525],[128518],[128558],[128546],[128544],[128077],[128078]],i={};h.forEach(function(j,k){i[c('EmojiFormat').codeArrayToUnicode(j)]=k+1;});f.exports={sortFunction:function j(k,l){if(!i[k]&&!i[l]){return 0;}else if(!i[k]){return 1;}else if(!i[l])return -1;return i[k]-i[l];}};}),null);
__d('MessengerReactions.react',['cx','Bootloader','MercuryConfig','MessengerEnvironment','MessengerReactionsUtil','MessengerTextWithEmoticons.react','MessengerWebViewReactionsTypedLogger','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes,l='ALL';i=babelHelpers.inherits(m,c('React').Component);j=i&&i.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=j.constructor).call.apply(n,[this].concat(q)),this.$MessengerReactions1=function(){var s=c('MessengerEnvironment').messengerui,t=this.props,u=t.isFromViewer,v=t.message,w=t.participants,x=v.reactions;new (c('MessengerWebViewReactionsTypedLogger'))().setEvent('open_details').setMid(v.message_id).setSenderID(v.author).setEmojiGroup(l).setEmojiGroupCount(Object.values(x).length).log();if(s){c('Bootloader').loadModules(["MessengerActions","MessengerReactionsDialog.react"],function(y,z){y.showDialog(z,{isFromViewer:u,participants:w,message:v});},'MessengerReactions.react');}else c('Bootloader').loadModules(["ChatReactionsDialog"],function(y){y.show(v,w,u);},'MessengerReactions.react');}.bind(this),o;}m.prototype.render=function(){var n=this.props.message,o=n.reactions;if(!o)return null;var p={},q=0;Object.values(o).forEach(function(t){if(typeof t==='string'){if(!p[t])p[t]=0;p[t]++;q++;}});var r=Object.keys(p).sort(c('MessengerReactionsUtil').sortFunction).map(function(t){return c('React').createElement('span',{className:"_4kf5 _3-99",key:t},c('React').createElement(c('MessengerTextWithEmoticons.react'),{renderEmoticons:true,renderEmoji:true,text:t}));}),s=q>0?c('React').createElement('span',{className:"_4kf6 _3-99"},q):null;if(c('MercuryConfig').ReactionsPreview){return c('React').createElement('div',{className:"_4kf7 _3-95 preview",onClick:this.$MessengerReactions1,role:'button',tabIndex:'0'},r,s);}else return c('React').createElement('div',{className:"_4kf7 _3-95"},r,s);};m.propTypes={isFromViewer:k.bool.isRequired,message:k.object.isRequired,participants:k.object.isRequired};f.exports=m;}),null);
__d('MessengerDecorator',['cssVar','cx','BootloadedComponent.react','JSResource','MercuryConfig','MercuryMessageActions','MercuryMessageCustomizations','MercuryTagHelper','MessageBorderType','MessageCustomizationType','MessagingFlowerBorder.react','MessagingGiftWrap.react','MessagingGiftWrapConstants','MessengerEnvironment','MessengerReactions.react','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=[{name:'GiftWrap',check:function n(o){var p=function r(s){return c('MercuryTagHelper').get(s,c('MessagingGiftWrapConstants').TAG_PREFIX)===c('MessagingGiftWrapConstants').VALENTINES_GIFT;},q=function r(s){return !!c('MercuryTagHelper').get(s,c('MessagingGiftWrapConstants').UNWRAPPED_TAG);};return !!(c('MercuryConfig').GiftWrapViewerGK&&o.tags&&p(o.tags)&&!q(o.tags));},render:function n(o,p){return (c('React').createElement(c('MessagingGiftWrap.react'),{key:'giftwrap',onUnwrap:function q(){var r="2500ms",s=parseInt(r.substring(0,r.length-2),10);setTimeout(function(){return c('MercuryMessageActions').get().unwrap(o);},s);}}));},getAdditionalClassNames:function n(){return null;}},{name:'FlowerBorder',check:function n(o){return (c('MercuryConfig').WWWMessengerFlowerBorderViewer&&c('MercuryMessageCustomizations').getCustomizationValue(o,c('MessageCustomizationType').BORDER)===c('MessageBorderType').FLOWERS);},render:function n(o,p){if(c('MessengerEnvironment').messengerui)return c('React').createElement(c('MessagingFlowerBorder.react'),{offset:-10,key:'giftwrap:'+o.message_id});return c('React').createElement(c('MessagingFlowerBorder.react'),{key:'giftwrap:'+o.message_id});},getAdditionalClassNames:function n(){if(!c('MessengerEnvironment').messengerui)return "_337n";return null;}}],k=[{name:'Reactions',check:function n(o){return !!(c('MercuryConfig').Reactions&&o.reactions&&Object.keys(o.reactions).length>0);},render:function n(o,p,q){return (c('React').createElement(c('MessengerReactions.react'),{isFromViewer:p,key:o.message_id+'-reactions',message:o,participants:q}));},getAdditionalClassNames:function n(){return null;}}],l=[{name:'MontageReply',check:function n(o){if(!c('MercuryConfig').MontageThreadViewer)return false;var p=o.montage_reply_data&&o.montage_reply_data.message_id;return !!p;},render:function n(o,p){var q=o.montage_reply_data&&o.montage_reply_data.message_id;return c('React').createElement(c('BootloadedComponent.react'),{key:'montagereply:'+o.message_id,bootloadPlaceholder:c('React').createElement('div',null),bootloadLoader:c('JSResource')('MontageReplyDecoratorContainer.react').__setRef('MessengerDecorator'),isFromViewer:p,messageID:q,replyAuthorID:o.author,threadID:o.thread_id});},getAdditionalClassNames:function n(){return null;}}],m={getBeforeDecorators:function n(){return l;},getAfterDecorators:function n(){return j;},getAfterExternalDecorators:function n(){return k;}};f.exports=m;}),null);
__d('MessengerContextualDialog.react',['cx','AccessibleLayer','ContextualLayerAutoFlipHorizontal','LayerHideOnEscape','ReactAbstractContextualDialog','ReactLayer'],(function a(b,c,d,e,f,g,h){'use strict';var i=12,j=c('ReactLayer').createClass(c('ReactAbstractContextualDialog').createSpec({addedBehaviors:[c('ContextualLayerAutoFlipHorizontal'),c('LayerHideOnEscape'),c('AccessibleLayer')],displayName:'MessengerContextualDialog',shouldSetARIAProperties:false,theme:{wrapperClassName:"_1r_9",arrowDimensions:{offset:i,length:16}}}));f.exports=j;}),null);
__d('MessengerHotLikeOutlineSVG.react',['cssVar','fbt','React','MercuryShareAttachmentRenderLocations','WorkGKs','uniqueID','UserAgent'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PropTypes,m='transparent',n=i._("Thumbs Up Sign");j=babelHelpers.inherits(o,c('React').Component);k=j&&j.prototype;function o(){var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=k.constructor).call.apply(p,[this].concat(s)),this.state={titleId:c('uniqueID')()},q;}o.prototype.render=function(){var p=this.props.color||(c('WorkGKs').workplace_www_chat_branding?"#1479fb":"#0084ff"),q=c('UserAgent').isBrowser('Safari')?'0 0 40.16 42.24':'-1 -1 40.16 42.24',r={height:this.props.height||'85%'};if(this.props.location!==c('MercuryShareAttachmentRenderLocations').CHAT&&this.props.location!==c('MercuryShareAttachmentRenderLocations').PAGES_INBOX)r.width='66%';return (c('React').createElement('svg',{'aria-labelledby':this.state.titleId,version:'1.1',viewBox:q,preserveAspectRatio:'xMinYMax meet',style:r},c('React').createElement('title',{id:this.state.titleId},n),c('React').createElement('path',{d:'M935.36,1582.44a0,0,0,0,0,0,.06,3.59,3.59,0,0,1-.72,6.53,0,0,0,0,0,0,0,3.56,3.56,0,0,1,.71,2.13,3.6,3.6,0,0,1-3,3.54, 0,0,0,0,0,0,.05,3.56,3.56,0,0,1,.38,1.61,3.61,3.61,0,0,1-3.42,3.6H910v-19.6l5.27-7.9a4,4,0,0,0,.66-2.31l-0.1-4c-0.22-2.4-.09-2.06, 1.13-2.37,2-.51,7.16,1.59,5.13,12.17h11.06A3.59,3.59,0,0,1,935.36,1582.44ZM899,1581h7v22h-7v-22Z',transform:'translate(-898.5 -1563.26)',fill:m,fillRule:'evenodd',stroke:p,strokeLinecap:'round',strokeWidth:'5%'})));};o.propTypes={color:l.string,height:l.string,location:l.string};f.exports=o;}),null);
__d('MessengerHotLikeButton.react',['cx','fbt','EmojiLikeConstants','EmojiLikeCxData','Image.react','ImmutableObject','Keys','KeyStatus','Link.react','MercuryConfig','MercuryMessageObject','MercuryTriodeSourceUtil','MessengerEnvironment','MessengerHotLikePreviewEvents','MessengerHotLikeOutlineSVG.react','MessengerHotLikeUtils','React','StickerConstants','clearTimeout','ifRequired','joinClasses','setIntervalAcrossTransitions','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('MercuryMessageObject').get(),m=c('React').PropTypes;j=babelHelpers.inherits(n,c('React').PureComponent);k=j&&j.prototype;function n(){var o,p;for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=k.constructor).call.apply(o,[this].concat(r)),this.$MessengerHotLikeButton1=null,this.$MessengerHotLikeButton2=null,this.$MessengerHotLikeButton3=null,this.$MessengerHotLikeButton4=null,this.$MessengerHotLikeButton6=function(t){if(this.props.disabled||this.$MessengerHotLikeButton3){t.preventDefault();t.stopPropagation();}if(this.props.disabled||t.button!==0)return;this.props.onMouseDown&&this.props.onMouseDown();this.$MessengerHotLikeButton3=Date.now();this.$MessengerHotLikeButton9();this.$MessengerHotLikeButton10();}.bind(this),this.$MessengerHotLikeButton8=function(){if(!(this.props.threadID&&this.$MessengerHotLikeButton3))return;this.$MessengerHotLikeButton3=0;this.$MessengerHotLikeButton11();this.$MessengerHotLikeButton12();}.bind(this),this.$MessengerHotLikeButton14=function(){if(!this.props.threadID)return;c('MessengerHotLikePreviewEvents').emit(c('MessengerHotLikePreviewEvents').POP,this.props.threadID);}.bind(this),this.$MessengerHotLikeButton7=function(){if(this.$MessengerHotLikeButton3){this.$MessengerHotLikeButton3=0;this.$MessengerHotLikeButton11();this.$MessengerHotLikeButton14();}}.bind(this),this.$MessengerHotLikeButton5=function(t){t.stopPropagation();if(this.props.disabled)return;if(c('KeyStatus').getKeyDownCode()===c('Keys').RETURN||!this.props.threadID){var u=this.props.sendCustomLike;if(this.props.customLike&&u){u(this.props.customLike,c('MessengerHotLikeUtils').getEmojiSizeForTime(1));}else this.props.sendSticker(c('MessengerHotLikeUtils').getStickerIDForTime(1));}}.bind(this),p;}n.prototype.componentDidMount=function(){this.$MessengerHotLikeButton4=c('MessengerHotLikePreviewEvents').addListener(c('MessengerHotLikePreviewEvents').FINISH_ANIMATION,function(o,p,q){if(o===this.props.threadID)if(q&&this.props.customLike&&this.props.sendCustomLike){this.props.sendCustomLike(this.props.customLike,q,c('EmojiLikeConstants').source.HOT_LIKE);}else this.props.sendSticker(p);}.bind(this));};n.prototype.componentWillUnmount=function(){this.$MessengerHotLikeButton4&&this.$MessengerHotLikeButton4.remove();};n.prototype.render=function(){var o=null,p={};if(this.props.customLike&&this.props.customLike.emoji){if(c('MercuryConfig').MessengerNewEmojiGK){var q=this.props.customLike.emoji,r=c('EmojiLikeCxData').getNewEmojiData(q,c('EmojiLikeConstants').size.SMALL),s=this.props.renderSize?this.props.renderSize:16;p.background='none';o=c('React').createElement(c('Image.react'),{src:r.url,style:{padding:s==16?0:3,display:'block',height:s,width:s}});}else{q=this.props.customLike.medium;if(q){p.background='none';o=c('React').createElement(c('Image.react'),{src:q,style:{display:'block',height:16,width:16}});}}}else if(this.props.CustomRenderer){var t=this.props.CustomRenderer;o=c('React').createElement(t,{color:this.props.customColor,location:this.props.location});}else if(this.props.customColor)o=c('React').createElement(c('MessengerHotLikeOutlineSVG.react'),{color:this.props.customColor,location:this.props.location});var u=i._("Send a Like");return c('React').createElement(c('Link.react'),{'aria-label':u,className:c('joinClasses')(this.props.customColor||this.props.CustomRenderer?"_5j_u":'',this.props.className),disabled:this.props.disabled,href:'#',onClick:this.$MessengerHotLikeButton5,onDragStart:function v(w){return w.preventDefault();},onMouseDown:this.$MessengerHotLikeButton6,onMouseLeave:this.$MessengerHotLikeButton7,onMouseUp:this.$MessengerHotLikeButton8,role:'button',style:p,title:u},o);};n.prototype.$MessengerHotLikeButton9=function(){if(!this.props.threadID)return;c('MessengerHotLikePreviewEvents').emit(c('MessengerHotLikePreviewEvents').START,this.$MessengerHotLikeButton13(),this.props.threadID);};n.prototype.$MessengerHotLikeButton12=function(){if(!this.props.threadID)return;if(c('MessengerEnvironment').messengerui){c('ifRequired')('MessengerHotLikePreview.react',function(){c('MessengerHotLikePreviewEvents').emit(c('MessengerHotLikePreviewEvents').STOP,this.props.threadID);}.bind(this),function(){if(this.$MessengerHotLikeButton1!==null)return;this.$MessengerHotLikeButton1=c('setIntervalAcrossTransitions')(function(){c('ifRequired')('MessengerHotLikePreview.react',function(){if(this.$MessengerHotLikeButton1!==null){clearInterval(this.$MessengerHotLikeButton1);this.$MessengerHotLikeButton1=null;}c('MessengerHotLikePreviewEvents').emit(c('MessengerHotLikePreviewEvents').STOP,this.props.threadID);}.bind(this));}.bind(this),100);}.bind(this));}else c('MessengerHotLikePreviewEvents').emit(c('MessengerHotLikePreviewEvents').STOP,this.props.threadID);};n.prototype.$MessengerHotLikeButton13=function(){var o=this.props.threadID;if(!o)return null;var p=l.constructStickerMessageObject(c('StickerConstants').HOT_LIKE_SMALL_STICKER_ID,c('MercuryTriodeSourceUtil').getMercuryTriodeSource(),o);l.normalizeNewMessage(p);p.is_like_preview=true;p.like_preview_since=this.$MessengerHotLikeButton3;p.customLike=this.props.customLike&&this.props.customLike.emoji?this.props.customLike:null;p.body='';return new (c('ImmutableObject'))(p);};n.prototype.$MessengerHotLikeButton10=function(){this.$MessengerHotLikeButton11();this.$MessengerHotLikeButton2=c('setTimeoutAcrossTransitions')(this.$MessengerHotLikeButton14,c('MessengerHotLikeUtils').SizeTimes.large);};n.prototype.$MessengerHotLikeButton11=function(){c('clearTimeout')(this.$MessengerHotLikeButton2);};n.propTypes={CustomRenderer:m.func,onMouseDown:m.func,customLike:m.object,customColor:m.string,location:m.string,sendSticker:m.func.isRequired,sendCustomLike:m.func,threadID:m.string,disabled:m.bool,renderSize:m.number};f.exports=n;}),null);
__d('MessengerVideoAutoplayActions',['immutable','MessengerFluxReduceDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h='messenger_video',i=c('keyMirror')({DESTROY:null,DSTROY_ALL:null,SCROLL:null,UPDATE:null}),j={Types:i,Namespace:h,onScroll:function k(l,m,n,o){c('MessengerFluxReduceDispatcher').dispatch({type:i.SCROLL,namespace:h,threadID:l,messageIDs:m,messageRectMap:n,viewportRect:o});},updateStore:function k(l,m){c('MessengerFluxReduceDispatcher').dispatch({type:i.UPDATE,namespace:h,threadID:l,messageIDs:m});},deleteThread:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:i.DESTROY,namespace:h,threadID:l});},deleteAllThreads:function k(){c('MessengerFluxReduceDispatcher').dispatch({type:i.DESTROY_ALL,namespace:h});}};f.exports=j;}),null);
__d('MessengerVideoAutoplayStore',['FluxReduceStore','immutable','MessengerVideoAutoplayActions','MessengerFluxReduceDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i,j,k,l=c('MessengerVideoAutoplayActions').Types;h=babelHelpers.inherits(m,c('immutable').Record({currentVideoMessageID:null,lastVideoMessageID:null,messageIDs:null,videoVisibilityMap:null}));i=h&&h.prototype;function m(){h.apply(this,arguments);}j=babelHelpers.inherits(n,c('FluxReduceStore'));k=j&&j.prototype;n.prototype.getInitialState=function(){return c('immutable').Map();};n.prototype.reduce=function(o,p){if(p.namespace!==c('MessengerVideoAutoplayActions').Namespace)return o;switch(p.type){case l.SCROLL:if(p.messageIDs)o=this.$MessengerVideoAutoplayStore1(o,p.threadID,p.messageIDs);return this.$MessengerVideoAutoplayStore2(o,p.threadID,p.messageRectMap,p.viewportRect);case l.UPDATE:return this.$MessengerVideoAutoplayStore1(o,p.threadID,p.messageIDs);case l.DESTROY:return this.$MessengerVideoAutoplayStore3(o,p.threadID);case l.DESTROY_ALL:return o.clear();}return o;};n.prototype.$MessengerVideoAutoplayStore1=function(o,p,q){if(!q)return o['delete'](p);return o.set(p,new m({currentVideoMessageID:null,lastVideoMessageID:q.first(),messageIDs:q,videoVisibilityMap:null}));};n.prototype.$MessengerVideoAutoplayStore3=function(o,p){return o['delete'](p);};n.prototype.$MessengerVideoAutoplayStore4=function(o,p,q,r,s){var t=null,u=q.map(function(v){if(t){return [v,false];}else{var w=this.$MessengerVideoAutoplayStore5(v,r,s);if(w)t=v;return [v,w];}}.bind(this)).fromEntrySeq().toOrderedMap();return o.mergeIn([p],{currentVideoMessageID:t,videoVisibilityMap:u});};n.prototype.$MessengerVideoAutoplayStore2=function(o,p,q,r){var s=o.getIn([p,'messageIDs']);if(!s||!q||!r)return o;if(!o.getIn([p,'currentVideoMessageID'])){return this.$MessengerVideoAutoplayStore4(o,p,s,q,r);}else{var t=o.getIn([p,'videoVisibilityMap']),u=o.getIn([p,'lastVideoMessageID']),v=o.getIn([p,'currentVideoMessageID']);if(this.$MessengerVideoAutoplayStore5(u,q,r)){if(t&&t.first())return o;}else if(this.$MessengerVideoAutoplayStore5(v,q,r))return o;o=o.setIn([p,'currentVideoMessageID'],null);return this.$MessengerVideoAutoplayStore4(o,p,s,q,r);}};n.prototype.$MessengerVideoAutoplayStore6=function(o,p){if(!o)return false;return o.top>p.top&&o.bottom<p.bottom;};n.prototype.$MessengerVideoAutoplayStore5=function(o,p,q){var r=p.get(o);return this.$MessengerVideoAutoplayStore6(r,q);};n.prototype.getVideoVisibilityMap=function(o){return this.getState().getIn([o,'videoVisibilityMap']);};n.prototype.getMessageIDs=function(o){return this.getState().getIn([o,'messageIDs']);};n.prototype.isVisible=function(o,p){return !!this.getState().getIn([o,'videoVisibilityMap',p]);};function n(){j.apply(this,arguments);}f.exports=new n(c('MessengerFluxReduceDispatcher'));}),null);
__d("messengerDomIDsRe",["uniqueID"],(function a(b,c,d,e,f,g){'use strict';var h={COMPOSER_INPUT_DESCRIPTION:c("uniqueID")(),CONVERSATION:c("uniqueID")(),MAIN_LABEL:c("uniqueID")(),MUTE_DIALOG_TITLE:c("uniqueID")(),THREAD_INFO_PANEL:c("uniqueID")(),THREAD_TITLE:c("uniqueID")()};g.ids=h;}),null);
__d("XMercuryChatTabPagesGreetingConfigController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/pages\/messaging\/mercury\/greeting\/",{});}),null);
__d('MessengerPageGreetingStore',['AsyncRequest','EventEmitter','Map','XMercuryChatTabPagesGreetingConfigController'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=new (c('Map'))(),k=new (c('Map'))();h=babelHelpers.inherits(l,c('EventEmitter'));i=h&&h.prototype;l.prototype.getOrFetch=function(m){var n=j.get(m);n||this.$MessengerPageGreetingStore1(m);return n;};l.prototype.$MessengerPageGreetingStore1=function(m){if(k.get(m))return;var n=c('XMercuryChatTabPagesGreetingConfigController').getURIBuilder().getURI(),o=new (c('AsyncRequest'))().setAllowCrossPageTransition(true).setURI(n).setData({page_id:m}).setHandler(this.$MessengerPageGreetingStore2.bind(this,m));k.set(m,o);o.send();};l.prototype.$MessengerPageGreetingStore2=function(m,n){j.set(m,{shouldShow:n.payload.shouldShow||false,content:n.payload.content||'',sayHelloMessage:n.payload.sayHelloMessage||''});k['delete'](m);this.emit('change');};function l(){h.apply(this,arguments);}f.exports=new l();}),null);
__d('EmojiOnlyMessage.react',['cx','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;l.prototype.render=function(){var m=this.props.sourceURIs,n=0,o=m.map(function(p){n++;if(p.emoji){return c('React').createElement('span',{key:n,title:p.title},p.emoji);}else if(p.title){return c('React').createElement('span',{className:"_5qi2",key:n,style:{backgroundImage:'url('+p.url+')'},title:p.title});}else return c('React').createElement('span',{key:n},p.text);});return (c('React').createElement('div',{className:this.props.className,tabIndex:'0'},o));};function l(){i.apply(this,arguments);}l.propTypes={sourceURIs:k.arrayOf(k.shape({emoji:k.any,text:k.string,title:k.string,type:k.string.isRequired,url:k.string.isRequired})).isRequired};f.exports=l;}),null);
__d('MessageListGreeting.react',['cx','React','MercuryIDs','MessengerPageGreetingStore'],(function a(b,c,d,e,f,g,h){var i,j;i=babelHelpers.inherits(k,c('React').PureComponent);j=i&&i.prototype;function k(){var l,m;'use strict';for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return m=(l=j.constructor).call.apply(l,[this].concat(o)),this.state={shouldShowGreeting:false,greeting:''},this.$MessageListGreeting1=false,this.$MessageListGreeting2=function(q){if(!this.$MessageListGreeting1)return;var r=(q||this.props).threadID;if(!r)return;var s=c('MercuryIDs').getUserIDFromThreadID(r);if(!s)return;var t=c('MessengerPageGreetingStore').getOrFetch(s);if(t){this.setState({shouldShowGreeting:t.shouldShow,greeting:t.content});}else c('MessengerPageGreetingStore').once('change',this.$MessageListGreeting2);}.bind(this),m;}k.prototype.componentDidMount=function(){'use strict';this.$MessageListGreeting1=true;this.$MessageListGreeting2();};k.prototype.componentWillUnmount=function(){'use strict';this.$MessageListGreeting1=false;};k.prototype.componentWillReceiveProps=function(l){'use strict';this.$MessageListGreeting2(l);};k.prototype.render=function(){'use strict';if(this.props.messageCount>0)return null;if(!this.state.shouldShowGreeting||this.state.greeting.trim().length===0)return null;return (c('React').createElement('div',{className:"_4fsh _3-8z"},this.state.greeting));};f.exports=k;}),null);
__d('MessageList.react',['cx','immutable','ImmutableObject','MercuryActionType','MercuryIDs','MercuryLogMessageType','MercuryMessageGroup','MessagingGenericAdminTextType','MessengerAdminGroupUtils','messengerDomIDsRe','MessageListGreeting.react','React','ReactDOM','MercuryShareAttachmentRenderLocations','idx'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('messengerDomIDsRe').ids,l=c('React').PropTypes,m=1000*60*60,n=function u(v){var w,x,y,z,aa,ba,ca,da,ea=(w=v)!=null?(x=w.log_message_data)!=null?x.message_type:x:w;switch(ea){case c('MessagingGenericAdminTextType').GROUP_POLL:return (y=v)!=null?(z=y.log_message_data)!=null?(aa=z.untypedData)!=null?aa.question_id:aa:z:y;case c('MessagingGenericAdminTextType').INSTANT_GAME_UPDATE:return (ba=v)!=null?(ca=ba.log_message_data)!=null?(da=ca.untypedData)!=null?da.game_id:da:ca:ba;default:return null;}};i=babelHelpers.inherits(o,c('React').PureComponent);j=i&&i.prototype;function o(){var u,v;for(var w=arguments.length,x=Array(w),y=0;y<w;y++)x[y]=arguments[y];return v=(u=j.constructor).call.apply(u,[this].concat(x)),this.state={activeMessageID:null,messageGroups:c('MercuryMessageGroup').calculateMessageGroups(this.props.messages,this.props.location),shouldShowGreeting:false,greeting:''},this.$MessageList3=function(z){this.setState(function(aa){return {activeMessageID:aa.activeMessageID===z?null:aa.activeMessageID};});}.bind(this),this.$MessageList4=function(z){this.setState({activeMessageID:z});}.bind(this),v;}o.prototype.componentWillReceiveProps=function(u){if(u.messages!==this.props.messages)this.setState({messageGroups:c('MercuryMessageGroup').calculateMessageGroups(u.messages,u.location)});};o.prototype.render=function(){var u=this.props,v=u.DateBreak,w=u.location,x=u.MessageGroup,y=u.CollapsedLogMessageGroup,z=[],aa=[],ba=void 0,ca=this.props.thread&&this.props.thread.custom_color,da=ca?{backgroundColor:ca}:null,ea=this.state.activeMessageID,fa=this.state.messageGroups,ga=fa.length,ha=this.props.readReceipts,ia=ha.last(),ja=ia?ia.watermark:0,ka=c('MercuryIDs').getParticipantIDFromUserID(this.props.viewer),la={};for(var ma=this.props.messages.size-1;ma>=0;ma--){var na=this.props.messages.get(ma),oa=n(na);if(oa&&!la[oa])la[oa]=na.message_id;}for(var pa=0;pa<ga;pa++){var qa=pa>0?fa[pa-1]:null,ra=qa&&qa.length>0?qa[qa.length-1]:null,sa=fa[pa],ta=sa[0],ua=sa[sa.length-1],va=false;if(!ra||ta.timestamp-ra.timestamp>m){va=true;var wa=c('React').createElement(v,{date:new Date(ta.timestamp),key:'db:'+ta.message_id,ref:'db:'+ta.message_id});if(aa.length===0)z.push(wa);}if(ta.action_type==c('MercuryActionType').LOG_MESSAGE){var xa=ta.log_message_data.message_type===c('MessagingGenericAdminTextType').INSTANT_GAME_UPDATE,ya=ta.log_message_data.message_type===c('MessagingGenericAdminTextType').GROUP_POLL;if((w===c('MercuryShareAttachmentRenderLocations').CHAT||w===c('MercuryShareAttachmentRenderLocations').MESSENGER)&&(ta.log_message_type===c('MercuryLogMessageType').VIDEO_CALL||ta.log_message_type===c('MercuryLogMessageType').PHONE_CALL)){var za=this.$MessageList1(ta,ka,fa,ga,pa,ha,ja,ua);z.push(za);}else{var ab=this.$MessageList2(ta,la);ba=ta.message_id;if(c('MessengerAdminGroupUtils').isJoinableThread(this.props.thread)&&!xa&&!ya){aa.push(ab);}else{if(aa.length!==0){if(aa.length>1){z.push(c('React').createElement(y,{key:'mg:'+ba,style:da},aa));}else z.push(c('React').createElement('div',{key:'mg:'+ba},aa));aa=[];}z.push(ab);}}continue;}if(aa.length!==0){if(aa.length>1){z.push(c('React').createElement(y,{key:'mg:'+ba,style:da},aa));}else z.push(c('React').createElement('div',{key:'mg:'+ba},aa));aa=[];}sa=c('immutable').List(sa);var bb=q(fa,ga,pa),cb=!s(ha,sa,bb),db=r(ja,ua),eb=t(this.props.deliveryTimestamp,ua);z.push(c('React').createElement(x,{activeMessageID:p(ea,sa),author:sa.first().author,deliveryTimestamp:eb,hasDateBreak:va,isCanonical:this.props.isCanonical,isFromViewer:ka===ta.author,isPageMessage:this.props.isPageMessage,key:'mg:'+ta.message_id,lastReadTimestamp:db,maxBubbleWidth:this.props.maxBubbleWidth,messages:sa,nextTimestamp:bb,onAttachmentLoad:this.props.onAttachmentLoad,onMessageDeselect:this.$MessageList3,onMessageSelect:this.$MessageList4,onStickerClick:this.props.onStickerClick,readReceipts:cb?ha:c('immutable').OrderedMap(),ref:'mg:'+ta.message_id,thread:this.props.thread,threadID:this.props.threadID}));}if(aa.length!==0){if(aa.length>1){z.push(c('React').createElement(y,{key:'mg:'+ba,style:da},aa));}else z.push(c('React').createElement('div',{key:'mg:'+ba},aa));aa=[];}var fb=this.props.threadID||this.props.thread&&this.props.thread.thread_id||this.props.thread&&this.props.thread.thread_fbid,gb=null;if(w===c('MercuryShareAttachmentRenderLocations').MESSENGER)gb=c('React').createElement(c('MessageListGreeting.react'),{messageCount:aa.length+ga,threadID:fb});return c('React').createElement('div',{id:w===c('MercuryShareAttachmentRenderLocations').MESSENGER?k.CONVERSATION:null},gb,z);};o.prototype.getMessageElement=function(u,v){if(v){var w=this.refs['db:'+u];if(w)return c('ReactDOM').findDOMNode(w);}var x=this.state.messageGroups.find(function(aa){return aa.some(function(ba){return ba.message_id===u;});});if(!x)return null;var y=x[0].message_id,z=this.refs['mg:'+y];if(!z)return null;if(v&&y===u)return c('ReactDOM').findDOMNode(z);return z.getMessageElement(u);};o.prototype.$MessageList1=function(u,v,w,x,y,z,aa,ba){var ca=this.props.MessageGroup,da={attach_type:'share',share:{style_list:['rtc_call_log','fallback'],log_message_body:u.log_message_body,log_message_data:u.log_message_data,log_message_type:u.log_message_type,timestamp:u.timestamp}},ea=c('ImmutableObject').setProperty(u,'attachments',[da]);ea=c('ImmutableObject').setProperty(ea,'body','');var fa=c('immutable').List([ea]),ga=q(w,x,y),ha=!s(z,fa,ga),ia=r(aa,ba),ja=t(this.props.deliveryTimestamp,ba);return (c('React').createElement(ca,{author:fa.first().author,deliveryTimestamp:ja,isFromViewer:v===u.author,key:u.message_id,lastReadTimestamp:ia,maxBubbleWidth:this.props.maxBubbleWidth,messages:fa,nextTimestamp:ga,onAttachmentLoad:this.props.onAttachmentLoad,onMessageDeselect:this.$MessageList3,onMessageSelect:this.$MessageList4,onStickerClick:this.props.onStickerClick,readReceipts:ha?z:c('immutable').OrderedMap(),thread:this.props.thread,threadID:this.props.threadID}));};o.prototype.$MessageList2=function(u,v){var w=this.props.LogMessage,x=v[n(u)];return (c('React').createElement(w,{className:this.props.location===c('MercuryShareAttachmentRenderLocations').CHAT?"_5w0o":null,key:u.message_id,onLogMessageExpanded:this.props.onAttachmentLoad,loadMoreMessages:this.props.loadMoreMessages,message:u,onImageLoad:this.props.onAttachmentLoad,viewer:this.props.viewer,thread:this.props.thread,isLastOfType:x===u.message_id}));};o.propTypes={CollapsedLogMessageGroup:l.func.isRequired,DateBreak:l.func.isRequired,deliveryTimestamp:l.number.isRequired,isCanonical:l.bool,isPageMessage:l.bool,location:l.string.isRequired,LogMessage:l.func.isRequired,loadMoreMessages:l.func,MessageGroup:l.func.isRequired,messages:l.instanceOf(c('immutable').List).isRequired,onAttachmentLoad:l.func,onStickerClick:l.func,readReceipts:l.instanceOf(c('immutable').OrderedMap).isRequired,viewer:l.string.isRequired,thread:l.object,threadID:l.string};function p(u,v){return v.find(function(w){return w.message_id===u;})?u:null;}function q(u,v,w){return w<v-1?u[w+1][0].timestamp:Infinity;}function r(u,v){return v.timestamp>u?u:Infinity;}function s(u,v,w){return (v.isEmpty()||u.last()<v.first().timestamp||u.first()>=w);}function t(u,v){return v.timestamp>u?u:Infinity;}f.exports=o;}),null);
__d('getVisibleValueForContentStateWithMessengerEmoji',['ContentState','DraftEntity','EmojiFormat','emptyFunction'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j=i.getBlockMap().map(function(k){var l=k.getText(),m='';k.findEntityRanges(c('emptyFunction').thatReturnsTrue,function(n,o){var p=k.getEntityAt(n);if(!p){m+=l.slice(n,o);}else{var q=c('DraftEntity').get(p);if(q.getType()==='EMOTICON'){m+=q.getData().originalEmoticon;}else if(q.getType()==='EMOJI'){var r=q.getData().type,s=c('EmojiFormat').codeStringToCodeArray(r);m+=String.fromCodePoint.apply(String,s);}else m+=l.slice(n,o);}});return m;});return j.join('\n');}f.exports=h;}),null);
__d('MercuryMessageList',['immutable','LogHistory','Map','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h=c('LogHistory').getInstance('mercury_message_list');function i(k){this.$MercuryMessageList1=c('immutable').List(k||[]);this.$MercuryMessageList2();}i.prototype.append=function(k){var l;this.$MercuryMessageList1=(l=this.$MercuryMessageList1).push.apply(l,k);this.$MercuryMessageList2();j('append',k);};i.prototype.prepend=function(k){var l;this.$MercuryMessageList1=(l=this.$MercuryMessageList1).unshift.apply(l,k);this.$MercuryMessageList2();j('prepend',k);};i.prototype.update=function(k){var l=k.filter(function(m){return this.contains(m);}.bind(this));if(l.length===0)return;this.$MercuryMessageList1=this.$MercuryMessageList1.withMutations(function(m){l.forEach(function(n){var o=this.$MercuryMessageList3.get(n.message_id);if(o!==undefined)m.set(o,n);}.bind(this));}.bind(this));j('update',l);};i.prototype.reorder=function(k){this.$MercuryMessageList1=c('immutable').List(k);this.$MercuryMessageList2();j('reorder',k);};i.prototype.at=function(k){return this.$MercuryMessageList1.get(k);};i.prototype.contains=function(k){return this.$MercuryMessageList3.has(k.message_id);};i.prototype.toArray=function(){return this.$MercuryMessageList1.toArray();};i.prototype.toMap=function(){return new (c('Map'))(c('immutable').Seq(this.$MercuryMessageList1).map(function(k){return [k.message_id,k];}));};i.prototype.$MercuryMessageList2=function(){this.$MercuryMessageList3=new (c('Map'))(c('immutable').Seq(this.$MercuryMessageList1).map(function(k,l){return [k.message_id,l];}));};function j(event,k){c('setTimeoutAcrossTransitions')(function(){h.debug(event,JSON.stringify({messageIDs:k.map(function(l){return l.message_id;})}));},0);}f.exports=i;}),null);
__d('MercuryMessageStore',['MercuryAPIArgsSource','LogHistory','MercuryMessages','MercuryViewer','MercuryMessageList','SubscriptionsHandler','MercuryThreadInformer','MercuryThreadlistConstants','MercuryThreads','mixInEventEmitter','setImmediate','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreads').get(),i=c('LogHistory').getInstance('mercury_message_store');function j(l,m,n){this.$MercuryMessageStore1=l;this.$MercuryMessageStore2=new (c('MercuryMessageList'))();this.$MercuryMessageStore3=n?c('MercuryMessages').getForFBID(n):c('MercuryMessages').get();this.$MercuryMessageStore4=1;this.$MercuryMessageStore5=null;this.$MercuryMessageStore6=0;this.$MercuryMessageStore7=m||c('MercuryThreadlistConstants').RECENT_MESSAGES_LIMIT;this.$MercuryMessageStore8=n?c('MercuryThreadInformer').getForFBID(n):c('MercuryThreadInformer').get();this.$MercuryMessageStore9=new (c('SubscriptionsHandler'))();this.$MercuryMessageStore9.addSubscriptions(this.$MercuryMessageStore8.subscribe('messages-received',function(o,p){return this.$MercuryMessageStore10(p);}.bind(this)),this.$MercuryMessageStore8.subscribe('messages-updated',function(o,p){return p[this.$MercuryMessageStore1]&&this.$MercuryMessageStore11(p[this.$MercuryMessageStore1]);}.bind(this)),this.$MercuryMessageStore8.subscribe('messages-reordered',function(o,p){return p[this.$MercuryMessageStore1]&&this.$MercuryMessageStore12();}.bind(this)),this.$MercuryMessageStore8.subscribe('thread-invalidated',function(o,p){return p[this.$MercuryMessageStore1]&&this.$MercuryMessageStore13();}.bind(this)));i.debug('constructed',JSON.stringify({threadID:this.$MercuryMessageStore1}));this.$MercuryMessageStore14();}j.prototype.setNewThreadID=function(l){this.$MercuryMessageStore15=l;};j.prototype.destroy=function(){this.$MercuryMessageStore9&&this.$MercuryMessageStore9.release();i.debug('destroyed',JSON.stringify({threadID:this.$MercuryMessageStore1}));};j.prototype.subscribe=function(l){return this.addRetroactiveListener('updated',l);};j.prototype.fetchMoreMessages=function(){if(this.hasFetchedAll())return false;this.$MercuryMessageStore14();return true;};j.prototype.hasFetchedAll=function(){if(this.$MercuryMessageStore3.hasLoadedExactlyNMessages(this.$MercuryMessageStore1,this.$MercuryMessageStore6)&&this.$MercuryMessageStore3.hasLoadedAllMessages(this.$MercuryMessageStore1))return true;return h.isNewEmptyLocalThread(this.$MercuryMessageStore1);};j.prototype.$MercuryMessageStore14=function(){var l=this.$MercuryMessageStore6+this.$MercuryMessageStore7*this.$MercuryMessageStore4;i.debug('fetching',JSON.stringify({threadID:this.$MercuryMessageStore1,limit:l}));this.$MercuryMessageStore3.getThreadMessagesRange(this.$MercuryMessageStore1,0,l,this.$MercuryMessageStore16.bind(this),null,c('MercuryAPIArgsSource').MERCURY);if(this.$MercuryMessageStore4<10)this.$MercuryMessageStore4+=1;if(this.$MercuryMessageStore3.hasLoadedNMessages(this.$MercuryMessageStore1,l))c('setImmediate')(function(){this.$MercuryMessageStore12();}.bind(this));};j.prototype.$MercuryMessageStore16=function(l){if(l&&l.length){this.$MercuryMessageStore5=l[0].timestamp;this.$MercuryMessageStore6=l.length;i.debug('fetched',JSON.stringify({threadID:this.$MercuryMessageStore1,earliestMessageTimestamp:this.$MercuryMessageStore5,count:this.$MercuryMessageStore6}));}else if(l&&!l.length&&!this.$MercuryMessageStore6)this.$MercuryMessageStore17(j.THREAD_IS_EMPTY);};j.prototype.$MercuryMessageStore10=function(l){var m=[],n=l[this.$MercuryMessageStore1];if(n&&n.length)m=m.concat(n);if(this.$MercuryMessageStore15){var o=l[this.$MercuryMessageStore15];if(o&&o.length){m=m.concat(o);this.$MercuryMessageStore15=null;}}if(m.length){this.$MercuryMessageStore2.append(m);this.$MercuryMessageStore6+=m.length;var p=m.every(function(q){return q.author!=c('MercuryViewer').getID();});this.$MercuryMessageStore17(j.MESSAGES_RECEIVED,{allFromOthers:p});}};j.prototype.$MercuryMessageStore11=function(l){this.$MercuryMessageStore2.update(this.$MercuryMessageStore3.getMessagesFromIDs(Object.keys(l)));this.$MercuryMessageStore18();this.$MercuryMessageStore17(j.MESSAGES_CHANGED);};j.prototype.$MercuryMessageStore12=function(){if(!this.$MercuryMessageStore5)return;this.$MercuryMessageStore2.reorder(this.$MercuryMessageStore3.getThreadMessagesSinceTimestamp(this.$MercuryMessageStore1,this.$MercuryMessageStore5));this.$MercuryMessageStore18();this.$MercuryMessageStore17(j.MESSAGES_REORDERED);};j.prototype.$MercuryMessageStore13=function(){this.$MercuryMessageStore2=new (c('MercuryMessageList'))();this.$MercuryMessageStore4=1;this.$MercuryMessageStore5=null;this.$MercuryMessageStore6=0;this.$MercuryMessageStore14();};j.prototype.$MercuryMessageStore17=function(l,m){var n=this.$MercuryMessageStore2.toArray();this.releaseHeldEventType('updated');this.emitAndHold('updated',babelHelpers['extends']({messages:n,eventType:l},m));k(this.$MercuryMessageStore1,l,n);};j.prototype.$MercuryMessageStore18=function(){var l=this.$MercuryMessageStore2.at(0);if(l)this.$MercuryMessageStore5=l.timestamp;};function k(l,m,n){c('setTimeoutAcrossTransitions')(function(){i.debug('update:'+m,JSON.stringify({threadID:l,messageIDs:n.map(function(o){return o.message_id;})}));},0);}Object.assign(j,{MESSAGES_FETCHED:'fetched',MESSAGES_CHANGED:'changed',MESSAGES_RECEIVED:'received',MESSAGES_REORDERED:'reordered',THREAD_IS_EMPTY:'thread-is-empty'});c('mixInEventEmitter')(j,{updated:true});f.exports=j;}),null);