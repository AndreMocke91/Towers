if (self.CavalryLogger) { CavalryLogger.start_js(["\/0nCG"]); }

__d("IrisProtocolMessageLifetime",[],(function a(b,c,d,e,f,g){f.exports={TTL_OFF:0,TTL_ON_UNKNOWN:1,TTL_30SECONDS:30000,TTL_1MINUTE:60000,TTL_3MINUTES:180000,TTL_5MINUTES:300000,TTL_10MINUTES:600000,TTL_15MINUTES:900000,TTL_30MINUTES:1800000,TTL_1HOUR:3600000,TTL_2HOURS:7200000,TTL_4HOURS:14400000,TTL_8HOURS:28800000,TTL_12HOURS:43200000,TTL_24HOURS:86400000};}),null);
__d("MercurySyncTopicType",[],(function a(b,c,d,e,f,g){f.exports={DELTA:"delta",DELTAFLOW:"deltaflow",DELTAFLOWREJECT:"deltaflowreject"};}),null);
__d("MessagingEvent",[],(function a(b,c,d,e,f,g){f.exports={DELETE:"delete",DELETE_MESSAGES:"delete_messages",DELIVER:"deliver",ERROR:"error",READ:"read",REPORT_SPAM:"report_spam",REPORT_SPAM_MESSAGES:"report_spam_messages",UNMARK_SPAM:"unmark_spam",SUBSCRIBE:"subscribe",CHANGE_MUTE_SETTINGS:"change_mute_settings",TAG:"tag",UNREAD:"unread",UNSUBSCRIBE:"unsubscribe",DELIVER_LOG:"deliver_log",MORE_THREADS:"more_threads",READ_ALL:"read_all",READ_RECEIPT:"read_receipt",DELIVERY_RECEIPT:"delivery_receipt",SENT_PUSH:"sent_push",DELIVER_FAST_PAST:"deliver_fast_path",MESSENGER_STATUS:"messenger_status",UPDATE_PINNED_THREADS:"update_pinned_threads",CHANGE_PAGE_THREAD_FLAG:"change_page_thread_flag",CREATE_PAGE_ADMIN_NOTE:"create_page_admin_note",NO_OP:"no_op"};}),null);
__d("MessagingThreadAction",[],(function a(b,c,d,e,f,g){f.exports={ACTION_INVALID:"ACTION_INVALID",ACTION_ARCHIVED:"ACTION_ARCHIVED",ACTION_UNARCHIVED:"ACTION_UNARCHIVED"};}),null);
__d("MessengerApprovalQueueTypes",[],(function a(b,c,d,e,f,g){f.exports={REQUESTED:"REQUESTED",REMOVED:"REMOVED"};}),null);
__d("PagesMessagingEventType",[],(function a(b,c,d,e,f,g){f.exports={FLAG:1,CREATE_ADMIN_NOTE:2,PRIORITY_UPDATE:3};}),null);
__d('MercurySyncHolesTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:MercurySyncHolesLoggerConfig',this.$MercurySyncHolesTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:MercurySyncHolesLoggerConfig',this.$MercurySyncHolesTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$MercurySyncHolesTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$MercurySyncHolesTypedLogger1=babelHelpers['extends']({},this.$MercurySyncHolesTypedLogger1,j);return this;};h.prototype.setDifference=function(j){this.$MercurySyncHolesTypedLogger1.difference=j;return this;};h.prototype.setSeqID=function(j){this.$MercurySyncHolesTypedLogger1.seq_id=j;return this;};h.prototype.setTopicType=function(j){this.$MercurySyncHolesTypedLogger1.topic_type=j;return this;};h.prototype.setVC=function(j){this.$MercurySyncHolesTypedLogger1.vc=j;return this;};var i={difference:true,seq_id:true,topic_type:true,vc:true};f.exports=h;}),null);
__d('MontageDispatcher',['ExplicitRegistrationDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('ExplicitRegistrationDispatcher'));i=h&&h.prototype;function j(){h.apply(this,arguments);}f.exports=new j({strict:false});}),null);
__d('MontageActions',['MontageDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({REQUEST_UPDATE:null,HAS_UPDATED:null}),i={Types:h,requestUpdate:function j(k){c('MontageDispatcher').dispatch({type:h.REQUEST_UPDATE,threadFBID:k});},hasUpdated:function j(k){c('MontageDispatcher').dispatch({type:h.HAS_UPDATED,threadFBID:k});}};f.exports=i;}),null);
__d('MercuryChannelMessageTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k={author:i.mercury_author_id,author_email:i.mercury_author_email,body:i.body,subject:i.subject,has_attachment:i.has_attachment,attachments:i.attachments,ephemeral_ttl_mode:i.ephemeral_ttl_mode,html_body:i.html_body,thread_id:i.tid,thread_fbid:i.thread_fbid&&i.thread_fbid.toString(),other_user_fbid:i.other_user_fbid&&i.other_user_fbid.toString(),offline_threading_id:i.offline_threading_id,message_id:i.mid,is_spoof_warning:i.is_spoof_warning,ranges:i.ranges,source:i.mercury_source,source_tags:i.mercury_source_tags,tags:i.tags&&i.tags.split(','),threading_id:i.threading_id,timestamp:i.timestamp,timestamp_absolute:i.timestamp_absolute,timestamp_relative:i.timestamp_relative,timestamp_datetime:i.timestamp_datetime,timestamp_time_passed:i.timestamp_time_passed,action_type:c('MercuryActionType').USER_GENERATED_MESSAGE,is_unread:i.is_unread,is_forward:false,forward_count:i.forward_count||i.forward,forward_message_ids:i.forward_msg_ids,folder:j,sync_id:i.sync_id};return k;}f.exports={transform:h};}),null);
__d('MercuryDelayedDispatcher',['MercuryDispatcher','MercuryServerPayloadPreprocessor','MercuryServerRequests','MercurySingletonProvider','MercuryThreadIDMap'],(function a(b,c,d,e,f,g){'use strict';function h(j){this.$MercuryDelayedDispatcher1=j;this.$MercuryDelayedDispatcher2=[];this.$MercuryDelayedDispatcher3=c('MercuryThreadIDMap').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher4=c('MercuryDispatcher').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher5=c('MercuryServerRequests').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher6=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher4.subscribe('model-update-completed',function(k,l){return this.$MercuryDelayedDispatcher7();}.bind(this));}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.handleUpdateWaitForThread=function(j,k){var l=this.$MercuryDelayedDispatcher3.getClientIDFromServerIDNow(k);if(l){this.$MercuryDelayedDispatcher8(j);return;}this.$MercuryDelayedDispatcher3.getClientIDFromServerID(k,function(){return this.$MercuryDelayedDispatcher2.push(j);}.bind(this));this.$MercuryDelayedDispatcher5.ensureThreadIsFetched(k);};h.prototype.$MercuryDelayedDispatcher7=function(){if(this.$MercuryDelayedDispatcher2&&this.$MercuryDelayedDispatcher2.length){var j=this.$MercuryDelayedDispatcher2[0];this.$MercuryDelayedDispatcher2=this.$MercuryDelayedDispatcher2.slice(1);this.$MercuryDelayedDispatcher8(j);}};h.prototype.$MercuryDelayedDispatcher8=function(j){if(j.from_client){this.$MercuryDelayedDispatcher4.handleUpdate(j);}else this.$MercuryDelayedDispatcher6.handleUpdate(j);};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercuryChannelHandlerDEPRECATED',['Arbiter','ChannelConstants','LogHistory','MercuryActionType','MercuryChannelMessageTransformer','MercuryDelayedDispatcher','MercuryGlobalActionType','MercuryLogMessageType','MercuryMessages','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercurySingletonProvider','MercuryThreadInformer','MercuryViewer','MessagingEvent','MessagingTag','PresenceUtil','mixin'],(function a(b,c,d,e,f,g){'use strict';var h=c('LogHistory').getInstance('mercury_channel_handler');i.get=function(){return j.get();};i.getForFBID=function(k){return j.getForFBID(k);};function i(k){this.$MercuryChannelHandlerDEPRECATED1=k;this.__payloadPreprocessor=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryChannelHandlerDEPRECATED1);this.$MercuryChannelHandlerDEPRECATED2=c('MercuryThreadInformer').getForFBID(this.$MercuryChannelHandlerDEPRECATED1);this.$MercuryChannelHandlerDEPRECATED3=c('MercuryMessages').getForFBID(this.$MercuryChannelHandlerDEPRECATED1);this.__delayedDispatcher=c('MercuryDelayedDispatcher').getForFBID(this.$MercuryChannelHandlerDEPRECATED1);this.$MercuryChannelHandlerDEPRECATED4=[];}i.prototype.getInstanceFBID=function(){return this.$MercuryChannelHandlerDEPRECATED1;};i.prototype.$MercuryChannelHandlerDEPRECATED5=function(k,l){if(!this.$MercuryChannelHandlerDEPRECATED6(k)||!l.obj.thread_fbids&&!l.obj.other_user_fbids)return;var m=c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE,n=void 0;(l.obj.thread_fbids||[]).forEach(function(o){if(l.obj.event==c('MessagingEvent').TAG){n=l.obj.tag;}else n=l.obj.marked_as_spam?c('MessagingTag').SPAM:c('MessagingTag').INBOX;var p={action_type:c('MercuryActionType').CHANGE_FOLDER,thread_fbid:o.toString(),other_user_fbid:null,new_folder:n};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers['extends']({},p)],payload_source:m},o.toString());},this);(l.obj.other_user_fbids||[]).forEach(function(o){if(l.obj.event==c('MessagingEvent').TAG){n=l.obj.tag;}else n=l.obj.marked_as_spam?c('MessagingTag').SPAM:c('MessagingTag').INBOX;var p={action_type:c('MercuryActionType').CHANGE_FOLDER,other_user_fbid:o.toString(),thread_fbid:null,new_folder:n};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers['extends']({},p)],payload_source:m},o.toString());},this);};i.prototype.$MercuryChannelHandlerDEPRECATED7=function(k,l){if(!this.$MercuryChannelHandlerDEPRECATED6(k)||!l.obj.tag)return;switch(l.obj.tag){case c('MessagingTag').INBOX:case c('MessagingTag').OTHER:this.$MercuryChannelHandlerDEPRECATED5(k,l);break;}};i.prototype.__markAsSeen=function(k,l){if(!this.$MercuryChannelHandlerDEPRECATED8(k)||!l.obj||!l.obj.seen_timestamp)return;this.__payloadPreprocessor.handleUpdate({message_counts:[{seen_timestamp:l.obj.seen_timestamp,folder:c('MessagingTag').INBOX}],unseen_thread_fbids:[{thread_fbids:[],other_user_fbids:[],folder:c('MessagingTag').INBOX}],payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});};i.prototype.__handleMessagingPayload=function(k,l){switch(l.obj.event){case c('MessagingEvent').TAG:this.$MercuryChannelHandlerDEPRECATED7(k,l);break;case c('MessagingEvent').REPORT_SPAM:this.$MercuryChannelHandlerDEPRECATED5(k,l);break;}};i.prototype.getRouting=function(){return {messaging:this.__handleMessagingPayload,inbox:this.__markAsSeen};};i.prototype.__getMessagingPayloadType=function(){return c('ChannelConstants').getArbiterType('messaging');};i.prototype.__getMercuryPayloadType=function(){return c('ChannelConstants').getArbiterType('mercury');};i.prototype.__getInboxPayloadType=function(){return c('ChannelConstants').getArbiterType('inbox');};i.prototype.$MercuryChannelHandlerDEPRECATED6=function(k){return k===this.__getMessagingPayloadType();};i.prototype.$MercuryChannelHandlerDEPRECATED9=function(k){return k===this.__getMercuryPayloadType();};i.prototype.$MercuryChannelHandlerDEPRECATED8=function(k){return k===this.__getInboxPayloadType();};i.prototype.turnOn=function(){if(!this.$MercuryChannelHandlerDEPRECATED4.length){var k=this.getRouting();for(var l in k)this.$MercuryChannelHandlerDEPRECATED4.push(c('Arbiter').subscribe(c('ChannelConstants').getArbiterType(l),k[l].bind(this)));}return this;};i.prototype.turnOff=function(){if(this.$MercuryChannelHandlerDEPRECATED4.length){this.$MercuryChannelHandlerDEPRECATED4.forEach(c('Arbiter').unsubscribe);this.$MercuryChannelHandlerDEPRECATED4=[];}return this;};i.prototype.__shouldDropLogMessageBecauseOfSync=function(k){switch(k.log_message_type){case c('MercuryLogMessageType').UNSUBSCRIBE:case c('MercuryLogMessageType').SUBSCRIBE:case c('MercuryLogMessageType').THREAD_NAME:case c('MercuryLogMessageType').VIDEO_CALL:case c('MercuryLogMessageType').PHONE_CALL:case c('MercuryLogMessageType').THREAD_IMAGE:case c('MercuryLogMessageType').ORION:case c('MercuryLogMessageType').PAGE_REPLY:case c('MercuryLogMessageType').GENERIC_ADMIN_TEXT:return true;case c('MercuryLogMessageType').SERVER_ERROR:case c('MercuryLogMessageType').LIVE_LISTEN:case c('MercuryLogMessageType').SWITCH_TO_WORK:case c('MercuryLogMessageType').WALLPAPER:default:break;}return false;};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercurySyncDataFetcherImpl',['Promise','AsyncRequest','MessagingConfig','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h=c('MessagingConfig').syncFetchRequestTimeoutMs;function i(k){return new (c('Promise'))(function(l,m){j(k,l,m,0);});}function j(k,l,m,n){if(n>c('MessagingConfig').syncFetchRetries){m();return;}var o=n===0?0:c('MessagingConfig').syncFetchInitialTimeoutMs*Math.pow(c('MessagingConfig').syncFetchTimeoutMultiplier,n);c('setTimeoutAcrossTransitions')(function(){var p=false,q=function r(){if(p)return;p=true;j(k,l,m,n+1);};new (c('AsyncRequest'))().setURI(k).setHandler(function(r){p=true;l(r);}).setErrorHandler(q).setTimeoutHandler(h,q).setAllowCrossPageTransition(true).send();},o);}f.exports={fetch:i};}),null);
__d('MercurySyncDataFetcher',['Promise','LogHistory','MessagingConfig','MercurySyncDataFetcherImpl','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h=c('LogHistory').getInstance('mercury_sync_data_fetcher');function i(){var l=0;for(var m=0;m<c('MessagingConfig').syncFetchRetries;m++){var n=m===0?0:c('MessagingConfig').syncFetchInitialTimeoutMs*Math.pow(c('MessagingConfig').syncFetchTimeoutMultiplier,m);l+=n+c('MessagingConfig').syncFetchRequestTimeoutMs;}return l;}var j=i();function k(l){return new (c('Promise'))(function(m,n){c('MercurySyncDataFetcherImpl').fetch(l).done(m,n);c('setTimeoutAcrossTransitions')(function(){h.error('fetch_timeout',JSON.stringify({timeout:j,uri:l.toString()}));n();},j);});}f.exports={fetch:k,getMaxTimeoutMs:i};}),null);
__d("XMercuryFetchMessageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/mercury\/fetch_message\/",{other_user_or_thread_fbid:{type:"Int",required:true},mid:{type:"String",required:true}});}),null);
__d("XMercuryInvalidateGlobalStateController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/mercury\/invalidate_global_state\/",{});}),null);
__d("XMercuryInvalidateThreadStateController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/mercury\/invalidate_thread_state\/",{other_user_or_thread_fbid:{type:"Int",required:true},num_messages:{type:"Int",required:true}});}),null);
__d('MercurySyncDFFDataFetcher',['Promise','ActorURI','AsyncRequest','MercuryMessages','MercuryThreads','MercuryThreadIDMap','MercurySingletonProvider','MercurySyncDataFetcher','XMercuryFetchMessageController','XMercuryInvalidateGlobalStateController','XMercuryInvalidateThreadStateController'],(function a(b,c,d,e,f,g){'use strict';function h(j){this.$MercurySyncDFFDataFetcher1=j;this.__messages=c('MercuryMessages').getForFBID(this.$MercurySyncDFFDataFetcher1);this.__threads=c('MercuryThreads').getForFBID(this.$MercurySyncDFFDataFetcher1);this.__threadIDMap=c('MercuryThreadIDMap').getForFBID(this.$MercurySyncDFFDataFetcher1);}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.fetchInvalidateGlobalState=function(){var j=c('XMercuryInvalidateGlobalStateController').getURIBuilder().getURI(),k=c('ActorURI').create(j,this.$MercurySyncDFFDataFetcher1);return c('MercurySyncDataFetcher').fetch(k);};h.prototype.fetchInvalidateThreadState=function(j,k){var l=11,m=3,n=j||k,o=this.__threadIDMap.getClientIDFromServerIDNow(n);if(!o)return c('Promise').resolve({getPayload:function s(){return {};}});var p=m+this.__messages.getCurrentlyLoadedMessages(o).length,q=c('XMercuryInvalidateThreadStateController').getURIBuilder().setInt('other_user_or_thread_fbid',n).setInt('num_messages',Math.max(p,l)).getURI(),r=c('ActorURI').create(q,this.$MercurySyncDFFDataFetcher1);return c('MercurySyncDataFetcher').fetch(r);};h.prototype.fetchInvalidateMessage=function(j,k,l){var m=c('XMercuryFetchMessageController').getURIBuilder().setInt('other_user_or_thread_fbid',j||k).setString('mid',l).getURI(),n=c('ActorURI').create(m,this.$MercurySyncDFFDataFetcher1);return c('MercurySyncDataFetcher').fetch(n);};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercurySyncDeltaHolder',['Map'],(function a(b,c,d,e,f,g){'use strict';function h(){this.$MercurySyncDeltaHolder1=new (c('Map'))();this.$MercurySyncDeltaHolder2=[];}h.prototype.peek=function(){this.$MercurySyncDeltaHolder2=this.$MercurySyncDeltaHolder2.sort(function(i,j){return i-j;});return this.$MercurySyncDeltaHolder2[0];};h.prototype.pop=function(){this.$MercurySyncDeltaHolder2=this.$MercurySyncDeltaHolder2.sort(function(k,l){return k-l;});if(this.$MercurySyncDeltaHolder2.length===0)return undefined;var i=this.$MercurySyncDeltaHolder2.shift(),j=this.$MercurySyncDeltaHolder1.get(i);this.$MercurySyncDeltaHolder1['delete'](i);return {seqID:i,delta:j};};h.prototype.push=function(i,j){if(this.$MercurySyncDeltaHolder1.has(i))return;this.$MercurySyncDeltaHolder1.set(i,j);this.$MercurySyncDeltaHolder2.push(i);};f.exports=h;}),null);
__d('MercuryMessageCustomizations',[],(function a(b,c,d,e,f,g){'use strict';function h(j,k){var l=j.customizations;if(!l)return null;var m=l.filter(function(n){return n.customization_type===k;});return m.length>0?m[0].customization_value:null;}function i(j){var k=JSON.parse(j),l=[];Object.keys(k).forEach(function(m){l.push({customization_type:m,customization_value:k[m]});});return l;}f.exports={getCustomizationValue:h,parseCustomizations:i};}),null);
__d('MercuryProfileRanges',['idx'],(function a(b,c,d,e,f,g){'use strict';function h(i){if(!i.id&&i.i)return {id:i.i,offset:i.o,length:i.l};return i;}f.exports={extractFromDelta:function i(j){var k,l,m=(k=j)!=null?(l=k.data)!=null?l.prng:l:k;if(!m)return undefined;var n=[];try{n=JSON.parse(m);if(n.length>0)return n.map(h);}catch(o){}return n;}};}),null);
__d('MercurySyncNewMessageTransformer',['IrisProtocolMessageLifetime','MercuryActionType','MercuryConfig','MercuryIDs','MercuryMessageCustomizations','MercuryProfileRanges','MercuryTimestamp','MessagingTag'],(function a(b,c,d,e,f,g){'use strict';var h=function j(k){var l={};try{l=JSON.parse(k);}catch(m){}return l;};function i(j,k){var l=parseInt(k.messageMetadata.timestamp,10),m=c('MercuryTimestamp').getFormatedTimestamp(l),n=k.messageMetadata.skipBumpThread&&c('MercuryConfig').WWWMessengerSkipBumpThread,o=j!==k.messageMetadata.actorFbId,p=[];if(k.attachments)p=k.attachments.map(function(r){return r.mercury;});var q=k.messageMetadata.tags?k.messageMetadata.tags[0]:undefined;return {message_id:k.messageMetadata.messageId,threading_id:null,offline_threading_id:k.messageMetadata.offlineThreadingId,author:c('MercuryIDs').getParticipantIDFromUserID(k.messageMetadata.actorFbId),author_email:k.messageMetadata.actorFbId+'@facebook.com',ephemeral_ttl_mode:k.ttl?c('IrisProtocolMessageLifetime')[k.ttl]:0,timestamp:l,timestamp_absolute:m.absolute,timestamp_relative:m.relative,timestamp_datetime:m.relative,timestamp_time_passed:c('MercuryTimestamp').getTimeBucket(l),is_unread:o,is_forward:false,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,forward_count:0,forward_message_ids:[],source:q,tags:k.messageMetadata.tags,is_spoof_warning:false,folder:c('MessagingTag').INBOX,thread_fbid:k.messageMetadata.threadKey.threadFbId,other_user_fbid:k.messageMetadata.threadKey.otherUserFbId,body:k.body!==undefined?k.body:'',html_body:null,subject:null,has_attachment:p.length>0,attachments:p,ranges:undefined,thread_id:null,action_type:c('MercuryActionType').USER_GENERATED_MESSAGE,is_from_iris:true,is_sponsored:!!(k.data&&k.data.is_sponsored&&k.data.is_sponsored==='true'),commerce_message_type:k.data?k.data.commerce_message_type:null,customizations:k.data&&k.data.customization?c('MercuryMessageCustomizations').parseCustomizations(k.data.customization):null,platform_xmd:k.data&&k.data.platform_xmd?k.data.platform_xmd:null,profile_ranges:c('MercuryProfileRanges').extractFromDelta(k),message_source:k.data&&k.data.message_source_data?h(k.data.message_source_data).message_source:null,skip_bump_thread:n,montage_reply_data:k.data&&k.data.montage_reply_data?h(k.data.montage_reply_data):null};}f.exports={transform:i};}),null);
__d('MercurySyncAdminTextMessageTransformer',['MercuryActionType','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={message_type:j.type,untypedData:j.untypedData};k.log_message_type=c('MercuryLogMessageType').GENERIC_ADMIN_TEXT;return k;}f.exports={transform:h};}),null);
__d('MercurySyncClientPayloadTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';function h(k){var l=k.payload;l=JSON.parse(String.fromCharCode.apply(null,l));var m=l&&l.deltas,n=m[0];if(n.deltaMessageReaction){return i(n.deltaMessageReaction);}else return j(n);}function i(k){var l=k.messageId,m=k.offlineThreadingId,n=k.reaction,o=k.senderId,p=k.userId,q=k.threadKey.threadFbId;return {action_type:c('MercuryActionType').REACTION_UPDATE,messageId:l,offlineThreadingId:m,reaction:decodeURIComponent(window.escape(n)),senderId:o,thread_fbid:q,userId:p};}function j(k){var l=k&&k.deltaPaymentPinProtectionStatusData,m=l&&l.threadKey&&l.threadKey.otherUserFbId,n=l&&l.isPinProtected,o=m?m.toString():'';return {action_type:c('MercuryActionType').IS_PIN_PROTECTED,thread_fbid:o,is_pin_protected:n};}f.exports={transform:h};}),null);
__d('MercurySyncDeliveryReceiptTransformer',[],(function a(b,c,d,e,f,g){'use strict';function h(i){return {delivery_receipts:[{other_user_fbid:i.threadKey.otherUserFbId?i.threadKey.otherUserFbId:'',thread_fbid:i.threadKey.threadFbId?i.threadKey.threadFbId:'',time:parseInt(i.deliveredWatermarkTimestampMs,10)}]};}f.exports={transform:h};}),null);
__d('MercurySyncMarkReadTransformer',['MercuryActionType','MercuryGlobalActionType','MessagingTag'],(function a(b,c,d,e,f,g){'use strict';function h(i){if(i.folders&&i.folders.length>0)return i.folders.map(function(j){return {action_type:c('MercuryGlobalActionType').MARK_ALL_READ,action_id:null,folder:j,timestamp:parseInt(i.watermarkTimestamp,10)};});return i.threadKeys.map(function(j){return {action_type:c('MercuryActionType').CHANGE_READ_STATUS,other_user_fbid:j.otherUserFbId,thread_fbid:j.threadFbId,mark_as_read:true,timestamp:parseInt(i.watermarkTimestamp,10),folder:c('MessagingTag').INBOX};});}f.exports={transform:h};}),null);
__d('MercurySyncMarkUnreadTransformer',['MercuryActionType','MessagingTag'],(function a(b,c,d,e,f,g){'use strict';function h(i){return i.threadKeys.map(function(j){return {action_type:c('MercuryActionType').CHANGE_READ_STATUS,other_user_fbid:j.otherUserFbId,thread_fbid:j.threadFbId,mark_as_read:false,timestamp:parseInt(i.watermarkTimestamp,10),folder:c('MessagingTag').INBOX};});}f.exports={transform:h};}),null);
__d('MercurySyncMessageDeleteTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';function h(i){return {action_type:c('MercuryActionType').DELETE_MESSAGES,message_ids:i.messageIds,other_user_fbid:i.threadKey.otherUserFbId,thread_fbid:i.threadKey.threadFbId};}f.exports={transform:h};}),null);
__d('MercurySyncPagesManagerEventTransformer',['MercuryActionType','PagesMessagingEventType'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j=JSON.parse(i.jsonBlob),k=j&&j.type;if(!k)return undefined;switch(k){case c('PagesMessagingEventType').FLAG:var l=!!(j&&j.flagData&&j.flagData.state),m={action_type:c('MercuryActionType').CHANGE_FLAG,mark_as_flag:l,mark_as_priority:null,other_user_fbid:i.threadKey.otherUserFbId,thread_fbid:i.threadKey.threadFbId};return m;case c('PagesMessagingEventType').PRIORITY_UPDATE:var n=!!(j&&j.priorityData&&j.priorityData.state),o={action_type:c('MercuryActionType').UPDATE_PRIORITY,mark_as_flag:null,mark_as_priority:n,other_user_fbid:i.threadKey.otherUserFbId,thread_fbid:i.threadKey.threadFbId};return o;default:return undefined;}}f.exports={transform:h};}),null);
__d('MercurySyncParticipantLeftGroupThreadTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={removed_participants:[c('MercuryIDs').getParticipantIDFromUserID(j.leftParticipantFbId)]};k.log_message_type=c('MercuryLogMessageType').UNSUBSCRIBE;return k;}f.exports={transform:h};}),null);
__d('MercurySyncParticipantsAddedToGroupThreadTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={added_participants:j.addedParticipants.map(function(l){return (c('MercuryIDs').getParticipantIDFromUserID(l.userFbId));})};k.log_message_type=c('MercuryLogMessageType').SUBSCRIBE;return k;}f.exports={transform:h};}),null);
__d('MercurySyncRTCEventLogTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j),l=j.messageMetadata.actorFbId,m=l===i?j.messageMetadata.threadKey.otherUserFbId:i;k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={answered:j.duration>0,callee:c('MercuryIDs').getParticipantIDFromUserID(m),caller:c('MercuryIDs').getParticipantIDFromUserID(l)};k.log_message_type=c('MercuryLogMessageType').VIDEO_CALL;return k;}f.exports={transform:h};}),null);
__d('MercurySyncReadReceiptTransformer',[],(function a(b,c,d,e,f,g){'use strict';function h(i){var j={watermark:parseInt(i.watermarkTimestampMs,10),action:parseInt(i.actionTimestampMs,10)},k=i.threadKey.otherUserFbId||i.actorFbId,l=i.threadKey.otherUserFbId||i.threadKey.threadFbId,m={roger:{}};m.roger[l]={};m.roger[l][k]=j;return m;}f.exports={transform:h};}),null);
__d('MercurySyncReplaceMessageTransformer',['MercuryActionType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){j=Object.assign({},j.newMessage,j);return Object.assign(c('MercurySyncNewMessageTransformer').transform(i,j),{action_type:c('MercuryActionType').REPLACE_MESSAGE,replaced_message_id:j.replacedMessageId});}f.exports={transform:h};}),null);
__d('MercurySyncRtcCallDataTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j=i.messageMetadata.threadKey&&i.messageMetadata.threadKey.threadFbId?i.messageMetadata.threadKey.threadFbId.toString():undefined,k=i.initiator&&i.initiator.userFbId?i.initiator.userFbId.toString():undefined;return {action_type:c('MercuryActionType').UPDATE_RTC_CALL_DATA,thread_fbid:j,call_state:i.callState,server_info_data:i.serverInfoData,initiator_fbid:k};}f.exports={transform:h};}),null);
__d('MercurySyncThreadActionTransformer',['MercuryActionType','MessagingThreadAction'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j={action_type:c('MercuryActionType').CHANGE_ARCHIVED_STATUS,thread_fbid:i.threadKey.threadFbId,other_user_fbid:i.threadKey.otherUserFbId,archived:i.action===c('MessagingThreadAction').ACTION_ARCHIVED};return j;}f.exports={transform:h};}),null);
__d('MercurySyncThreadAdminsAddToGroupTransformer',['MercuryActionType','MercuryIDs'],(function a(b,c,d,e,f,g){'use strict';function h(i){return {action_type:c('MercuryActionType').ADD_GROUP_ADMINS,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,added_admin_ids:i.addedAdmins.map(function(j){return c('MercuryIDs').getParticipantIDFromUserID(j.userFbId);})};}f.exports={transform:h};}),null);
__d('MercurySyncThreadAdminsRemovedFromGroupTransformer',['MercuryActionType','MercuryIDs'],(function a(b,c,d,e,f,g){'use strict';function h(i){return {action_type:c('MercuryActionType').REMOVE_GROUP_ADMINS,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,removed_admin_ids:i.removedAdminFbIds.map(function(j){return c('MercuryIDs').getParticipantIDFromUserID(j);})};}f.exports={transform:h};}),null);
__d('MercurySyncThreadApprovalModeTransformer',['MercuryActionType','MessengerApprovalModeTypes'],(function a(b,c,d,e,f,g){'use strict';function h(i){return {action_type:c('MercuryActionType').APPROVAL_MODE,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,approval_mode:c('MessengerApprovalModeTypes')[i.mode]};}f.exports={transform:h};}),null);
__d('MercurySyncThreadApprovalQueueTransformer',['MercuryActionType','MercuryIDs','MessengerApprovalQueueTypes'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j=c('MercuryIDs').getParticipantIDFromUserID(i.recipientFbId);return {action_type:c('MercuryActionType').APPROVAL_QUEUE,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,removed_id:i.action===c('MessengerApprovalQueueTypes').REMOVED?j:null,added_id:i.action===c('MessengerApprovalQueueTypes').REQUESTED?j:null};}f.exports={transform:h};}),null);
__d('MercurySyncThreadDeleteTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';function h(i){return i.threadKeys.map(function(j){return {action_type:c('MercuryActionType').DELETE_THREAD,other_user_fbid:j.otherUserFbId,thread_fbid:j.threadFbId};});}f.exports={transform:h};}),null);
__d('MercurySyncThreadJoinableModeTransformer',['MercuryActionType','MessengerJoinableModeType'],(function a(b,c,d,e,f,g){'use strict';function h(i){return {action_type:c('MercuryActionType').JOINABLE_MODE,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,joinable_mode:{mode:c('MessengerJoinableModeType')[i.mode],link:i.link}};}f.exports={transform:h};}),null);
__d('MercurySyncThreadMuteSettingsTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j={action_type:c('MercuryActionType').CHANGE_MUTE_SETTINGS,thread_fbid:i.threadKey.threadFbId,other_user_fbid:i.threadKey.otherUserFbId,mute_until:parseInt(i.expireTime,10)};return j;}f.exports={transform:h};}),null);
__d('MercurySyncThreadNameTransformer',['MercuryActionType','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={name:j.name};k.log_message_type=c('MercuryLogMessageType').THREAD_NAME;return k;}f.exports={transform:h};}),null);
__d('MercurySyncDispatcher',['MercuryDelayedDispatcher','MercuryGlobalActionType','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercurySyncThreadAdminsAddToGroupTransformer','MercurySyncThreadAdminsRemovedFromGroupTransformer','MercurySyncAdminTextMessageTransformer','MercurySyncClientPayloadTransformer','MercurySyncDeliveryReceiptTransformer','MercurySyncMarkReadTransformer','MercurySyncMarkUnreadTransformer','MercurySyncMessageDeleteTransformer','MercurySyncNewMessageTransformer','MercurySyncReadReceiptTransformer','MercurySyncPagesManagerEventTransformer','MercurySyncParticipantLeftGroupThreadTransformer','MercurySyncParticipantsAddedToGroupThreadTransformer','MercurySyncRTCEventLogTransformer','MercurySyncThreadDeleteTransformer','MercurySyncThreadMuteSettingsTransformer','MercurySyncThreadNameTransformer','MercurySyncThreadActionTransformer','MercurySyncReplaceMessageTransformer','MercurySyncThreadJoinableModeTransformer','MercurySyncThreadApprovalModeTransformer','MercurySyncThreadApprovalQueueTransformer','MercurySyncRtcCallDataTransformer','MercurySyncDeltaTypes','MercurySingletonProvider','MontageActions'],(function a(b,c,d,e,f,g){'use strict';h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};function h(j){this.$MercurySyncDispatcher1=j;this.$MercurySyncDispatcher2=c('MercuryDelayedDispatcher').getForFBID(this.$MercurySyncDispatcher1);this.$MercurySyncDispatcher3=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercurySyncDispatcher1);}h.prototype.process=function(j){var k=void 0;switch(j['class']){case c('MercurySyncDeltaTypes').NewMessage:k=c('MercurySyncNewMessageTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ReplaceMessage:k=c('MercurySyncReplaceMessageTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').DeliveryReceipt:k=c('MercurySyncDeliveryReceiptTransformer').transform(j);this.$MercurySyncDispatcher3.handleUpdate(k);break;case c('MercurySyncDeltaTypes').MarkRead:k=c('MercurySyncMarkReadTransformer').transform(j);var l=false;for(var m=0;m<k.length;m++){var n=k[m];if(n.action_type===c('MercuryGlobalActionType').MARK_ALL_READ)l=true;}if(l)return;this.$MercurySyncDispatcher5(k);break;case c('MercurySyncDeltaTypes').MarkUnread:k=c('MercurySyncMarkUnreadTransformer').transform(j);this.$MercurySyncDispatcher5(k);break;case c('MercurySyncDeltaTypes').ParticipantLeftGroupThread:k=c('MercurySyncParticipantLeftGroupThreadTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ParticipantsAddedToGroupThread:k=c('MercurySyncParticipantsAddedToGroupThreadTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').RTCEventLog:k=c('MercurySyncRTCEventLogTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ThreadName:k=c('MercurySyncThreadNameTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ReadReceipt:k=c('MercurySyncReadReceiptTransformer').transform(j);this.$MercurySyncDispatcher3.handleUpdate(k);break;case c('MercurySyncDeltaTypes').AdminTextMessage:k=c('MercurySyncAdminTextMessageTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').MessageDelete:k=c('MercurySyncMessageDeleteTransformer').transform(j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ThreadAction:k=c('MercurySyncThreadActionTransformer').transform(j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ThreadDelete:k=c('MercurySyncThreadDeleteTransformer').transform(j);this.$MercurySyncDispatcher5(k);break;case c('MercurySyncDeltaTypes').AdminAddedToGroupThread:k=c('MercurySyncThreadAdminsAddToGroupTransformer').transform(j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').AdminRemovedFromGroupThread:k=c('MercurySyncThreadAdminsRemovedFromGroupTransformer').transform(j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ThreadMuteSettings:k=c('MercurySyncThreadMuteSettingsTransformer').transform(j);this.$MercurySyncDispatcher5([k]);break;case c('MercurySyncDeltaTypes').PagesManagerEvent:k=c('MercurySyncPagesManagerEventTransformer').transform(j);if(!k)return;this.$MercurySyncDispatcher5([k]);break;case c('MercurySyncDeltaTypes').JoinableMode:k=c('MercurySyncThreadJoinableModeTransformer').transform(j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ApprovalMode:k=c('MercurySyncThreadApprovalModeTransformer').transform(j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ApprovalQueue:k=c('MercurySyncThreadApprovalQueueTransformer').transform(j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ClientPayload:k=c('MercurySyncClientPayloadTransformer').transform(j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').GenieMessage:k=c('MercurySyncNewMessageTransformer').transform(this.$MercurySyncDispatcher1,j.deltaNewMessage);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').MontageMessage:var o=j.newMessage.messageMetadata.actorFbId;if(o)c('MontageActions').requestUpdate(o);break;case c('MercurySyncDeltaTypes').RtcCallData:k=c('MercurySyncRtcCallDataTransformer').transform(j);this.$MercurySyncDispatcher4(k);break;default:break;}};h.prototype.$MercurySyncDispatcher4=function(j){var k=j.other_user_fbid||j.thread_fbid;this.$MercurySyncDispatcher2.handleUpdateWaitForThread({actions:[j],payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE},k);};h.prototype.$MercurySyncDispatcher5=function(j){this.$MercurySyncDispatcher3.handleUpdate({actions:j,payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercurySyncForcedFetchHandler',['Promise','MercurySingletonProvider','MercurySyncDFFDataFetcher','MercuryMessages','MercuryThreadIDMap'],(function a(b,c,d,e,f,g){'use strict';function h(k){return {getPayload:function l(){return {sequence_id:k};}};}i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};function i(k){this.$MercurySyncForcedFetchHandler1=k;this.$MercurySyncForcedFetchHandler2=c('MercuryMessages').getForFBID(this.$MercurySyncForcedFetchHandler1);this.$MercurySyncForcedFetchHandler3=c('MercuryThreadIDMap').getForFBID(this.$MercurySyncForcedFetchHandler1);this.$MercurySyncForcedFetchHandler4=c('MercurySyncDFFDataFetcher').getForFBID(this.$MercurySyncForcedFetchHandler1);}i.prototype.processMessageDFF=function(k,l,m,n){if(n){var o=l.otherUserFbId!==undefined?l.otherUserFbId.toString():l.threadFbId.toString(),p=this.$MercurySyncForcedFetchHandler3.getClientIDFromServerIDNow(o);if(p===undefined)return c('Promise').resolve(h(k));var q=this.$MercurySyncForcedFetchHandler2.getMessagesFromIDs([m]);if(q.length===0)return c('Promise').resolve(h(k));}return this.$MercurySyncForcedFetchHandler4.fetchInvalidateMessage(l.otherUserFbId,l.threadFbId,m);};i.prototype.processThreadDFF=function(k,l,m){if(m){var n=l.otherUserFbId!==undefined?l.otherUserFbId.toString():l.threadFbId.toString(),o=this.$MercurySyncForcedFetchHandler3.getClientIDFromServerIDNow(n);if(o===undefined)return c('Promise').resolve(h(k));}return this.$MercurySyncForcedFetchHandler4.fetchInvalidateThreadState(l.otherUserFbId,l.threadFbId);};i.prototype.processGlobalDFF=function(){return this.$MercurySyncForcedFetchHandler4.fetchInvalidateGlobalState();};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercurySyncDeltaHandler',['invariant','Arbiter','ChannelConstants','LogHistory','MercuryConfig','MessagingConfig','MercuryDelayedDispatcher','MercuryPayloadSource','MercurySyncConstants','MercurySyncDeltaHolder','MercurySyncDeltaTypes','MercurySyncDispatcher','MercurySyncForcedFetchHandler','MercurySyncHolesTypedLogger','MercuryServerPayloadPreprocessor','MercurySyncTopicType','MercurySingletonProvider'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('LogHistory').getInstance('mercury_sync_delta_handler'),j=c('MessagingConfig').syncFetchRetries||0;k.getForFBID=function(m){return l.getForFBID(m);};k.get=function(){return l.get();};function k(m){this.$MercurySyncDeltaHandler1=m;this.$MercurySyncDeltaHandler2=c('MercurySyncDispatcher').getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler4=c('MercurySyncForcedFetchHandler').getForFBID(this.$MercurySyncDeltaHandler1);this.__payloadPreprocessor=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercurySyncDeltaHandler1);this.__delayedDispatcher=c('MercuryDelayedDispatcher').getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler5=new (c('MercurySyncDeltaHolder'))();this.$MercurySyncDeltaHandler6=false;this.$MercurySyncDeltaHandler7=[];this.$MercurySyncDeltaHandler3=0;this.$MercurySyncDeltaHandler11=0;i.debug('constructor',JSON.stringify({fbid:this.$MercurySyncDeltaHandler1}));c('Arbiter').subscribe('MercurySyncDeltaHandler/initSeqID',function(n,o){i.debug('initSeqID',JSON.stringify(o));var p=o&&o.seqID,q=o&&o.fbid;if(!q)return;if(q!==this.$MercurySyncDeltaHandler1)return;if(p){this.$MercurySyncDeltaHandler3=p;}else this.$MercurySyncDeltaHandler3=0;this.$MercurySyncDeltaHandler12();}.bind(this));}k.prototype.$MercurySyncDeltaHandler12=function(){i.debug('setUpSubscriptionsToRealTimeUpdates',JSON.stringify({fbid:this.$MercurySyncDeltaHandler1}));this.$MercurySyncDeltaHandler9=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('delta'),function(m,n){var o=n&&n.obj&&n.obj.queue;if(o)if(o.toString()!==this.$MercurySyncDeltaHandler1)return;var p=n&&n.obj&&n.obj.delta,q=n&&n.obj&&n.obj.iseq;if(!p||!q)return;this.$MercurySyncDeltaHandler13(q,c('MercurySyncTopicType').DELTA);this.$MercurySyncDeltaHandler14(q,p);this.$MercurySyncDeltaHandler5.push(q,p);this.$MercurySyncDeltaHandler15();}.bind(this));this.$MercurySyncDeltaHandler10=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('deltaflowreject'),function(m,n){var o=n&&n.obj&&n.obj.queue;if(o)if(o.toString()!==this.$MercurySyncDeltaHandler1)return;c('Arbiter').unsubscribe(this.$MercurySyncDeltaHandler9);c('Arbiter').unsubscribe(this.$MercurySyncDeltaHandler8);c('Arbiter').unsubscribe(this.$MercurySyncDeltaHandler10);c('Arbiter').inform(c('MercurySyncConstants').ARBITER_EVENT_INVALID_STATE);}.bind(this));this.$MercurySyncDeltaHandler8=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType(c('ChannelConstants').FAKE_DFF),function(m,n){var o=n&&n.obj&&n.obj.queue;if(o&&o.toString()!==this.$MercurySyncDeltaHandler1)return;var p=n&&n.obj&&n.obj.delta;if(!p)return;this.$MercurySyncDeltaHandler7.push(p);this.$MercurySyncDeltaHandler15();}.bind(this));};k.prototype.$MercurySyncDeltaHandler15=function(){if(this.$MercurySyncDeltaHandler6)return;if(this.$MercurySyncDeltaHandler7.length>0){var m=this.$MercurySyncDeltaHandler7.shift();this.$MercurySyncDeltaHandler16(this.$MercurySyncDeltaHandler3,m);this.$MercurySyncDeltaHandler15();}var n=this.$MercurySyncDeltaHandler5.peek();if(!n)return;var o=n-this.$MercurySyncDeltaHandler3;if(o===1){var p=this.$MercurySyncDeltaHandler5.pop();if(!p)return;var q=p.seqID,r=p.delta;this.$MercurySyncDeltaHandler16(q,r);this.$MercurySyncDeltaHandler15();}else if(o>1){this.$MercurySyncDeltaHandler17();}else{this.$MercurySyncDeltaHandler5.pop();this.$MercurySyncDeltaHandler15();}};k.prototype.$MercurySyncDeltaHandler16=function(m,n){this.$MercurySyncDeltaHandler3=m;if(n['class']===c('MercurySyncDeltaTypes').ForcedFetch){i.debug('DFF',JSON.stringify(n));if(n.threadKey!==undefined&&n.messageId===undefined){this.$MercurySyncDeltaHandler18(m,n);}else if(n.threadKey!==undefined&&n.messageId!==undefined){this.$MercurySyncDeltaHandler19(m,n);}else this.$MercurySyncDeltaHandler20(m);}else this.$MercurySyncDeltaHandler2.process(n);};k.prototype.$MercurySyncDeltaHandler17=function(){i.warn('hole',JSON.stringify({$MercurySyncDeltaHandler3:this.$MercurySyncDeltaHandler3,nextSeqID:this.$MercurySyncDeltaHandler5.peek()}));var m=this.$MercurySyncDeltaHandler5.peek();!!m||h(0);var n=m-1;this.$MercurySyncDeltaHandler20(n);};k.prototype.$MercurySyncDeltaHandler21=function(m,n,o,p){!this.$MercurySyncDeltaHandler6||h(0);this.$MercurySyncDeltaHandler6=true;i.debug('_scheduleDataFetch:start',JSON.stringify({seqID:m}));n().done(function(q){i.debug('_scheduleDataFetch:success',JSON.stringify({seqID:m}));o(m,q);this.$MercurySyncDeltaHandler6=false;this.$MercurySyncDeltaHandler15();}.bind(this),function(){i.error('_scheduleDataFetch:failure',JSON.stringify({seqID:m}));p(m);this.$MercurySyncDeltaHandler6=false;this.$MercurySyncDeltaHandler15();}.bind(this));};k.prototype.$MercurySyncDeltaHandler20=function(m){this.$MercurySyncDeltaHandler21(undefined,function(){return this.$MercurySyncDeltaHandler4.processGlobalDFF();}.bind(this),function(n,o){var p=o.getPayload();this.__payloadPreprocessor.handleUpdate(p);if(p.sequence_id){i.debug('_initiateGlobalDFF:success',JSON.stringify({seqID:p.sequence_id}));this.$MercurySyncDeltaHandler3=p.sequence_id;}this.$MercurySyncDeltaHandler11=0;c('Arbiter').inform(c('MercurySyncConstants').ARBITER_EVENT_INVALID_STATE_RECOVER);}.bind(this),function(){i.error('_initiateGlobalDFF:failure','');if(this.$MercurySyncDeltaHandler11>=j){c('Arbiter').unsubscribe(this.$MercurySyncDeltaHandler9);c('Arbiter').unsubscribe(this.$MercurySyncDeltaHandler10);c('Arbiter').unsubscribe(this.$MercurySyncDeltaHandler8);c('Arbiter').inform(c('MercurySyncConstants').ARBITER_EVENT_INVALID_STATE);this.$MercurySyncDeltaHandler3=m;}else{this.$MercurySyncDeltaHandler11++;c('Arbiter').inform(c('MercurySyncConstants').ARBITER_EVENT_INVALID_STATE_RETRY);i.debug('_initiateGlobalDFF:retry','');this.$MercurySyncDeltaHandler6=false;this.$MercurySyncDeltaHandler20(m);}}.bind(this));};k.prototype.$MercurySyncDeltaHandler18=function(m,n){this.$MercurySyncDeltaHandler21(m,function(){return this.$MercurySyncDeltaHandler4.processThreadDFF(m,n.threadKey,n.isLazy);}.bind(this),function(o,p){this.__payloadPreprocessor.handleUpdate(p.getPayload());this.$MercurySyncDeltaHandler3=o;}.bind(this),function(){i.error('_initiateThreadDFF:failure',JSON.stringify(n));var o=babelHelpers['extends']({},n);delete o.threadKey;this.$MercurySyncDeltaHandler3=m-1;this.$MercurySyncDeltaHandler5.push(m,o);}.bind(this));};k.prototype.$MercurySyncDeltaHandler19=function(m,n){this.$MercurySyncDeltaHandler21(m,function(){return this.$MercurySyncDeltaHandler4.processMessageDFF(m,n.threadKey,n.messageId,n.isLazy);}.bind(this),function(o,p){var q=p.getPayload(),r=q.other_user_fbid?q.other_user_fbid:q.thread_fbid,s=[babelHelpers['extends']({},q)],t=c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE;this.__delayedDispatcher.handleUpdateWaitForThread({actions:s,payload_source:t},r);this.$MercurySyncDeltaHandler3=o;}.bind(this),function(){i.error('_initiateMessageDFF:failure',JSON.stringify(n));var o=babelHelpers['extends']({},n);delete o.messageId;this.$MercurySyncDeltaHandler3=m-1;this.$MercurySyncDeltaHandler5.push(m,o);}.bind(this));};k.prototype.$MercurySyncDeltaHandler13=function(m,n){var o=m-this.$MercurySyncDeltaHandler3;if(o!==1&&o!==0){if(!c('MercuryConfig').WWWSyncHolesLogging)return;new (c('MercurySyncHolesTypedLogger'))().setSeqID(m).setDifference(o).setTopicType(n).log();}};k.prototype.$MercurySyncDeltaHandler14=function(m,n){switch(n['class']){case c('MercurySyncDeltaTypes').NewMessage:i.debug('message_delta',JSON.stringify({seqID:m,threadKey:n.messageMetadata.threadKey,messageId:n.messageMetadata.messageId}));break;case c('MercurySyncDeltaTypes').ReadReceipt:i.debug('read_receipt_delta',JSON.stringify({seqID:m,threadKey:n.threadKey,actionTimestampMs:n.actionTimestampMs,watermarkTimestampMs:n.watermarkTimestampMs}));break;case c('MercurySyncDeltaTypes').DeliveryReceipt:i.debug('delivery_receipt_delta',JSON.stringify({seqID:m,deliveredWatermarkTimestampMs:n.deliveredWatermarkTimestampMs,messageIds:n.messageIds}));break;}};var l=new (c('MercurySingletonProvider'))(k);f.exports=k;}),null);