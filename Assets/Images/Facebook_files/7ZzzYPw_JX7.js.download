if (self.CavalryLogger) { CavalryLogger.start_js(["Ca2yy"]); }

__d("SidebarType",[],(function a(b,c,d,e,f,g){f.exports={SIDEBAR:"sidebar",BUDDYLIST:"buddylist",BUDDYLIST_NUB:"buddylist_nub"};}),null);
__d('ChatTypeaheadConstants',[],(function a(b,c,d,e,f,g){var h={USER_TYPE:'user',THREAD_TYPE:'thread',FRIEND_TYPE:'friend',NON_FRIEND_TYPE:'non_friend',FB4C_TYPE:'fb4c',PAGE_TYPE:'page',MEETING_ROOM_PAGE_TYPE:'meeting_room_page',COMMERCE_PAGE_TYPE:'commerce_page',HEADER_TYPE:'header',INTERNAL_BOT_PAGE_TYPE:'internal_bot_page',GAME_TYPE:'game'};f.exports=h;}),null);
__d('WebMessengerPermalinkConstants',['URI'],(function a(b,c,d,e,f,g){var h={ARCHIVED_PATH:'/messages/archived',BASE_PATH:'/messages',PENDING_PATH:'/messages/pending',OTHER_PATH:'/messages/other',SPAM_PATH:'/messages/spam',COMPOSE_POSTFIX_PATH:'/new',SEARCH_POSTFIX_PATH:'/search',TID_POSTFIX_PARTIAL_PATH:'/conversation-',overriddenVanities:'(archived|other|pending|spam|new|search|conversation-.*)',getURIPathForThreadID:function i(j,k){return (k||h.BASE_PATH)+h.TID_POSTFIX_PARTIAL_PATH+c('URI').encodeComponent(c('URI').encodeComponent(j));},getThreadIDFromURI:function i(j){var k=j.getPath().match(h.BASE_PATH+'(/[^/]*)*'+h.TID_POSTFIX_PARTIAL_PATH+'([^/]+)');if(k){var l=c('URI').decodeComponent(c('URI').decodeComponent(k[2]));return l;}},getURIPathForIDOrVanity:function i(j,k){if(j.match('^'+h.overriddenVanities+'$'))j='.'+j;return (k||h.BASE_PATH)+'/'+j;},getUserIDOrVanity:function i(j){var k=j.match(h.BASE_PATH+'.*/([^/]+)/?$'),l=k&&k[1],m=h.overriddenVanities;if(!l||l.match('^'+m+'$')){return false;}else if(l.match('^\\.'+m+'$')){return l.substr(1);}else return l;}};f.exports=h;}),null);
__d('ChatOpenTab',['csx','Bootloader','ChatTypeaheadConstants','ContextualThing','Event','MercuryConfig','MercuryIDs','MercuryParticipantTypes','Parent','URI','WebMessengerPermalinkConstants','WorkFocusModeController','emptyFunction','goURI','ifRequired','requireWeak'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('WorkFocusModeController').WorkFocusMode,j=null;c('requireWeak')('FantaTabsApp',function(t){return j=t;});c('requireWeak')('FantaTabsSlimApp',function(t){return j=t;});c('requireWeak')('ChatApp',function(t){return j=t;});function k(t,u){var v=t?new (c('URI'))(c('WebMessengerPermalinkConstants').getURIPathForThreadID(t)):new (c('URI'))(c('WebMessengerPermalinkConstants').BASE_PATH+c('WebMessengerPermalinkConstants').COMPOSE_POSTFIX_PATH);if(u)v.addQueryData({ref:u});c('ifRequired')('BusinessURI.brands',function(w){return c('goURI')(w(v));},function(){return c('goURI')(v);});}function l(t,u){var v=c('MercuryIDs').getThreadIDFromUserID(t);i&&i.addBypassFocusModeForThread(v);k(v,u);}function m(t,u,v){var w=c('MercuryIDs').getThreadIDFromUserID(u);i&&i.addBypassFocusModeForThread(w);l(u,v);}function n(t,u){var v=c('MercuryIDs').getThreadIDFromUserID(t);i&&i.addBypassFocusModeForThread(v);k(v,u);}function o(t,u){k(null,u);}function p(t,u,v,w){c('Event').listen(t,'click',function(x){if(s.canOpenTab()){w(u,v);return x.kill();}});}function q(t,u,v,w){c('Event').listen(t,'click',function(x){if(s.canOpenTab())w(u,v);});}function r(t){var u=c('ContextualThing').getContext(t);return u&&c('Parent').bySelector(u,"._3qw")!==null;}var s={canOpenTab:function t(){return j&&!j.isHidden();},openEmptyTab:function t(u,v,w){s.impl().openEmptyTab(u,v,w);},listenOpenEmptyTabDEPRECATED:function t(u,v){if(c('MercuryConfig').FantaTabs){p(u,null,v,this._loadAndOpenEmptyFantaTab);}else p(u,null,v,s.openEmptyTab);},openThread:function t(u,v,w,x,y){s.impl().openThreadTab(u,v,w,x,y);},openClientTab:function t(u,v,w,x,y){var z=s.impl();z.openClientTab(u,x,y);z._logChatOpenTabEvent(v,u,null,w);},listenOpenThreadDEPRECATED:function t(u,v,w){var x=c('MercuryConfig').FantaTabs?function(y,z){return this._loadAndOpenFantaTab(y,z,w);}.bind(this):s.openThread;p(u,v,w,x);},openUserTab:function t(u,v,w){s.impl().openUserTab(u,v,w);},openPageTab:function t(u,v,w){s.impl().openPageTab(u,v,w);return true;},openPageTabDEPRECATED:function t(u,v,w){if(c('MercuryConfig').FantaTabs){this._loadAndOpenFantaTab(v,c('MercuryParticipantTypes').PAGE,w);}else s.impl().openPageTab(u,v,w);return true;},listenOpenUserTabDEPRECATED:function t(u,v,w){if(!r(u)){var x=c('MercuryConfig').FantaTabs?function(y){return this._loadAndOpenFantaTab(y,c('MercuryParticipantTypes').USER,w);}.bind(this):s.openUserTab;p(u,v,w,x);}},listenOpenUserTabPersistentEventDEPRECATED:function t(u,v,w){if(!r(u)){var x=c('MercuryConfig').FantaTabs?function(y){return this._loadAndOpenFantaTab(y,c('MercuryParticipantTypes').USER,w);}.bind(this):s.openUserTab;q(u,v,w,x);}},listenOpenPageTabDEPRECATED:function t(u,v,w,x){if(!r(u)){var y=c('MercuryConfig').FantaTabs?function(z){return this._loadAndOpenFantaTab(z,c('MercuryParticipantTypes').PAGE,x);}.bind(this):function(z){return s.openPageTab(w,z,x);};p(u,v,x,y);}},listenOpenPageTabPersistentEventDEPRECATED:function t(u,v,w,x){if(!r(u)){var y=c('MercuryConfig').FantaTabs?function(z){return this._loadAndOpenFantaTab(z,c('MercuryParticipantTypes').PAGE,x);}.bind(this):function(z){return s.openPageTab(w,z,x);};q(u,v,x,y);}},openTabByType:function t(u,v,w){if(v===c('ChatTypeaheadConstants').THREAD_TYPE){if(u){this.openThread(u,w);}else this.openEmptyTab(null,w);}else if(v===c('ChatTypeaheadConstants').MEETING_ROOM_PAGE_TYPE){var x=c('MercuryIDs').getUserIDFromThreadID(u);c('goURI')('/'+x);}else if(!v||v===c('MercuryParticipantTypes').FRIEND||v===c('ChatTypeaheadConstants').FRIEND_TYPE||v===c('ChatTypeaheadConstants').PAGE_TYPE||v===c('ChatTypeaheadConstants').USER_TYPE){if(c('MercuryIDs').isValidThreadID(u))u=c('MercuryIDs').getUserIDFromThreadID(u);this.openUserTab(u,w);}else this.openThread(u,w);},impl:function t(){if(j&&j.isInitialized()&&!j.isHidden()&&j.chatOpenTabImpl){return j.chatOpenTabImpl;}else return {openClientTab:k,openUserTab:l,openEmptyTab:o,openThreadTab:n,openPageTab:m,_logChatOpenTabEvent:c('emptyFunction')};},_loadAndOpenFantaTab:function t(u,v,w){c('Bootloader').loadModules(["ChatOpenTabEventLogger","FantaTabActions"],function(x,y){if(v===c('MercuryParticipantTypes').USER){var z=c('MercuryIDs').getThreadIDFromUserID(u);y.openTab(z);x.logUser(w,u);}else if(v===c('MercuryParticipantTypes').PAGE){var aa=c('MercuryIDs').getThreadIDFromUserID(u);y.openTab(aa);x.logPage(w,u);}else{y.openTab(u);x.log(w,u);}},'ChatOpenTab');},_loadAndOpenEmptyFantaTab:function t(){c('Bootloader').loadModules(["ChatOpenTabEventLogger","FantaTabActions","MercuryThreads"],function(u,v,w){var x=w.get().createNewLocalThreadGenerateID();v.openTab(x);u.log('EmptyTab');},'ChatOpenTab');}};f.exports=s;}),null);
__d('ChatOpenTabEventLogger',['Banzai','ChatImpressionLogger','ChatTypeaheadConstants','MercuryIDs','MercuryParticipantTypes'],(function a(b,c,d,e,f,g){'use strict';var h='messaging_tracking',i={log:function j(k,l,m,n){var o={referrer:k||'',message_thread_id:l,message_view:'chat',timestamp_send:Date.now(),message_target_ids:null};if(m!==undefined)o.message_target_ids=[m];c('ChatImpressionLogger').logImpression(k,m,n);c('Banzai').post(h,o,{delay:0,retry:true});var p=c('MercuryIDs').getUserIDFromThreadID(String(l));c('Banzai').post('page_message_button_click',{page_id:p,ref:k});},logUser:function j(k,l,m){var n=c('MercuryIDs').getThreadIDFromUserID(l);this.log(k,n,l,m);},logPage:function j(k,l){this.logUser(k,l);},logByType:function j(k,l,m){if(k===c('ChatTypeaheadConstants').THREAD_TYPE){this.log(l,m);}else if(k===c('ChatTypeaheadConstants').MEETING_ROOM_PAGE_TYPE){var n=c('MercuryIDs').getUserIDFromThreadID(m);this.log(l,m,n);}else if(!k||k===c('MercuryParticipantTypes').FRIEND||k===c('ChatTypeaheadConstants').FRIEND_TYPE||k===c('ChatTypeaheadConstants').PAGE_TYPE||k===c('ChatTypeaheadConstants').USER_TYPE){var o=void 0;if(c('MercuryIDs').isValidThreadID(m))o=c('MercuryIDs').getUserIDFromThreadID(m);this.log(l,m,o);}else this.log(l,m);}};f.exports=i;}),null);
__d('ChatSidebarPreloadStore',['ChatSidebarData','InitialChatFriendsList'],(function a(b,c,d,e,f,g){'use strict';var h={onLoaded:function i(j){if(c('ChatSidebarData').AsyncDataPreloader){c('ChatSidebarData').AsyncDataPreloader.onLoaded(function(k){var l=k.list,m=k.groups,n=k.shortProfiles,o=k.nearby;return (j({buddies:l,groups:m,shortProfiles:n,nearby:o,profiles:[]}));});}else if(c('ChatSidebarData').WebGraphQLPreloader){c('ChatSidebarData').WebGraphQLPreloader.onLoaded(function(k){var l=k.buddies,m=k.groups,n=k.profiles,o=k.nearby;return (j({buddies:l,groups:m,profiles:n,nearby:o,shortProfiles:{}}));});}else j({buddies:c('InitialChatFriendsList').list||[],groups:c('InitialChatFriendsList').groups||[],shortProfiles:c('InitialChatFriendsList').shortProfiles||{},nearby:c('InitialChatFriendsList').nearby||[],profiles:[]});}};f.exports=h;}),null);
__d('ChatProfileStore',['ChatSidebarPreloadStore'],(function a(b,c,d,e,f,g){'use strict';var h={},i={init:function j(){c('ChatSidebarPreloadStore').onLoaded(function(k){var l=k.profiles;return l.forEach(function(m){var n=new Date(),o=m.birthdate&&n.getDate()===m.birthdate.day&&n.getMonth()+1===m.birthdate.month,p=m.profile_picture&&m.profile_picture.uri?m.profile_picture.uri:null;h[m.id]={id:m.id,is_birthday:o,thumbSrc:p,name:m.name,is_messenger_only:!!m.is_messenger_only};});});},get:function j(k){return h[k];}};f.exports=i;}),null);
__d('OrderedFriendsList',['AvailableListConstants','ChatProfileStore','ChatSidebarPreloadStore','MercuryIDs','PresenceStatus','SearchableEntry','ShortProfiles','WorkModeConfig','createArrayFromMixed','isValidUniqueID'],(function a(b,c,d,e,f,g){'use strict';var h=null,i={},j=[],k={};function l(r){r=String(r);return c('MercuryIDs').isValid(r)?r:c('MercuryIDs').getParticipantIDFromUserID(r);}function m(r,s){var t=c('createArrayFromMixed')(r);s(t.filter(function(u){var v=c('ShortProfiles').getNow(u);return !v||p(v)||v.is_nonfriend_messenger_contact;}));}function n(r){h=[];var s=0;r.forEach(function(t){var u=t.slice(0,-2),v=t.slice(-1);if(c('PresenceStatus').get(u)==v){h[s]=u;i[u]=s++;}});}function o(r){var s=0;r.forEach(function(t){var u=t.slice(0,-2),v=t.slice(-1);if(v==c('AvailableListConstants').ACTIVE){j[s]=u;k[u]=s++;}});}function p(r){return r.type==='friend'||c('WorkModeConfig').is_work_user&&r.type==='fb4c';}var q={contains:function r(s){return s in i;},getList:function r(s){if(h&&h.length){m(h,s);return;}c('ChatSidebarPreloadStore').onLoaded(function(t){var u=t.buddies;n(u);m(h,s);});},getSearchableEntries:function r(s,t){q.getList(function(u){c('ChatSidebarPreloadStore').onLoaded(function(v){var w=v.groups;c('ShortProfiles').getMulti(u.slice(0,s),function(x){var y=[];for(var z in x)y.push(q.normalizeProfileEntry(x[z],z));var aa=w.map(q.normalizeThreadEntry);t(y.concat(aa).filter(function(ba){return !!ba;}).sort(function(ba,ca){return ba.getOrder()-ca.getOrder();}));});});});},normalizeProfileEntry:function r(s,t){var u=s.searchTokens||[],v=s.name,w=null;return new (c('SearchableEntry'))({uniqueID:s.id||t,keywordString:u.join(' '),order:q.getRank(s.id||t),photo:s.thumbSrc,title:v,subtitle:w,type:s.type,uri:s.uri,auxiliaryData:{isMessengerUser:s.is_messenger_user}});},normalizeThreadEntry:function r(s,t){var u=s.mercury_thread,v=s.participants_to_render.map(function(aa){return babelHelpers['extends']({},aa,{id:l(aa.id)});});u.participants=u.participants.map(l);var w=s.text,x=null;if(!w)w=u.name;var y=v.map(function(aa){return aa.name;}).join(', ');if(!w){w=y;}else x=y;var z=s.uid;if(!w||!c('isValidUniqueID')(z))return null;return new (c('SearchableEntry'))({uniqueID:z,order:t,photo:u.image_src,title:w,subtitle:x,type:'thread',auxiliaryData:{participantsToRender:v,thread:u}});},getRank:function r(s){if(s in i)return i[s];return h?h.length:0;},getActiveList:function r(s){if(j.length>0){s(j);return;}q.getList(function(t){return s(t);});},getActiveRank:function r(s){return s in k?k[s]:q.getRank(s);}};(function(){c('ChatSidebarPreloadStore').onLoaded(function(r){var s=r.buddies,t=r.shortProfiles;c('ShortProfiles').setMulti(t);o(s);n(s);});c('ChatProfileStore').init();})();f.exports=q;}),null);
__d('ChatPerfTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:ChatPerfLoggerConfig',this.$ChatPerfTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:ChatPerfLoggerConfig',this.$ChatPerfTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$ChatPerfTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$ChatPerfTypedLogger1=babelHelpers['extends']({},this.$ChatPerfTypedLogger1,j);return this;};h.prototype.setDuration=function(j){this.$ChatPerfTypedLogger1.duration=j;return this;};h.prototype.setEndpoint=function(j){this.$ChatPerfTypedLogger1.endpoint=j;return this;};h.prototype.setEvent=function(j){this.$ChatPerfTypedLogger1.event=j;return this;};h.prototype.setTabsOpen=function(j){this.$ChatPerfTypedLogger1.tabs_open=j;return this;};var i={duration:true,endpoint:true,event:true,tabs_open:true};f.exports=h;}),null);
__d('ChatPerfInstrumentation',['Promise','BaseEventEmitter','ChatPerfEvent','ChatPerfTypedLogger','PresenceState','emptyFunction','performanceAbsoluteNow'],(function a(b,c,d,e,f,g){'use strict';var h=void 0,i=c('PresenceState').getInitial()&&c('PresenceState').getInitial().t2?c('PresenceState').getInitial().t2.length:null,j={_startTime:(Number),_sidebarStartTime:(Number),init:function k(){this._startTime=c('performanceAbsoluteNow')();return new (c('Promise'))(function(l){return l();});},initDivebar:function k(){this._sidebarStartTime=c('performanceAbsoluteNow')();},_log:function k(event,l){var m=c('performanceAbsoluteNow')()-(l||this._startTime);if(h)h.emit(event,m);var n=new (c('ChatPerfTypedLogger'))();n.setEvent(event).setDuration(m);if(i!==null)n.setTabsOpen(i);n.log();},addPerfTimingsListener:function k(event,l){if(!h)h=new (c('BaseEventEmitter'))();return h.once(event,l);},logInitStores:function k(){this.logInitStores=c('emptyFunction');this._log(c('ChatPerfEvent').CHAT_INIT_STORES);},logInitData:function k(){this.logInitData=c('emptyFunction');this._log(c('ChatPerfEvent').CHAT_INIT_DATA);},logInitUI:function k(){this.logInitUI=c('emptyFunction');this._log(c('ChatPerfEvent').CHAT_INIT_UI);},logInitSound:function k(){this.logInitSound=c('emptyFunction');this._log(c('ChatPerfEvent').CHAT_INIT_SOUND);},logDisplayDone:function k(){this.logDisplayDone=c('emptyFunction');this._log(c('ChatPerfEvent').CHAT_DISPLAY_DONE);},logTTI:function k(){this.logTTI=c('emptyFunction');this._log(c('ChatPerfEvent').TTI);},logCHAT_CONVERSATION_TTI:function k(){this.logCHAT_CONVERSATION_TTI=c('emptyFunction');this._log(c('ChatPerfEvent').CHAT_CONVERSATION_TTI);},logSIDEBAR_FROM_CLIENT_TTI:function k(){this.logSIDEBAR_FROM_CLIENT_TTI=c('emptyFunction');this._log(c('ChatPerfEvent').SIDEBAR_FROM_CLIENT_TTI,this._sidebarStartTime);},logSIDEBAR_DISPLAY_DONE:function k(){this.logSIDEBAR_DISPLAY_DONE=c('emptyFunction');this._log(c('ChatPerfEvent').SIDEBAR_DISPLAY_DONE,this._sidebarStartTime);}};f.exports=j;}),null);
__d('FantaDispatcher',['ExplicitRegistrationDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('ExplicitRegistrationDispatcher'));i=h&&h.prototype;function j(){h.apply(this,arguments);}f.exports=new j({strict:false});}),null);
__d('FantaTabActions',['Bootloader','FantaDispatcher','MercuryConfig','URI','WebMessengerPermalinkConstants','goURI','ifRequired','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({BLUR_TAB:null,CLOSE_ALL_TABS:null,CLOSE_AND_TAB_NEXT:null,CLOSE_TAB:null,FOCUS_NEXT_TAB:null,FOCUS_PREVIOUS_TAB:null,FOCUS_TAB:null,LOAD_FROM_DATA:null,MERCURY_REGISTER_TAB_FOCUS_DEPRECATED:null,MINIMIZE_ALL_TABS:null,MINIMIZE_TAB:null,OPEN_TAB:null,REPLACE_TAB:null,SET_ALLOWED_RAISED_TABS:null,SET_MESSAGE_COUNT:null,UNMINIMIZE_TAB:null});function i(k){var l=k?new (c('URI'))(c('WebMessengerPermalinkConstants').getURIPathForThreadID(k)):new (c('URI'))(c('WebMessengerPermalinkConstants').BASE_PATH+c('WebMessengerPermalinkConstants').COMPOSE_POSTFIX_PATH);c('ifRequired')('BusinessURI.brands',function(m){return c('goURI')(m(l));},function(){return c('goURI')(l);});}var j={Types:h,openTab:function k(l){this.dispatchOrBootloadGetMessages(function(){c('FantaDispatcher').dispatch({type:h.OPEN_TAB,tabID:l});c('ifRequired')('FantaTabsApp',function(m){this._tryLoadSlimApp(l);}.bind(this),function(){this._tryLoadSlimApp(l,function(){return i(l);});}.bind(this));}.bind(this));},_tryLoadSlimApp:function k(l,m){c('ifRequired')('FantaTabsSlimApp',function(n){c('ifRequired')('FantaAppStore',function(){},function(){n.getPumpedUp(function(){c('FantaDispatcher').dispatch({type:h.OPEN_TAB,tabID:l});});});},function(){return m&&m(l);});},registerTabFocusDeprecated:function k(l,m,n,o){c('FantaDispatcher').dispatch({type:h.MERCURY_REGISTER_TAB_FOCUS_DEPRECATED,tabID:l,focusCallback:m,blurCallback:n,focusOnMountDEPRECATED:o});},replaceTab:function k(l,m){c('FantaDispatcher').dispatch({type:h.REPLACE_TAB,tabID:l,newTabID:m});},minimizeTab:function k(l){c('FantaDispatcher').dispatch({type:h.MINIMIZE_TAB,tabID:l});},minimizeAllTabs:function k(){c('FantaDispatcher').dispatch({type:h.MINIMIZE_ALL_TABS});},unminimizeTab:function k(l){c('FantaDispatcher').dispatch({type:h.UNMINIMIZE_TAB,tabID:l});},closeTab:function k(l){c('FantaDispatcher').dispatch({type:h.CLOSE_TAB,tabID:l});},closeAllTabs:function k(){c('FantaDispatcher').dispatch({type:h.CLOSE_ALL_TABS});},closeAndTabNext:function k(l){c('FantaDispatcher').dispatch({type:h.CLOSE_AND_TAB_NEXT,tabID:l});},focusTab:function k(l){c('FantaDispatcher').dispatch({type:h.FOCUS_TAB,tabID:l});},blurTab:function k(l){c('FantaDispatcher').dispatch({type:h.BLUR_TAB,tabID:l});},setAllowedRaisedTabs:function k(l){c('FantaDispatcher').dispatch({type:h.SET_ALLOWED_RAISED_TABS,allowedRaisedTabs:l});},setMessageCount:function k(l,m){c('FantaDispatcher').dispatch({type:h.SET_MESSAGE_COUNT,threadID:l,messageCount:m});},loadFromData:function k(l){this.dispatchOrBootloadGetMessages(function(){c('FantaDispatcher').dispatch({type:h.LOAD_FROM_DATA,tabData:l});});},focusNextTab:function k(event){c('FantaDispatcher').dispatch({type:h.FOCUS_NEXT_TAB,event:event});},focusPreviousTab:function k(event){c('FantaDispatcher').dispatch({type:h.FOCUS_PREVIOUS_TAB,event:event});},dispatchOrBootloadGetMessages:function k(l){if(c('MercuryConfig').FantaTabView){c('ifRequired')('FantaReducersGetMessages',function(){l();},function(){c('ifRequired')('FantaAppStore',function(m){c('Bootloader').loadModules(["FantaReducersGetMessages"],function(n){m.addReducers(n);l();},'FantaTabActions');},function(){l();});});}else l();}};f.exports=j;}),null);
__d('FBRTCDispatcher',['Dispatcher_DEPRECATED'],(function a(b,c,d,e,f,g){'use strict';f.exports=new (c('Dispatcher_DEPRECATED'))();}),null);
__d('ChatSidebarActionTypes',['keyMirror'],(function a(b,c,d,e,f,g){'use strict';f.exports=c('keyMirror')({INIT:null,LOADED:null,SET_ENABLED:null,SHOW:null});}),null);
__d("ChatSidebarHideReason",[],(function a(b,c,d,e,f,g){var h={VIEWPORT_INCAPABLE:0,LOW_FRIEND_COUNT:1,NOT_ENABLED:2};f.exports=h;}),null);
__d('ChatSidebarStore',['ChatDispatcher','ChatOptionsInitialData','ChatSidebarActionTypes','FluxStore','SidebarType','performanceAbsoluteNow'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('FluxStore'));i=h&&h.prototype;function j(){i.constructor.call(this,c('ChatDispatcher'));this.$ChatSidebarStore2={initialized:false,initTime:c('performanceAbsoluteNow')(),loaded:false,enabled:!!c('ChatOptionsInitialData').sidebar_mode,visible:null};this.$ChatSidebarStore1={};}j.prototype.__onDispatch=function(k){var l=k.type;this.$ChatSidebarStore1=babelHelpers['extends']({},this.$ChatSidebarStore2);switch(l){case c('ChatSidebarActionTypes').INIT:if(!this.$ChatSidebarStore1.initialized)this.$ChatSidebarStore2.initTime=c('performanceAbsoluteNow')();this.$ChatSidebarStore2.initialized=true;break;case c('ChatSidebarActionTypes').LOADED:this.$ChatSidebarStore2.loaded=true;break;case c('ChatSidebarActionTypes').SHOW:this.$ChatSidebarStore2.visible=k.sidebarType;break;case c('ChatSidebarActionTypes').SET_ENABLED:this.$ChatSidebarStore2.enabled=k.enabled;this.$ChatSidebarStore2.visible=k.sidebarType;break;}for(var m in this.$ChatSidebarStore2)if(this.$ChatSidebarStore2.hasOwnProperty(m))if(this.$ChatSidebarStore2[m]!==this.$ChatSidebarStore1[m]){this.__emitChange();break;}};j.prototype.getPrevState=function(){return this.$ChatSidebarStore1;};j.prototype.getState=function(){return this.$ChatSidebarStore2;};j.prototype.isInitialized=function(){return this.$ChatSidebarStore2.initialized;};j.prototype.isLoaded=function(){return this.$ChatSidebarStore2.loaded;};j.prototype.isEnabled=function(){return this.$ChatSidebarStore2.enabled;};j.prototype.getInitTime=function(){return this.$ChatSidebarStore2.initTime;};j.prototype.getVisibleType=function(){return this.$ChatSidebarStore2.visible;};f.exports=new j();}),null);
__d('ChatSidebarVisibility',['ChatConfig','ChatSidebarHideReason','ChatSidebarStore','OrderedFriendsList','SidebarType','getViewportDimensions'],(function a(b,c,d,e,f,g){'use strict';var h=c('ChatConfig').get('sidebar.min_friends'),i=c('ChatConfig').get('sidebar.minimum_width'),j={getViewport:function k(){return c('getViewportDimensions').withoutScrollbars();},shouldShowSidebar:function k(l,m){j.shouldShowSidebarIgnoreEnabled(l,function(n,o){var p=c('ChatSidebarStore').isEnabled();m(n&&p,p?o:o.concat([c('ChatSidebarHideReason').NOT_ENABLED]));});},shouldShowSidebarIgnoreEnabled:function k(l,m){c('OrderedFriendsList').getActiveList(function(n){var o=l||j.getViewport(),p=o.width>i,q=n.length<=h,r=true,s=[];if(!p){r=false;s.push(c('ChatSidebarHideReason').VIEWPORT_INCAPABLE);}if(q){r=false;s.push(c('ChatSidebarHideReason').LOW_FRIEND_COUNT);}m(r,s);});},isSidebarVisible:function k(){return c('ChatSidebarStore').getVisibleType()===c('SidebarType').SIDEBAR;},isBuddyListVisible:function k(){return c('ChatSidebarStore').getVisibleType()===c('SidebarType').BUDDYLIST;}};f.exports=j;}),null);
__d('ChatSidebarActions',['ChatDispatcher','ChatSidebarActionTypes','ChatSidebarVisibility','SidebarType'],(function a(b,c,d,e,f,g){'use strict';var h={init:function i(){c('ChatDispatcher').dispatch({type:c('ChatSidebarActionTypes').INIT});},loaded:function i(){c('ChatDispatcher').dispatch({type:c('ChatSidebarActionTypes').LOADED});},disable:function i(){c('ChatDispatcher').dispatch({type:c('ChatSidebarActionTypes').SET_ENABLED,enabled:false,sidebarType:c('SidebarType').BUDDYLIST});},enable:function i(j){c('ChatDispatcher').dispatch({type:c('ChatSidebarActionTypes').SET_ENABLED,enabled:true,sidebarType:j});},show:function i(j){c('ChatDispatcher').dispatch({type:c('ChatSidebarActionTypes').SHOW,sidebarType:j});}};f.exports=h;}),null);
__d('ChatSidebar',['csx','Arbiter','AsyncRequest','Bootloader','ChatDispatcher','ChatImpressionLogger','ChatPerfInstrumentation','ChatSidebarActions','ChatSidebarHideReason','ChatSidebarStore','ChatSidebarVisibility','CSS','DOM','DOMDimensions','Event','LogHistory','JSLogger','KeyEventController','LitestandClassicPlaceHolders','Parent','PresencePrivacy','PresenceUtil','ScrollableArea','SidebarType','Style','TimeSlice','ViewportBounds','debounce','emptyFunction','ge'],(function a(b,c,d,e,f,g,h){var i,j,k,l,m,n,o=false,p,q=true,r=null,s=c('LogHistory').getInstance('chat_sidebar');function t(){return c('ChatSidebarStore').getVisibleType()===c('SidebarType').SIDEBAR;}function u(ea,fa){if(!t())return;if(fa){m.hide();}else{m.show();x();}}function v(){return !t()||!l?0:206;}function w(){c('CSS').removeClass(document.documentElement,'sidebarMode');if(c('ChatSidebarStore').isInitialized()){m.hide();c('CSS').hide(l);c('CSS').hide(k);}c('Arbiter').inform('sidebar/visibility',false,c('Arbiter').BEHAVIOR_STATE);c('Arbiter').inform('reflow');c('ViewportBounds').inform('change');}function x(ea){if(!ea||ea.width!==r.width)c('ChatSidebarVisibility').shouldShowSidebar(r,function(fa,ga){c('ChatSidebarActions').show(fa?c('SidebarType').SIDEBAR:c('SidebarType').BUDDYLIST);});if(!ea||ea.height!==r.height)aa();}function y(ea){var fa=r||c('ChatSidebarVisibility').getViewport(),ga=fa.height;ea.forEach(function(ha){if(ha&&ha!==i&&!c('CSS').hasClass(ha,'hidden_elem'))ga-=c('DOMDimensions').getElementDimensions(ha).height;});if(p)ga-=p.getOffset();if(n)ga-=c('DOMDimensions').getElementDimensions(n).height;return Math.max(0,ga);}function z(){c('CSS').show(k);c('CSS').show(l);c('CSS').addClass(document.documentElement,'sidebarMode');m.show();s.log('sidebar_show','{}');c('Arbiter').inform('sidebar/visibility',true,c('Arbiter').BEHAVIOR_STATE);c('LitestandClassicPlaceHolders').destroy('sidebar');c('ViewportBounds').inform('change');if(!o){aa();o=true;}}function aa(){if(!t())return;var ea=da.getBodyHeight(),fa=m.getItemHeight(),ga=8;c('Style').set(i,'height',ea+'px');var ha=Math.floor((ea-ga)/fa);m.setNumTopFriends(ha,q);q=false;var ia=Math.floor(ea-ga);c('Arbiter').inform('sidebar/resized',ia,c('Arbiter').BEHAVIOR_STATE);c('Arbiter').inform('reflow');}function ba(){new (c('AsyncRequest'))('/ajax/chat/settings.php').setHandler(c('emptyFunction')).setErrorHandler(c('emptyFunction')).setData({sidebar_mode:c('ChatSidebarStore').isEnabled(),window_id:c('PresenceUtil').getSessionID()}).setAllowCrossPageTransition(true).send();}function ca(){c('ChatSidebarVisibility').shouldShowSidebar(null,function(ea,fa){var ga=true;fa.forEach(function(ia){if(ia===null)return;switch(ia){case c('ChatSidebarHideReason').NOT_ENABLED:s.log('state_not_enabled','{}');ga=false;break;case c('ChatSidebarHideReason').LOW_FRIEND_COUNT:s.log('state_not_shown_num_friends','{}');ga=false;break;case c('ChatSidebarHideReason').VIEWPORT_INCAPABLE:ga=false;}});var ha=ga?'state_shown':'state_not_shown';s.log(ha,'{}');c('ChatPerfInstrumentation').logSIDEBAR_FROM_CLIENT_TTI();});}var da={init:function ea(fa,ga){da.init=c('emptyFunction');c('ChatPerfInstrumentation').initDivebar();c('ChatDispatcher').explicitlyRegisterStore(c('ChatSidebarStore'));c('ChatSidebarActions').loaded();l=fa;m=ga;i=c('DOM').find(fa,'div.fbChatSidebarBody');k=c('DOM').find(fa,"._51x_");n=c('DOM').find(fa,"._5qqe");c('Event').listen(window,'resize',function(){var ha=babelHelpers['extends']({},r)||{};this._cacheViewport();x(ha);}.bind(this));c('KeyEventController').registerKey('q',function(event){if(c('ChatSidebarStore').getVisibleType()!==c('SidebarType').SIDEBAR)return;if(!j){var ha=c('DOM').scry(fa,"._3rhb input");if(ha.length>0)j=ha[0];}if(j){j.focus();event.prevent();}});m.setScrollContainer(c('Parent').byClass(m.getRoot(),'uiScrollableAreaWrap'));m.subscribe(['render','show','hide'],c('debounce')(function(ha){var ia=c('ScrollableArea').getInstance(m.getRoot());ia&&ia.adjustGripper();}));c('Arbiter').subscribe('chat/option-changed',function(ha,ia){if(ia.name==='hide_groups')aa();});c('Arbiter').subscribe(['AppsDivebar/show-apps','AppsDivebar/hide-apps','Ticker/resized','PagesDivebar/show-pages','PagesDivebar/hide-pages'],aa);c('Arbiter').subscribe('sidebar/typeahead/active',u);c('PresencePrivacy').subscribe('privacy-user-presence-changed',x);c('ChatSidebarStore').addListener(function(){var ha=c('ChatSidebarStore').getState(),ia=c('ChatSidebarStore').getPrevState();if(ha.visible!==ia.visible)switch(ha.visible){case c('SidebarType').SIDEBAR:z();break;case c('SidebarType').BUDDYLIST:w();break;}if(ha.enabled!==ia.enabled)ba();});this._cacheViewport();x();c('ChatImpressionLogger').init(m);c('ViewportBounds').addPersistentRight(v);c('Arbiter').inform('sidebar/initialized',da,c('Arbiter').BEHAVIOR_STATE);c('ChatSidebarActions').init();ca();c('ChatPerfInstrumentation').logSIDEBAR_DISPLAY_DONE();},ensureLoaded:function ea(){if(!c('ChatSidebarStore').isEnabled())return;if(c('ChatSidebarStore').isLoaded())return;if(c('ge')('pagelet_sidebar'))return;c('Bootloader').loadModules(["UIPagelet"],function(fa){var ga=c('DOM').create('div',{id:'pagelet_sidebar'});c('DOM').appendContent(document.body,ga);fa.loadFromEndpoint('SidebarPagelet','pagelet_sidebar');},'ChatSidebar');c('ChatSidebarActions').loaded();},hide:function ea(){if(!c('ChatSidebarStore').isEnabled())return;c('ChatSidebarActions').disable();},unhide:function ea(){if(c('ChatSidebarStore').isEnabled())return;c('ChatSidebarVisibility').shouldShowSidebarIgnoreEnabled(null,function(fa,ga){c('ChatSidebarActions').enable(fa?c('SidebarType').SIDEBAR:c('SidebarType').BUDDYLIST);});},_cacheViewport:function ea(){r=c('ChatSidebarVisibility').getViewport();},getBodyHeight:function ea(){return y(Array.from(k.childNodes));}};c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(ea,fa){fa.sidebar_visible=t();});da.init=c('TimeSlice').guard(da.init,'ChatSidebar init');f.exports=da;}),null);