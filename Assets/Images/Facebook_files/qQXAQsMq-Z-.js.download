if (self.CavalryLogger) { CavalryLogger.start_js(["24Qi\/"]); }

__d("MessengerPlatformInterfaceType",[],(function a(b,c,d,e,f,g){f.exports={UNKNOWN_INTERFACE:0,MESSENGER_INTERFACE:1,FB_INTERFACE:2};}),null);
__d('UFIAddCommentAction',['UFIAddCommentActionType'],(function a(b,c,d,e,f,g){'use strict';var h={cancel:function i(j){return {type:c('UFIAddCommentActionType').CANCEL,instanceID:j.instanceid,ftentidentifier:j.ftentidentifier};},changeContent:function i(j,k,l){return {type:c('UFIAddCommentActionType').CHANGE_CONTENT,instanceID:j.instanceid,ftentidentifier:j.ftentidentifier,text:k,replyFBID:l};},retrySubmit:function i(j,k){return {type:c('UFIAddCommentActionType').RETRY_SUBMIT,instanceID:j.instanceid,ftentidentifier:j.ftentidentifier,comment:k};},submitEdit:function i(j,k,l,m){return {type:c('UFIAddCommentActionType').SUBMIT_EDIT,instanceID:j.instanceid,ftentidentifier:j.ftentidentifier,comment:k,commentData:l,target:m};},submitNew:function i(j,k,l,m){return {type:c('UFIAddCommentActionType').SUBMIT_NEW,instanceID:j.instanceid,ftentidentifier:j.ftentidentifier,comment:k,target:l,replyCommentID:m,timestamp:Date.now()};}};f.exports=h;}),null);
__d('UFINewCommentNotifier',['Arbiter','UFIFeedbackTargets','UFIUserActions','UFIUIEvents'],(function a(b,c,d,e,f,g){'use strict';var h={onNewComment:function i(j,k,l,m,n,o){c('UFIUserActions').addComment(k.ftentidentifier,l.visibleValue,l.encodedValue,{source:k.source,ufiinstanceid:k.instanceid,target:m,replyid:n,rootid:k.rootid,attachedphoto:l.attachedPhoto,attachedvideo:l.attachedVideo,attachedsticker:l.attachedSticker,feedcontext:k.feedcontext,timestamp:o,feedbackReferrer:k.feedbackReferrer,isMarkdown:l.isMarkdown,fluentContentToken:k.fluentContentToken,isLiveVOD:k.isLiveVOD,islivestreaming:k.islivestreaming,photoTextTagID:k.photoTextTagID,isPrivate:l.isPrivate,isPhotoTag:k.isPhotoTag,photoFBID:k.photoFBID,photoTagX:k.photoTagX,photoTagY:k.photoTagY,attachedshareurl:l.attachedShareURL,isBroadcasterUFI:k.isBroadcasterUFI});c('UFIFeedbackTargets').getFeedbackTarget(k.ftentidentifier,function(p){if(j)c('Arbiter').inform(c('UFIUIEvents').Comment,{ft_id:p.entidentifier,target:m,form:j,isinverted:p.isranked||k.islivestreaming,isPhotoTag:k.isPhotoTag,photoTextTagID:k.photoTextTagID,photoTagX:k.photoTagX,photoTagY:k.photoTagY});});}};f.exports=h;}),null);
__d('UFICallbackStore',['FluxStore'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('FluxStore'));i=h&&h.prototype;j.prototype.__onDispatch=function(k){var l=k.type,m=babelHelpers.objectWithoutProperties(k,['type']);this.__emitter.emit(l,m);};j.prototype.on=function(k,l){return this.__emitter.addListener(k,l);};j.prototype.remove=function(){this.__emitter.removeAllListeners();};function j(){h.apply(this,arguments);}f.exports=j;}),null);
__d('UFIActorIconContainer.react',['cx','Image.react','React','ShortProfiles','UFIBusinessActorIcon.react','XUISpinner.react','joinClasses'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('React').PropTypes,l=c('React').createElement(c('XUISpinner.react'),{size:'large'});i=babelHelpers.inherits(m,c('React').Component);j=i&&i.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=j.constructor).call.apply(n,[this].concat(q)),this.state={actor:null},this.$UFIActorIconContainer1=function(){c('ShortProfiles').get(this.props.actorID,function(s){return this.setState({actor:s});}.bind(this));}.bind(this),o;}m.prototype.componentWillMount=function(){this.$UFIActorIconContainer1();};m.prototype.componentDidUpdate=function(n){if(this.props.actorID!==n.actorID)this.$UFIActorIconContainer1();};m.prototype.render=function(){var n=this.state.actor;if(!n)return l;var o=c('joinClasses')("img UFIActorImage _54ru",this.props.className);return (n.isBusinessPersona?c('React').createElement(c('UFIBusinessActorIcon.react'),{classNames:o,firstName:n.firstName,lastName:n.lastName,textClassNames:"UFIBusinessActorIconText"}):c('React').createElement(c('Image.react'),{alt:n.name,className:o,src:n.thumbSrc}));};m.propTypes={actorID:k.string.isRequired,className:k.string};f.exports=m;}),null);
__d("MentionsInputUtils",[],(function a(b,c,d,e,f,g){var h={generateDataFromTextWithEntities:function i(j){var k=j.text,l=[];(j.ranges||[]).forEach(function(n){var o=n.entity;if(!o.external&&!n.videoTimestamp&&!n.sphericalViewport&&!/\D/.test(o.id))l.push({uid:o.id,text:k.substr(n.offset,n.length),offset:n.offset,length:n.length,weakreference:!!o.weakreference});});var m={value:k,mentions:l};return m;}};f.exports=h;}),null);
__d('AbstractCommentLiveTypingController',['ex','destroyOnUnload'],(function a(b,c,d,e,f,g){'use strict';var h={START:'start',STOP:'stop'},i=10*1000;function j(k,l,m){this.$AbstractCommentLiveTypingController5=k;this.$AbstractCommentLiveTypingController6=l;this.$AbstractCommentLiveTypingController7=m;this.$AbstractCommentLiveTypingController1=null;this.$AbstractCommentLiveTypingController2=false;this.$AbstractCommentLiveTypingController3=0;this.$AbstractCommentLiveTypingController4=null;c('destroyOnUnload')(this.destroy.bind(this));}j.prototype.destroy=function(){this.$AbstractCommentLiveTypingController1&&this.$AbstractCommentLiveTypingController1.destroy();this.$AbstractCommentLiveTypingController1=null;this.$AbstractCommentLiveTypingController2=false;this.$AbstractCommentLiveTypingController3=0;this.$AbstractCommentLiveTypingController4=null;};j.prototype.bootloadPublisherModule=function(k){throw new Error(c('ex')('bootloadPublisherModule not implemented, '+'should be overridden by subclass'));};j.prototype.$AbstractCommentLiveTypingController8=function(k){var l=new k(this.$AbstractCommentLiveTypingController5,this.$AbstractCommentLiveTypingController6,this.$AbstractCommentLiveTypingController7),m=Date.now(),n=this.$AbstractCommentLiveTypingController3;if(n&&n+i>=m){var o=this.$AbstractCommentLiveTypingController4;if(o===h.START){l.handleStartEvent();}else if(o===h.STOP)l.handleStopEvent();}this.$AbstractCommentLiveTypingController1=l;};j.prototype.$AbstractCommentLiveTypingController9=function(){if(this.$AbstractCommentLiveTypingController2||!this.$AbstractCommentLiveTypingController5)return;this.$AbstractCommentLiveTypingController2=true;this.bootloadPublisherModule(this.$AbstractCommentLiveTypingController8.bind(this));};j.prototype.attemptPublishStartEvent=function(){this.$AbstractCommentLiveTypingController4=h.START;this.$AbstractCommentLiveTypingController3=Date.now();if(this.$AbstractCommentLiveTypingController1){this.$AbstractCommentLiveTypingController1.handleStartEvent();}else if(!this.$AbstractCommentLiveTypingController2)this.$AbstractCommentLiveTypingController9();};j.prototype.attemptPublishStopEvent=function(){this.$AbstractCommentLiveTypingController4=h.STOP;this.$AbstractCommentLiveTypingController3=Date.now();if(this.$AbstractCommentLiveTypingController1){this.$AbstractCommentLiveTypingController1.handleStopEvent();}else if(!this.$AbstractCommentLiveTypingController2)this.$AbstractCommentLiveTypingController9();};f.exports=j;}),null);
__d('UFIAddCommentLiveTypingController',['AbstractCommentLiveTypingController','Bootloader'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('AbstractCommentLiveTypingController'));i=h&&h.prototype;function j(k,l,m){i.constructor.call(this,k,l,m);}j.prototype.bootloadPublisherModule=function(k){c('Bootloader').loadModules(["UFIAddCommentLiveTypingPublisher"],k,'UFIAddCommentLiveTypingController');};j.prototype.attemptPublishStartEvent=function(){i.attemptPublishStartEvent.call(this);};j.prototype.attemptPublishStopEvent=function(){i.attemptPublishStopEvent.call(this);};f.exports=j;}),null);
__d('UFIGifButton.react',['cx','fbt','Arbiter','Bootloader','Link.react','MessengerPlatformInterfaceType','React','ReactLayeredComponentMixin_DEPRECATED'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=278,k=c('React').PropTypes,l=c('React').createClass({displayName:'UFIGifButton',propTypes:{onGifFlyoutShow:k.func,onGifSelected:k.func.isRequired,showTooltip:k.bool},mixins:[c('ReactLayeredComponentMixin_DEPRECATED')],getDefaultProps:function m(){return {showTooltip:true};},getInitialState:function m(){return {renderFlyout:null,flyoutShown:false,query:''};},componentDidMount:function m(){this._updateListener=c('Arbiter').subscribe('page_transition',function(){return this._hideFlyout();}.bind(this));},componentWillUnmount:function m(){this._updateListener&&this._updateListener.unsubscribe();},render:function m(){var n=i._("Post a GIF");return (c('React').createElement(c('Link.react'),{className:"_r1a UFICommentGifButton",'data-hover':'tooltip','data-tooltip-alignh':'center','data-tooltip-content':this.props.showTooltip?n:null,onClick:this._onLinkClicked,onMouseDown:this._prepareForClick},c('React').createElement('div',{ref:'icon',tabIndex:0,className:'UFICommentGifIcon'}),this.props.children));},renderLayers:function m(){return !this.state.renderFlyout||!this.state.flyoutShown?{}:this.state.renderFlyout();},_hideFlyout:function m(){this.setState({flyoutShown:false,query:''});},_prepareForClick:function m(){this._clickGuard=this.state.flyoutShown;},_onLinkClicked:function m(){if(this.state.renderFlyout!==null){if(!this._clickGuard){this.props.onGifFlyoutShow&&this.props.onGifFlyoutShow();this.setState({flyoutShown:true});}return;}c('Bootloader').loadModules(["XUIContextualDialog.react","ChatContentSearchFlyout.react","ContextualLayerAutoFlip"],function(n,o,p){this.setState({flyoutShown:true,renderFlyout:function(){return {contextualDialog:c('React').createElement(n,{alignment:'right',behaviors:{flip:p},className:"_5trk",contextRef:function(){return this.refs.icon;}.bind(this),onBlur:this._hideFlyout,onToggle:function(q){if(!q&&this.state.flyoutShown)this._hideFlyout();}.bind(this),position:'above',shown:this.state.flyoutShown,hasActionableContext:true,width:j},c('React').createElement('div',null,c('React').createElement(o,{onEscKeyDown:this._hideFlyout,onSelect:this._onGifSelected,query:this.state.query,shown:this.state.flyoutShown,searchInterface:c('MessengerPlatformInterfaceType').FB_INTERFACE})))};}.bind(this)});this.props.onGifFlyoutShow&&this.props.onGifFlyoutShow();}.bind(this),'UFIGifButton.react');},_onGifSelected:function m(n){this.props.onGifSelected(n);this._hideFlyout();}});f.exports=l;}),null);
__d('UFIMarkdownButton.react',['cx','fbt','Link.react','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;m.prototype.render=function(){var n=i._("Format text with Markdown");return (c('React').createElement(c('Link.react'),{className:"_r1a _45-m",'data-hover':'tooltip','data-tooltip-alignh':'center','data-tooltip-content':n,'aria-label':n,onClick:this.props.onClick},c('React').createElement('div',{tabIndex:0,className:"_45-n"+(this.props.active?' '+"_45-o":'')})));};function m(){j.apply(this,arguments);}m.propTypes={active:l.bool,onClick:l.func.isRequired};f.exports=m;}),null);
__d('UFITipJarButton.react',['cx','fbt','Bootloader','Link.react','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k;j=babelHelpers.inherits(l,c('React').Component);k=j&&j.prototype;function l(m){k.constructor.call(this,m);this.$UFITipJarButton1=function(){if(!this.state.renderFlyout){c('Bootloader').loadModules(["UFITipJarDialogContainer.react"],function(n){this.setState({flyoutShown:true,renderFlyout:function(){return (c('React').createElement(n,{contextRef:function(){return this.refs.tipJar;}.bind(this),flyoutShown:this.state.flyoutShown,instanceID:this.props.instanceID,receiverID:this.props.receiverID,videoID:this.props.videoID,onToggle:this.$UFITipJarButton3}));}.bind(this)});}.bind(this),'UFITipJarButton.react');}else this.setState({flyoutShown:true});}.bind(this);this.$UFITipJarButton3=function(n){this.setState({flyoutShown:n});}.bind(this);this.state={flyoutShown:false,renderFlyout:null};}l.prototype.render=function(){var m=i._("Send a Tip");return c('React').createElement(c('Link.react'),{className:"_qqp",'data-hover':'tooltip','data-tooltip-alignh':'center','data-tooltip-content':m,'aria-label':m,onClick:this.$UFITipJarButton1},c('React').createElement('div',{className:"_qqq",ref:'tipJar',tabIndex:0}),this.$UFITipJarButton2());};l.prototype.$UFITipJarButton2=function(){return this.state.renderFlyout&&this.state.renderFlyout();};f.exports=l;}),null);
__d("XFeedNUXSaveSeenStateController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/feed\/nux\/seen\/save\/",{link_id:{type:"String"},key:{type:"String",required:true},seen:{type:"Bool",defaultValue:false},env:{type:"Enum",enumType:0}});}),null);
__d("XUFICommentMarkdownPreviewController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/ufi\/comment\/markdown_preview\/",{comment_body:{type:"String"}});}),null);
__d('UFIAddComment.react',['cx','fbt','ActorURI','Arbiter','AsyncRequest','Badge.react','BootloadedComponent.react','Bootloader','ClipboardPhotoUploader','Event','JSResource','Keys','Link.react','LitestandStoryInsertionStatus','MentionsInputUtils','React','ReactDOM','Run','SnowflakePermalinkUtils','SubscriptionsHandler','TrackingNodes','UFIActorIconContainer.react','UFIAddCommentAction','UFIAddCommentLiveTypingController','UFIAttachMediaSection.react','UFICommercialBreakStore','UFIComposerIsTypingStore','UFIConfig','UFIGifButton.react','UFIImageBlock.react','UFIMarkdownButton.react','UFISharedDispatcher','UFIStickerButton.react','UFITipJarButton.react','URI','VideoPermalinkURI','XFeedNUXSaveSeenStateController','XUFICommentMarkdownPreviewController','getActiveElement','joinClasses','throttle'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=b.URL||b.webkitURL||{},k=c('React').PropTypes,l=i._("Write a comment..."),m=i._("Write a reply..."),n="fcg fss UFICommentTip",o=19,p='/ajax/ufi/upload/',q='/ajax/ufi/sticker_preview/',r=1000,s='comment_content_change',t={UPLOAD:'uploading',ENCODE:'encoding'},u=false,v=false,w=false,x=c('React').createClass({displayName:'UFIAddComment',propTypes:{contextArgs:k.object.isRequired,viewerActorID:k.string.isRequired,editingComment:k.object.isRequired,className:k.string,allowPhotoAttachments:k.bool,allowVideoAttachments:k.bool,allowStickerAttachments:k.bool,allowGifAttachments:k.bool,allowTipJar:k.bool,isEditing:k.bool,isFirstComponent:k.bool,isLastComponent:k.bool,isQAndA:k.bool,mentionsDataSource:k.object,replyCommentID:k.string,showSendOnEnterTip:k.bool,multiCompanyGroupsCount:k.number,subtitle:k.any,targetID:k.string,withoutSeparator:k.bool,markViewerHasInteracted:k.func,allowCommentMarkdown:k.bool,allowCommentPrivate:k.bool,keepFocus:k.bool},contextTypes:{dispatch:k.func},getInitialState:function y(){var z=this.props.editingComment,aa=z.attachment||{type:null},ba=aa.type==='photo'?aa:null;return {attachedPhoto:z.photo_comment||ba,attachedVideo:z.video_comment||null,commentMarkdownPreviewContent:null,commentMarkdownEnabled:false,videoStatus:null,videoFileURL:null,videoProgress:0,attachedSticker:aa.type=='sticker'?aa:null,fileInput:null,fileUploader:null,isCommenting:false,isLoadingPhoto:false,stickerNUXVisible:false,isFocused:this.props.isEditing,videosInCommentsNUXVisible:false,markdownNUXVisible:false,hasSubmitted:false};},_onKeyDown:function y(event){if(this.props.isEditing&&c('Event').getKeyCode(event.nativeEvent)===c('Keys').ESC)this.context.dispatch(c('UFIAddCommentAction').cancel(this.props.contextArgs));if(this.isMounted()&&!this._isOnBeforeUnloadListenerAdded){c('Run').onBeforeUnload(this._handleUnsavedChanges);this._isOnBeforeUnloadListenerAdded=true;}var z=c('getActiveElement')();if(c('Event').getKeyCode(event.nativeEvent)===c('Keys').ESC)z.blur();},_onContentChange:function y(z){c('UFISharedDispatcher').dispatch(c('UFIAddCommentAction').changeContent(this.props.contextArgs,z,this.props.replyCommentID));c('Arbiter').inform(s,{fbid:this.props.replyCommentID,text:z,instanceid:this.props.contextArgs.instanceid,ftentidentifier:this.props.contextArgs.ftentidentifier});if(this.props.allowCommentMarkdown)this._sendMarkdownUpdate(z);},_sendMarkdownUpdate:function y(z){var aa=c('XUFICommentMarkdownPreviewController').getURIBuilder().setString('comment_body',z).getURI();new (c('AsyncRequest'))(aa).setHandler(this._handleMarkdownUpdate).send();},_handleMarkdownUpdate:function y(z){if(!z)return;this.setState({commentMarkdownPreviewContent:z.payload?z.payload.markup:null});},_handleUnsavedChanges:function y(){var z=b.PageTransitions;if(z){var aa=c('URI').getNextURI(),ba=z.getMostRecentURI();if(aa.getQueryData().hasOwnProperty('theater')||ba.getQueryData().hasOwnProperty('theater')||aa.getQueryData().hasOwnProperty('sdialog')||c('SnowflakePermalinkUtils').isPermalinkURI(aa)||c('SnowflakePermalinkUtils').isPermalinkURI(ba)||c('VideoPermalinkURI').isValid(aa)&&aa.getQueryData().ref==='channel'||c('VideoPermalinkURI').isValid(ba)&&ba.getQueryData().ref==='channel')return;var ca=b.DialogNavigationStack;if(ca&&ca.isActiveURI(aa))return;}if(this.refs&&this.refs.mentionsinput&&this.refs.mentionsinput.hasEnteredText())return i._("You haven't finished your comment yet. Do you want to leave without finishing?");},_blur:function y(){this.setState({markdownNUXVisible:false,stickerNUXVisible:false,videosInCommentsNUXVisible:false});setTimeout(function(){if(this.isMounted())this.setState({isFocused:false});}.bind(this),100);if(this.refs.mentionsinput&&this.refs.mentionsinput.hasEnteredText())return;this.setState({isCommenting:false});},_onPaste:function y(event){var z=new (c('ClipboardPhotoUploader'))(p,this._getPhotoUploadData());this._cancelCurrentSubscriptions();this._subscriptions=[z.subscribe('upload_start',this._prepareForAttachedPhotoPreview),z.subscribe('upload_error',this._onRemoveAttachedMediaPreviewClicked),z.subscribe('upload_success',function(aa,ba){this._onPhotoUploadComplete(ba);}.bind(this))];z.handlePaste(event);},_onEnterSubmit:function y(z,event){this.setState({hasSubmitted:true});var aa=this.state.attachedPhoto||this.state.attachedVideo||this.state.attachedSticker,ba=this.props.isEditing||aa;if(this.state.isLoadingPhoto||this._isLoadingVideo()){return false;}else if(!z.encodedValue.trim()&&!ba)return false;z.encodedValue=z.encodedValue.trim();if(this.state.commentMarkdownEnabled){z.isMarkdown=true;this.setState({commentMarkdownEnabled:false,commentMarkdownPreviewContent:null});}if(aa){z.attachedPhoto=this.state.attachedPhoto;z.attachedVideo=this.state.attachedVideo;z.attachedSticker=this.state.attachedSticker;this.setState({isLoadingPhoto:false,attachedPhoto:null,attachedVideo:null,attachedSticker:null});}else{z.attachedPhoto=null;z.attachedVideo=null;z.attachedSticker=null;}if(this.props.isEditing){this.context.dispatch(c('UFIAddCommentAction').submitEdit(this.props.contextArgs,this.props.editingComment,z,event.target));}else this.context.dispatch(c('UFIAddCommentAction').submitNew(this.props.contextArgs,z,event.target,this.props.replyCommentID));return true;},_isLoadingVideo:function y(){return this.state.videoStatus===t.UPLOAD||this.state.videoStatus===t.ENCODE&&this.state.videoProgress!==100;},_cancelCurrentSubscriptions:function y(){if(this._subscriptions)this._subscriptions.forEach(function(z){z.unsubscribe();});},componentWillMount:function y(){this._isOnBeforeUnloadListenerAdded=false;this._storyInsertionBlocker=c('LitestandStoryInsertionStatus').registerBlocker(function(){return this.state.isCommenting;}.bind(this));this._storeSubscriptions&&this._storeSubscriptions.release();this._storeSubscriptions=new (c('SubscriptionsHandler'))();this._storeSubscriptions.addSubscriptions(c('UFICommercialBreakStore').addListener(function(){this.setState({inCommercialBreak:c('UFICommercialBreakStore').getValueFor(this.props.contextArgs.instanceid)});}.bind(this)));this._typingEventController=null;if(c('UFIConfig').canPublishLive)this._storeSubscriptions.addSubscriptions(c('UFIComposerIsTypingStore').addListener(function(){var z=c('UFIComposerIsTypingStore').getValueFor(this.props.contextArgs.ftentidentifier);if(z===null)return;if(!this._typingEventController)this._typingEventController=new (c('UFIAddCommentLiveTypingController'))(this.props.contextArgs.ftentidentifier,this.props.replyCommentID,this.props.viewerActorID);if(z){this._typingEventController.attemptPublishStartEvent();}else this._typingEventController.attemptPublishStopEvent();}.bind(this)));},_destroyLiveTypingController:function y(){this._typingEventController&&this._typingEventController.destroy();this._typingEventController=null;},componentWillReceiveProps:function y(z){var aa=this.props.contextArgs.ftentidentifier,ba=z.contextArgs.ftentidentifier;if(ba!==aa||this.props.replyCommentID!==z.replyCommentID||this.props.viewerActorID!==z.viewerActorID)this._destroyLiveTypingController();},componentWillUnmount:function y(){this._cancelCurrentSubscriptions();if(this._remixedImageToken)c('Arbiter').unsubscribe(this._remixedImageToken);if(this._focusCommentFieldToken)c('Arbiter').unsubscribe(this._focusCommentFieldToken);this._storyInsertionBlocker&&this._storyInsertionBlocker.unsubscribe();this._storyInsertionBlocker=null;this._storeSubscriptions&&this._storeSubscriptions.release();this._destroyLiveTypingController();},focus:function y(){var z={isCommenting:true,isFocused:true,hasSubmitted:false},aa=this.props.contextArgs.loggedOutLinkConfig;if(aa&&aa.showAddComment)c('Bootloader').loadModules(["AsyncDialog"],function(ca){ca.bootstrap(aa.addCommentAjaxifyURI,null,'dialog');},'UFIAddComment.react');if(this.props.allowStickerAttachments&&c('UFIConfig').shouldShowStickerNUX)if(!u){u=true;var ba=c('XFeedNUXSaveSeenStateController').getURIBuilder().setString('key','sticker_comments').setBool('seen',true).getURI();new (c('AsyncRequest'))(ba).send();z.stickerNUXVisible=true;}if(this.props.allowVideoAttachments&&c('UFIConfig').shouldShowVideosInCommentsNux&&!c('UFIConfig').shouldShowStickerNUX)if(!v){v=true;ba=c('XFeedNUXSaveSeenStateController').getURIBuilder().setString('key','video_comments').setBool('seen',true).getURI();new (c('AsyncRequest'))(ba).send();z.videosInCommentsNUXVisible=true;}if(this.props.allowCommentMarkdown&&c('UFIConfig').shouldShowMarkdownCommentNUX&&!c('UFIConfig').shouldShowVideosInCommentsNux&&!c('UFIConfig').shouldShowStickerNUX)if(!w){w=true;ba=c('XFeedNUXSaveSeenStateController').getURIBuilder().setString('key','markdown_comments').setBool('seen',true).getURI();new (c('AsyncRequest'))(ba).send();z.markdownNUXVisible=true;}this.setState(z);if(this.props.markViewerHasInteracted)this.props.markViewerHasInteracted();if(this.props.onFocus)this.props.onFocus();},_renderStickerNUX:function y(){if(this.state.stickerNUXVisible)return (c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('XUIAmbientNUX.react').__setRef('UFIAddComment.react'),bootloadPlaceholder:c('React').createElement('div',null),contextRef:function(){return this.refs.sticker_button;}.bind(this),shown:this.state.stickerNUXVisible,position:'above',width:'auto',alignment:'right',onCloseButtonClick:this._hideStickerNUX},i._("Now you can comment with a sticker!")));return null;},_renderVideoInCommentsNUX:function y(){if(this.state.videosInCommentsNUXVisible)return (c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('XUIAmbientNUX.react').__setRef('UFIAddComment.react'),bootloadPlaceholder:c('React').createElement('div',null),contextRef:function(){return this.refs.media_section;}.bind(this),shown:this.state.videosInCommentsNUXVisible,position:'above',width:'auto',alignment:'right',onCloseButtonClick:this._hidevideosInCommentsNUX},i._("You can now add videos to comments")));return null;},_renderMarkdownCommentsNUX:function y(){if(this.state.markdownNUXVisible)return (c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('XUIAmbientNUX.react').__setRef('UFIAddComment.react'),bootloadPlaceholder:c('React').createElement('div',null),contextRef:function(){return this.refs.markdownButton;}.bind(this),shown:this.state.markdownNUXVisible,position:'above',width:'auto',alignment:'right',onCloseButtonClick:this._hideMarkdownCommentsNUX},i._("[FB-Only] Markdown in Comments! Click to enable.")));return null;},_setFileInput:function y(z,aa){this.setState({fileInput:z,fileUploader:aa});},render:function y(){var z=this.props.contextArgs.loggedOutLinkConfig,aa=true;if(z&&z.showAddComment)aa=false;var ba=(!this.props.contextArgs.collapseaddcomment||this.state.isCommenting)&&aa&&!this.props.contextArgs.hideActorPhoto,ca=null;if(this.props.subtitle){ca=c('React').createElement('span',{className:n},this.props.subtitle);}else if(!this.state.isFocused&&this.props.isEditing){ca=c('React').createElement('span',{className:n},i._("{cancel}",[i.param('cancel',c('React').createElement(c('Link.react'),{onClick:function(){return (this.context.dispatch(c('UFIAddCommentAction').cancel(this.props.contextArgs)));}.bind(this)},i._("Cancel")))]));}else if(this.props.isEditing){ca=c('React').createElement('span',{className:n},i._("Press Esc to {cancel}.",[i.param('cancel',c('React').createElement(c('Link.react'),{onMouseDown:function(){return (this.context.dispatch(c('UFIAddCommentAction').cancel(this.props.contextArgs)));}.bind(this)},i._("cancel")))]));}else if(this.props.multiCompanyGroupsCount&&this.state.isFocused){ca=c('React').createElement('div',{className:"fcg fsm _2pid"},c('React').createElement(c('Badge.react'),{key:'noncoworker',type:'work_non_coworker'}),c('React').createElement('span',{className:"_2pir _4zk5"},i._({"*":"People from {number} companies will see this.","268435456":"People from 1 company will see this."},[i.plural(this.props.multiCompanyGroupsCount,'number')])));}else if(this.props.showSendOnEnterTip)ca=c('React').createElement('span',{className:n},i._("Press Enter to post."));var da=null,ea=null,fa=null,ga=null,ha=this.state.attachedPhoto||this.state.attachedSticker||this.state.attachedVideo,ia=null,ja=null;if(this.props.allowCommentMarkdown)ga=c('React').createElement(c('UFIMarkdownButton.react'),{active:this.state.commentMarkdownEnabled,ref:'markdownButton',onClick:function(){this.setState({commentMarkdownEnabled:!this.state.commentMarkdownEnabled});}.bind(this)});if(this.props.allowStickerAttachments&&!ha)ea=c('React').createElement(c('UFIStickerButton.react'),{ref:'sticker_button',onStickerSelected:this.onStickerSelected,onEmoticonSelected:this._insertEmoticonIntoCommentText,onStickerFlyoutShow:function(){c('Arbiter').inform('comment_content_change',{addingAttachment:true});if(this.props.markViewerHasInteracted)this.props.markViewerHasInteracted();}.bind(this)});if(this.props.allowGifAttachments&&!ha)fa=c('React').createElement(c('UFIGifButton.react'),{ref:'gif_button',onGifSelected:this.onGifSelected,onGifFlyoutShow:function(){if(this.props.markViewerHasInteracted)this.props.markViewerHasInteracted();}.bind(this)});if(this.props.allowTipJar)ja=c('React').createElement(c('UFITipJarButton.react'),{instanceID:this.props.contextArgs.instanceid,receiverID:this.props.targetID,videoID:this.props.contextArgs.ftentidentifier});if(this.props.allowPhotoAttachments||this.props.allowVideoAttachments){ia=this._onPaste;da=c('React').createElement(c('UFIAttachMediaSection.react'),{ref:'media_section',getPhotoUploadData:this._getPhotoUploadData,prepareForAttachedPhotoPreview:this._prepareForAttachedPhotoPreview,prepareForAttachedVideoPreview:this._prepareForAttachedVideoPreview,allowVideoAttachments:this.props.allowVideoAttachments,onPhotoUploadComplete:this._onPhotoUploadComplete,onVideoUploadComplete:this._onVideoUploadComplete,onVideoEncodeUpdate:this._onVideoEncodeUpdate,onVideoUploadUpdate:this._onVideoUploadUpdate,setFileInput:this._setFileInput,targetId:this.props.targetID,onClick:function(){c('Arbiter').inform('comment_content_change',{addingAttachment:true});if(this.props.markViewerHasInteracted)this.props.markViewerHasInteracted();}.bind(this),attachment:ha,viewerActorID:this.props.viewerActorID});}var ka=c('TrackingNodes').getTrackingInfo(c('TrackingNodes').types.ADD_COMMENT_BOX),la='addComment_'+this.props.contextArgs.ftentidentifier,ma;if(!!this.props.replyCommentID){ma=m;}else if(this.props.isQAndA){ma=i._("Ask a question...");}else ma=l;var na=this.props.contextArgs.viewoptionstypeobjects,oa=this.props.contextArgs.viewoptionstypeobjectsorder;if(this.props.attachedPhoto&&!this.props.subtitle)ca=null;var pa;if(this.state.attachedPhoto||this.state.isLoadingPhoto||this.state.attachedVideo||this.state.videoStatus===t.UPLOAD||this.state.attachedSticker)pa=c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('UFIAttachedMediaPreview.react').__setRef('UFIAddComment.react'),bootloadPlaceholder:c('React').createElement('span',null),attachedPhoto:this.state.attachedPhoto,attachedVideo:this.state.attachedVideo,attachedSticker:this.state.attachedSticker,monitorHeight:this.props.contextArgs.monitorHeight,onRemoveAttachedMediaPreviewClicked:this._onRemoveAttachedMediaPreviewClicked,onRemoveAttachedStickerPreview:this._onRemoveAttachedStickerPreviewClicked,subtitle:this.props.subtitle,isLoadingPhoto:this.state.isLoadingPhoto,videoFileURL:this.state.videoFileURL,videoStatus:this.state.videoStatus,videoProgress:this.state.videoProgress});var qa=this.props.contextArgs.mentionsinput,ra=qa.inputComponent,sa=qa.viewComponent,ta=qa.viewProps,ua=this.props.editingComment.body,va=ua?c('MentionsInputUtils').generateDataFromTextWithEntities(ua):null,wa=null;if(this.props.allowCommentMarkdown&&this.state.commentMarkdownEnabled)wa=c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('UFICommentMarkdownPreview.react').__setRef('UFIAddComment.react'),bootloadPlaceholder:c('React').createElement('span',null),markup:this.state.commentMarkdownPreviewContent});var xa=c('React').createElement('div',{className:'UFICommentContainer'},c('React').createElement('div',{className:'UFIInputContainer'},c('React').createElement(ra,{disableInitTextarea:!aa,replyCommentID:this.props.replyCommentID,initialData:va,placeholder:ma,datasource:this.props.mentionsDataSource,ref:'mentionsinput',viewComponent:sa,viewProps:ta,viewOptionsTypeObjects:na,viewOptionsTypeObjectsOrder:oa,hashtags:this.props.contextArgs.sht,showHashtagTypeahead:c('UFIConfig').showHashtagTypeahead,autoflip:this.props.contextArgs.addcommentautoflip,monitorHeight:this.props.contextArgs.monitorHeight,onEnterSubmit:this._onEnterSubmit,onFocus:this.focus,onBlur:this._blur,onContentChange:this._onContentChange,onPaste:ia,ftEntIdentifier:this.props.contextArgs.ftentidentifier,instanceID:this.props.contextArgs.instanceid}),c('React').createElement('div',{className:"UFICommentAttachmentButtons"},ga,da,fa,ea,ja)),wa,pa,ca);if(ba)xa=c('React').createElement(c('UFIImageBlock.react'),{className:"UFIMentionsInputWrap"+(this.props.allowStickerAttachments?' '+"UFIStickersEnabledInput":'')+(this.props.allowCommentMarkdown?' '+"UFIMarkdownEnabledInput":'')+(this.props.allowGifAttachments?' '+"UFIGifEnabledInput":'')+(this.props.allowTipJar?' '+"UFITipJarEnabledInput":'')},c('React').createElement('div',{className:'UFIReplyActorPhotoWrapper',onClick:this.focus},c('React').createElement(c('UFIActorIconContainer.react'),{actorID:this.props.viewerActorID})),xa);return (c('React').createElement('div',{id:la,className:c('joinClasses')("UFIRow"+(' '+"_4oep")+(' '+"UFIAddComment")+(this.props.allowPhotoAttachments?' '+"UFIAddCommentWithPhotoAttacher":'')+(this.props.withoutSeparator?' '+"UFIAddCommentWithoutSeparator":'')+(this.props.isFirstComponent?' '+"_4204":'')+(this.props.isLastComponent?' '+"_2o9m":'')+(this.state.inCommercialBreak?' '+"hidden_elem":''),this.props.className),onKeyDown:this._onKeyDown,'data-ft':ka},xa,this._renderStickerNUX(),this._renderVideoInCommentsNUX(),this._renderMarkdownCommentsNUX()));},componentDidUpdate:function y(z,aa,ba){if(!aa.attachedPhoto&&this.state.attachedPhoto||!aa.attachedSticker&&this.state.attachedSticker||!aa.attachedVideo&&this.state.attachedVideo||!aa.isCommenting&&this.state.isCommenting){this.refs.mentionsinput.focus();}else if(this.props.keepFocus&&this.state.hasSubmitted)this.refs.mentionsinput.focus();if(z.viewerActorID!==this.props.viewerActorID){if(this.state.fileInput)this.state.fileInput.clear();if(this.state.fileUploader)this.state.fileUploader.setData(this._getPhotoUploadData());this._onRemoveAttachedMediaPreviewClicked();}},componentDidMount:function y(){this._sendMarkdownUpdate=c('throttle')(this._sendMarkdownUpdate,r,this);if(!this.props.allowPhotoAttachments&&!this.props.allowVideoAttachments)return;if(this.props.replyCommentID===null){this._focusCommentFieldToken=c('Arbiter').subscribe('focusCommentField'+this.props.contextArgs.ftentidentifier,function(z){this.refs.mentionsinput.focus();}.bind(this));if(this.props.contextArgs.issnowlift)this._remixedImageToken=c('Arbiter').subscribe('newRemixedImage'+this.props.contextArgs.ftentidentifier,function(z,aa){var event={clipboardData:{items:[aa]}};this._onPaste(event);}.bind(this));}},insertMention:function y(z){if(this.refs.mentionsinput&&this.refs.mentionsinput.insertMention)this.refs.mentionsinput.insertMention(z);},_getPhotoUploadData:function y(){var z=this.props.viewerActorID,aa={profile_id:z,target_id:this.props.targetID,source:o};aa[c('ActorURI').PARAMETER_ACTOR]=z;return aa;},_onPhotoUploadComplete:function y(z){if(!this.state.isLoadingPhoto)return;var aa=z.getPayload();if(aa&&aa.fbid){this.setState({attachedPhoto:aa,isLoadingPhoto:false});}else this._onRemoveAttachedMediaPreviewClicked(null);},_onVideoEncodeUpdate:function y(z,aa){if(!this.state.attachedVideo||this.state.videoStatus!==t.ENCODE)return;if(aa.obj.progress<this.state.videoProgress)return;aa.obj.fbid=aa.obj.videoID;this.setState({attachedVideo:aa.obj,videoProgress:aa.obj.progress,videoStatus:t.ENCODE});if(this._isEncodingFinished(aa.obj.stage))this._onEncodeComplete();},_onVideoUploadUpdate:function y(z){this.setState({videoProgress:z});},_isEncodingFinished:function y(z){return z==='finish';},_onEncodeComplete:function y(){this.state.fileInput.clear();},_onVideoUploadComplete:function y(z){if(this.state.videoStatus!==t.UPLOAD)return;if(z&&z.video_id)this.setState({videoProgress:0,attachedVideo:z,videoStatus:t.ENCODE});},_onRemoveAttachedMediaPreviewClicked:function y(event){c('Arbiter').inform('video_upload_cancel',{});if(this.state.fileInput)this.state.fileInput.clear();this.setState({attachedPhoto:null,attachedVideo:null,videoStatus:null,videoFileURL:null,isLoadingPhoto:false,videoProgress:0});},_prepareForAttachedPhotoPreview:function y(){this.setState({attachedPhoto:null,isLoadingPhoto:true});},_prepareForAttachedVideoPreview:function y(){var z,aa=this.state.fileInput.input.files[0];if(aa&&j.createObjectURL)z=j.createObjectURL(aa);this.setState({attachedVideo:null,videoStatus:t.UPLOAD,videoFileURL:z,videoProgress:0});},_onStickerUploadComplete:function y(z){if(!this.state.isLoadingPhoto)return;var aa=z.getPayload();if(aa&&aa.fbid){this.setState({attachedSticker:aa,isLoadingPhoto:false});}else{c('Bootloader').loadModules(["Dialog"],function(ba){var ca=i._("Sticker Failed"),da=i._("There was a problem attaching the sticker.");new ba().setTitle(ca).setBody(da).setButtons(ba.OK).show();},'UFIAddComment.react');this._onRemoveAttachedStickerPreviewClicked(null);}},_onRemoveAttachedStickerPreviewClicked:function y(event){this.setState({attachedSticker:null,isLoadingPhoto:false});},onStickerSelected:function y(z,event){if(this.props.isEditing||this.refs.mentionsinput.hasEnteredText()||c('UFIConfig').alwaysPreviewSticker){this._prepareForAttachedStickerPreview(z);return;}this.sendSticker(z,event);},_prepareForAttachedStickerPreview:function y(z){this.setState({attachedSticker:null,isLoadingPhoto:true});new (c('AsyncRequest'))(q).setData({sticker_id:z}).setErrorHandler(this._onRemoveAttachedStickerPreviewClicked).setHandler(this._onStickerUploadComplete).send();},sendSticker:function y(z,event){var aa={encodedValue:'',visibleValue:'',attachedPhoto:null,attachedSticker:{fbid:z}};this.context.dispatch(c('UFIAddCommentAction').submitNew(this.props.contextArgs,aa,event.target,this.props.replyCommentID));},_insertEmoticonIntoCommentText:function y(z){c('Bootloader').loadModules(["EmoticonsList","EmoticonUtils","TextAreaControl","SelectionPosition"],function(aa,ba,ca,da){var ea=aa.symbols[z];if(!ea)return;if(this.props.contextArgs.mentionsinput){this.refs.mentionsinput.insertEmoticon(ea);return;}if(!this._selectionPosition)this._selectionPosition=new da(c('ReactDOM').findDOMNode(this.refs.mentionsinput.refs.textarea));var fa=this.refs.mentionsinput.refs.getTextFieldDOM(),ga=ca.getInstance(fa),ha=ga.getValue(),ia=ba.insertEmoticon(ea,ha,this._selectionPosition.getPos());ga.setValue(ia.result);this._selectionPosition.setPos(ia.start,ia.end);}.bind(this),'UFIAddComment.react');},_hideStickerNUX:function y(){this.setState({stickerNUXVisible:false});},_hidevideosInCommentsNUX:function y(){this.setState({videosInCommentsNUXVisible:false});},_hideMarkdownCommentsNUX:function y(){this.setState({markdownNUXVisible:false});},onGifSelected:function y(z){var aa={encodedValue:'',visibleValue:'',attachedShareURL:z.source.url};this.context.dispatch(c('UFIAddCommentAction').submitNew(this.props.contextArgs,aa,null,this.props.replyCommentID));}});f.exports=x;}),null);