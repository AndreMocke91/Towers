if (self.CavalryLogger) { CavalryLogger.start_js(["CEeAd"]); }

__d("MessagingGenericAdminTextType",[],(function a(b,c,d,e,f,g){f.exports={MADE_POLL_VOTE:"made_poll_vote",GROUP_POLL:"group_poll",CONFIRM_FRIEND_REQUEST:"confirm_friend_request",PHONE_CONTACT_UPLOAD:"phone_contact_upload",ACCEPT_PENDING_THREAD:"accept_pending_thread",RAMP_UP_WELCOME_MESSAGE:"ramp_up_welcome_message",CHANGE_THREAD_THEME:"change_thread_theme",CHANGE_THREAD_ICON:"change_thread_icon",GROUP_THREAD_CREATED:"group_thread_created",THREAD_EPHEMERAL_SEND_MODE:"thread_ephemeral_send_mode",INVITE_ACCEPTED:"invite_accepted",MESSENGER_INVITE_SENT:"messenger_invite_sent",TURN_ON_PUSH:"turn_on_push",JOURNEY_PROMPT_COLOR:"journey_prompt_color",JOURNEY_PROMPT_LIKE:"journey_prompt_like",JOURNEY_PROMPT_NICKNAME:"journey_prompt_nickname",JOURNEY_PROMPT_SETUP:"journey_prompt_setup",CHANGE_THREAD_NICKNAME:"change_thread_nickname",BOT_THREAD_SUBSCRIPTION:"bot_thread_subscription",RTC_CALL_LOG:"rtc_call_log",RTC_INSTANT_VIDEO_LIFECYCLE:"rtc_instant_video_lifecycle",JOURNEY_PROMPT_BOT:"journey_prompt_bot",RIDE_ORDERED_MESSAGE:"ride_ordered_message",DESTINATION_ETA_MESSAGE:"destination_eta_message",RIDE_ARRIVED_MESSAGE:"ride_arrived_message",JOURNEY_PROMPT_NEW_SETUP:"journey_prompt_new_setup",LIGHTWEIGHT_EVENT_CREATE:"lightweight_event_create",LIGHTWEIGHT_EVENT_DELETE:"lightweight_event_delete",LIGHTWEIGHT_EVENT_NOTIFY:"lightweight_event_notify",LIGHTWEIGHT_EVENT_NOTIFY_BEFORE_EVENT:"lightweight_event_notify_before_event",LIGHTWEIGHT_EVENT_RSVP:"lightweight_event_rsvp",LIGHTWEIGHT_EVENT_UPDATE:"lightweight_event_update",LIGHTWEIGHT_EVENT_UPDATE_LOCATION:"lightweight_event_update_location",LIGHTWEIGHT_EVENT_UPDATE_TIME:"lightweight_event_update_time",LIGHTWEIGHT_EVENT_UPDATE_TITLE:"lightweight_event_update_title",SAFETY_LOCATION_REQUEST_SENT:"safety_location_request_sent",SAFETY_LOCATION_REQUEST_RESPONDED:"safety_location_request_responded",SAFETY_LOCATION_REQUEST_DENIED:"safety_location_request_denied",AD_MANAGE_MESSAGE:"ad_manage_message",AD_REPLY_MESSAGE:"ad_reply_message",TAGGED_PHOTO:"tagged_photo",GAME_SCORE:"game_score",INSTANT_GAME_UPDATE:"instant_game_update",MEDIA_SUBSCRIPTION_MANAGE:"media_subscription_manage",M_AI_SURVEY:"m_ai_survey",PHONE_NUMBER_LOOKUP_NOTICE:"phone_number_lookup_notice",MESSENGER_PRECHECKED_PLUGIN:"messenger_prechecked_plugin",ADD_CONTACT:"add_contact",PRODUCT_INVOICE_RECEIPT_REJECTED:"product_invoice_receipt_rejected",PRODUCT_INVOICE_PAID:"product_invoice_paid",PRODUCT_INVOICE_VOIDED:"product_invoice_voided",PRODUCT_INVOICE_SHIPPED:"product_invoice_shipped",PRODUCT_INVOICE_PAYMENT_EXPIRED:"product_invoice_payment_expired",PRODUCT_INVOICE_RECEIPT_UPLOADED:"product_invoice_receipt_uploaded",CHANGE_JOINABLE_SETTING:"change_joinable_setting",CHANGE_THREAD_ADMINS:"change_thread_admins",CHANGE_THREAD_APPROVAL_MODE:"change_thread_approval_mode",CAPY_SESSION_BEGIN:"capy_session_begin",CAPY_SESSION_END:"capy_session_end",CAPY_AGENT_JOIN:"capy_agent_join",GROUP_SMS_PARTICIPANT_JOINED:"group_sms_participant_joined",GROUP_SMS_PARTICIPANT_CAPPED:"group_sms_participant_capped",SMS_PHONE_NUMBER_CHECK:"sms_phone_number_check",MESSENGER_BOT_REVIEW_SENT:"messenger_bot_review_sent",MN_ACCOUNT_LINKING_TEXT:"mn_account_linking_text",MN_ACCOUNT_UNLINKING_TEXT:"mn_account_unlinking_text",MN_ACCOUNT_FORCED_UNLINKING_TEXT:"mn_account_forced_unlinking_text",MN_REF_SEND_TEXT:"mn_ref_send_text",ADS_WELCOME_MSG:"ads_welcome_msg",THREAD_JOINABLE_PROMOTION_TEXT:"thread_joinable_promotion_text",PAGES_PLATFORM_REQUEST_TEXT:"pages_platform_request_text",MESSENGER_NEW_USER_GET_STARTED:"messenger_new_user_get_started",SMS_PHONE_NUMBER_TOGGLE:"sms_phone_number_toggle",PAGES_PLATFORM_CREATE_APPOINTMENT:"Pages_Platform_create_appointment",JOINABLE_GROUP_THREAD_CREATED:"joinable_group_thread_created",PAGES_PLATFORM_ACCEPT_APPOINTMENT:"pages_platform_accept_appointment",PAGES_PLATFORM_DECLINE_APPOINTMENT:"pages_platform_decline_appointment",PAGES_PLATFORM_USER_CANCEL:"pages_platform_user_cancel",PAGES_PLATFORM_ADMIN_CANCEL:"pages_platform_admin_cancel",MESSENGER_OMNIM_CREATE_FLOW:"messenger_omnim_create_flow",MESSENGER_OMNIM_UPDATE_FLOW_STATE:"messenger_omnim_update_flow_state",MESSENGER_GROUP_DESCRITPION_UPDATE:"messenger_group_description_update",MESSENGER_EXTENSION_ADD_CART:"messenger_extension_add_cart",MESSENGER_EXTENSION_ADD_FAVORITE:"messenger_extension_add_favorite",PAGES_PLATFORM_APPOINTMENT_REMINDER:"pages_platform_appointment_reminder",PAGES_PLATFORM_ADMIN_DECLINE:"pages_platform_admin_decline",POKE_RECEIVED:"poke_received",MESSENGER_STATION_SUBSCRIPTION:"messenger_station_subscription",MESSENGER_USER_ALSO_ON_MESSENGER:"messenger_user_also_on_messenger",MESSENGER_INBOX2_BIRTHDAY_BUMP:"messenger_inbox2_birthday_bump",STARTED_SHARING_VIDEO:"started_sharing_video",LIVE_VIDEO_CHAT:"live_video_chat",PARTICIPANT_JOINED_GROUP_CALL:"participant_joined_group_call",MESSENGER_ONLY_PHONE_JOINED_WITH_NEW_ACCOUNT:"messenger_only_phone_joined_with_new_account"};}),null);
__d("MessengerThreadCannotReplyReason",[],(function a(b,c,d,e,f,g){f.exports={BLOCKED:"blocked",COMPOSER_DISABLED_BOT:"composer_disabled_bot",HAS_EMAIL_PARTICIPANT:"has_email_participant",OBJECT_ORIGINATED:"object_originated",READ_ONLY:"read_only",VIEWER_NOT_SUBSCRIBED:"viewer_not_subscribed",RECIPIENTS_NOT_LOADABLE:"recipients_not_loadable",RECIPIENTS_UNAVAILABLE:"recipients_unavailable",RECIPIENTS_INVALID:"recipients_invalid",RECIPIENTS_INACTIVE_WORK_ACC:"recipients_inactive_work_account",MONTAGE_NOT_AUTHOR:"montage_not_author"};}),null);
__d('MercuryThreadInfo',['CurrentUser','MercuryIDs','MessengerThreadCannotReplyReason'],(function a(b,c,d,e,f,g){'use strict';var h={canReply:function j(k){return !!(k.is_subscribed&&(k.can_reply===undefined||k.can_reply)&&!k.has_email_participant&&!k.read_only);},getMuteSetting:function j(k){return !k.mute_until?undefined:k.mute_until;},isEmptyLocalThread:function j(k){return (c('MercuryIDs').tokenize(k.thread_id).type==='root'&&!k.timestamp);},isMuted:function j(k){return h.getMuteSetting(k)!==undefined;},areMentionsMuted:function j(k){return k.mentions_mute_mode===1;},isNewEmptyLocalThread:function j(k){return !!(h.isEmptyLocalThread(k)&&k.participants&&k.participants.length===0);},showComposer:function j(k){return !!(k.is_subscribed&&(k.can_reply||!k.cannot_reply_reason||k.cannot_reply_reason===c('MessengerThreadCannotReplyReason').BLOCKED)&&!k.has_email_participant&&!k.read_only);},isColdOpen:function j(k){return !!(k.is_canonical_user&&(k.message_count===0||!k.timestamp));}};function i(j){return j+'@facebook.com';}f.exports=h;}),null);
__d('MercuryDisplayTimeFilterMessageRenderer',['fbt'],(function a(b,c,d,e,f,g,h){'use strict';var i={renderFilteredContent:function j(k){if(k.is_filtered_content_bh)return h._("This message was removed because it contains blocked or harmful links.");if(k.is_filtered_content_account)return h._("This message has been temporarily removed because the sender's account requires verification.");if(k.is_filtered_content_quasar)return h._("This message was removed because it contains blocked or harmful content.");if(k.is_filtered_content_invalid_app)return h._("This message was removed because the app it's being sent from is blocked from sending messages.");return h._("This message has been temporarily removed because the sender's account requires verification, or it was identified as abusive.");}};f.exports=i;}),null);
__d('MercuryGiftSnippetRenderer',['fbt'],(function a(b,c,d,e,f,g,h){'use strict';var i={renderText:function j(k,l){return k?h._("You sent a valentine."):h._("{name} sent a valentine.",[h.param('name',l)]);}};f.exports=i;}),null);
__d('MercuryLocalIDs',['PresenceUtil','randomInt'],(function a(b,c,d,e,f,g){'use strict';var h={generateMessageID:function j(k){var l=k||Date.now(),m=c('randomInt')(0,4294967295),n=c('PresenceUtil').getSessionID();return '<'+l+':'+m+'-'+n+'@mail.projektitan.com>';},generateThreadID:function j(k){return 'root:'+h.generateOfflineThreadingID(k);},generateOfflineThreadingID:function j(k){var l=k||Date.now(),m=c('randomInt')(0,4294967295),n=('0000000000000000000000'+m.toString(2)).slice(-22),o=l.toString(2)+n;return i(o.slice(-63));}};function i(j){var k='';while(j!='0'){var l=0,m='';for(var n=0;n<j.length;n++){l=2*l+parseInt(j[n],10);if(l>=10){m+='1';l-=10;}else m+='0';}k=l.toString()+k;j=m.slice(m.indexOf('1'));}return k;}f.exports=h;}),null);
__d('MercurySyncDeltaTypes',[],(function a(b,c,d,e,f,g){'use strict';var h={AdminAddedToGroupThread:'AdminAddedToGroupThread',AdminRemovedFromGroupThread:'AdminRemovedFromGroupThread',AdminTextMessage:'AdminTextMessage',DeliveryReceipt:'DeliveryReceipt',ForcedFetch:'ForcedFetch',MarkRead:'MarkRead',MarkUnread:'MarkUnread',MessageDelete:'MessageDelete',NewMessage:'NewMessage',PagesManagerEvent:'PagesManagerEvent',ParticipantLeftGroupThread:'ParticipantLeftGroupThread',ParticipantsAddedToGroupThread:'ParticipantsAddedToGroupThread',ReadReceipt:'ReadReceipt',ReplaceMessage:'ReplaceMessage',RTCEventLog:'RTCEventLog',ThreadAction:'ThreadAction',ThreadDelete:'ThreadDelete',ThreadMuteSettings:'ThreadMuteSettings',ThreadName:'ThreadName',JoinableMode:'JoinableMode',ApprovalMode:'ApprovalMode',ApprovalQueue:'ApprovalQueue',ClientPayload:'ClientPayload',GenieMessage:'GenieMessage',MontageMessage:'MontageMessage',RtcCallData:'RtcCallData'};f.exports=h;}),null);
__d('MercurySyncFakeDFFSender',['Arbiter','ChannelConstants','MercurySingletonProvider','MercurySyncDeltaTypes'],(function a(b,c,d,e,f,g){'use strict';var h=c('ChannelConstants').getArbiterType(c('ChannelConstants').FAKE_DFF);i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};function i(k){this.$MercurySyncFakeDFFSender1=k;}i.prototype.sendGlobalDFF=function(){c('Arbiter').inform(h,{obj:{delta:{'class':c('MercurySyncDeltaTypes').ForcedFetch},queue:this.$MercurySyncFakeDFFSender1}});};i.prototype.sendThreadDFF=function(k,l){c('Arbiter').inform(h,{obj:{delta:{'class':c('MercurySyncDeltaTypes').ForcedFetch,threadKey:{otherUserFbId:k,threadFbId:l}},queue:this.$MercurySyncFakeDFFSender1}});};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MessagingGiftWrapConstants',[],(function a(b,c,d,e,f,g){'use strict';var h='gift_wrap',i='gift_unwrapped',j='valentines2016';f.exports={TAG_PREFIX:h,UNWRAPPED_TAG:i,VALENTINES_GIFT:j};}),null);
__d('MessagingGiftWrapChecker',['MercuryConfig','MercuryTagHelper','MessagingGiftWrapConstants'],(function a(b,c,d,e,f,g){'use strict';var h={shouldRenderWithGiftWrap:function k(l){return !!(c('MercuryConfig').GiftWrapViewerGK&&l.tags&&i(l.tags)&&!j(l.tags));}};function i(k){return c('MercuryTagHelper').get(k,c('MessagingGiftWrapConstants').TAG_PREFIX)===c('MessagingGiftWrapConstants').VALENTINES_GIFT;}function j(k){return !!c('MercuryTagHelper').get(k,c('MessagingGiftWrapConstants').UNWRAPPED_TAG);}f.exports=h;}),null);
__d('MercuryThreads',['invariant','EventEmitter','MercuryDisplayTimeFilterMessageRenderer','ImmutableObject','KeyedCallbackManager','LogHistory','Map','MercuryActionType','MercuryAssert','MercuryAttachment','MercuryConfig','MercuryDispatcher','MercuryGiftSnippetRenderer','MercuryGlobalActionType','MercuryIDs','MercuryLocalIDs','MercuryLoggingHelper','MercuryLogMessageType','MercuryParticipants','MercuryPayloadSource','MercuryServerRequests','MercurySingletonProvider','MercurySyncFakeDFFSender','MercuryThreadInfo','MercuryThreadInformer','MessagingGenericAdminTextType','MessagingGiftWrapChecker','MessagingTag','Set','emptyFunction','ifRequired','requireWeak','setImmediate'],(function a(b,c,d,e,f,g,h){'use strict';var i=new (c('EventEmitter'))(),j=c('LogHistory').getInstance('mercury_threads');function k(m){this.$MercuryThreads1=m;this.$MercuryThreads2=c('MercuryServerRequests').getForFBID(this.$MercuryThreads1);this.$MercuryThreads3=c('MercuryThreadInformer').getForFBID(this.$MercuryThreads1);this.$MercuryThreads4=c('MercuryIDs').getParticipantIDFromUserID(this.$MercuryThreads1);this.$MercuryThreads5=c('MercuryDispatcher').getForFBID(this.$MercuryThreads1);this.$MercuryThreads6=c('MercurySyncFakeDFFSender').getForFBID(this.$MercuryThreads1);this.$MercuryThreads7=false;this.$MercuryThreads8=new (c('KeyedCallbackManager'))();this.$MercuryThreads9=new (c('Set'))();this.$MercuryThreads10=false;this.$MercuryThreads11=new (c('Set'))();this.$MercuryThreads12=new (c('Set'))();this.$MercuryThreads13();}k.getForFBID=function(m){return l.getForFBID(m);};k.get=function(){return l.get();};k.prototype.getThreadMetaNow=function(m){c('MercuryAssert').isThreadID(m);return this.$MercuryThreads8.getResource(m);};k.prototype.getOrFetch=function(m){var n=this.getThreadMetaNow(m);if(!n&&!this.$MercuryThreads12.has(m))this.$MercuryThreads11.add(m);if(this.$MercuryThreads11.size>0&&!this.$MercuryThreads10)this.$MercuryThreads14();return n;};k.prototype.$MercuryThreads14=function(){if(this.$MercuryThreads10)return;this.$MercuryThreads10=true;c('setImmediate')(function(){this.$MercuryThreads10=false;this.$MercuryThreads11.forEach(function(m){return this.$MercuryThreads12.add(m);}.bind(this));this.getMultiThreadMeta(Array.from(this.$MercuryThreads11),function(m){for(var n in m)m.hasOwnProperty(n)&&this.$MercuryThreads12['delete'](n);}.bind(this));this.$MercuryThreads11.clear();}.bind(this));};k.prototype.getThreadMeta=function(m,n,o){return this.getMultiThreadMeta([m],function(p){return n(p[m]);},o);};k.prototype.getMultiThreadMeta=function(m,n,o){c('MercuryAssert').allThreadID(m);var p=this.$MercuryThreads8.executeOrEnqueue(m,n),q=this.$MercuryThreads8.getUnavailableResources(p);if(q.length){var r=[];for(var s=0;s<q.length;s++){var t=q[s],u=c('MercuryIDs').tokenize(t),v=u.type,w=u.value;if(v=='user'){var x=c('MercuryIDs').getParticipantIDFromUserID(w);this.createNewLocalThread(t,x===this.$MercuryThreads4?[this.$MercuryThreads4]:[this.$MercuryThreads4,x]);}r.push(t);}if(r.length)this.$MercuryThreads2.fetchThreadData(r,o);}return p;};k.addListener=function(m,n){return i.addListener(m,n);};k.prototype.unsubscribe=function(m){this.$MercuryThreads8.unsubscribe(m);};k.prototype.getCanonicalThreadToParticipant=function(m,n,o,p){var q=c('MercuryIDs').getThreadIDFromParticipantID(m);!!q||h(0);var r=this.$MercuryThreads8.getResource(q);if(r==undefined){r=this.createNewLocalThread(q,this.$MercuryThreads4===m?[this.$MercuryThreads4]:[this.$MercuryThreads4,m],n);!p&&this.$MercuryThreads2.fetchThreadData([q],o);}return r;};k.prototype.createNewLocalThread=function(m,n,o){var p=this.$MercuryThreads8.getResource(m);if(!p){var q=c('MercuryIDs').tokenize(m),r=q.type,s=q.value;p=new (c('ImmutableObject'))({thread_id:m,participants:Array.from(n),name:'',snippet:'',snippet_sender:null,unread_count:o?o:0,message_count:0,image_src:null,timestamp:null,other_user_fbid:r==='user'?s:null,is_canonical_user:r=='user',is_canonical:this.$MercuryThreads15(n),is_subscribed:true,folder:c('MessagingTag').INBOX,is_archived:false});this.$MercuryThreads8.setResource(m,p);}return p;};k.prototype.createNewLocalThreadGenerateID=function(){var m=c('MercuryLocalIDs').generateThreadID();this.createNewLocalThread(m,[]);return m;};k.prototype.isEmptyLocalThread=function(m){var n=this.$MercuryThreads8.getResource(m);if(!n)return false;return c('MercuryThreadInfo').isEmptyLocalThread(n);};k.prototype.isNewEmptyLocalThread=function(m){var n=this.$MercuryThreads8.getResource(m);if(!n)return false;return c('MercuryThreadInfo').isNewEmptyLocalThread(n);};k.prototype.$MercuryThreads16=function(m,n){if(!m||!m.length)return;var o=new (c('Map'))(),p=new (c('Map'))(),q=new (c('Map'))(),r=[];for(var s=0;s<m.length;s++){var t=m[s];if(t.is_forward)continue;var u=t.action_type;if(u==c('MercuryActionType').LOG_MESSAGE&&t.log_message_type==c('MercuryLogMessageType').SERVER_ERROR)continue;var v=!!(t.sync_id||t.is_from_iris),w=t.thread_id;c('MercuryAssert').isThreadID(w);var x=this.$MercuryThreads8.getResource(w);if(!x&&!v&&u==c('MercuryActionType').USER_GENERATED_MESSAGE){x=this.$MercuryThreads17(t);if(x.participants){this.$MercuryThreads8.setResource(w,x);}else j.debug('missing_local_participants',JSON.stringify(t));}if(!x)continue;if(u==c('MercuryActionType').LOG_MESSAGE||u==c('MercuryActionType').USER_GENERATED_MESSAGE)v=!n;if(x.server_timestamp&&t.timestamp<=x.server_timestamp&&v)continue;if(!q.has(w))q.set(w,babelHelpers['extends']({},x));this.$MercuryThreads18(q.get(w),t,n);var y=o.get(w);if(u==c('MercuryActionType').USER_GENERATED_MESSAGE&&(!y||t.timestamp>y.timestamp))o.set(w,t);if((u==c('MercuryActionType').USER_GENERATED_MESSAGE||u==c('MercuryActionType').LOG_MESSAGE)&&!t.skip_bump_thread)if(t&&t.timestamp&&(!p.has(w)||t.timestamp>p.get(w).timestamp))p.set(w,t);}q.forEach(function(z,aa){var ba=p.get(aa),ca=o.get(aa);if(ca){this.$MercuryThreads19(z,ca);}else if(ba&&ba.log_message_body){var da=babelHelpers['extends']({},ba,{body:ba.log_message_body});this.$MercuryThreads19(z,da);}var ea=z.timestamp;if(ba){if(ba.timestamp>ea)Object.assign(z,{timestamp:ba.timestamp});var fa=z.server_timestamp;if(!n&&ba.timestamp>fa)z.server_timestamp=ba.timestamp;}var ga=new (c('ImmutableObject'))(z);this.$MercuryThreads8.setResource(aa,ga);r.push(c('MercuryLoggingHelper').obfuscateThread(ga));}.bind(this),this);r.length&&this.$MercuryThreads7&&j.debug('threads_updated',JSON.stringify({threads:r}));};k.prototype.$MercuryThreads18=function(m,n,o){var p=n.action_type;if(p==c('MercuryActionType').USER_GENERATED_MESSAGE||p==c('MercuryActionType').LOG_MESSAGE){if(n.is_unread||n.skip_bump_thread)if(!(m.unread_count===0&&n.skip_bump_thread))m.unread_count++;m.message_count++;m.is_archived=false;}switch(p){case c('MercuryActionType').DELETE_THREAD:m.message_count=0;this.$MercuryThreads20(n.thread_id);break;case c('MercuryActionType').USER_GENERATED_MESSAGE:if(m.unread_count===0&&n.author===this.$MercuryThreads4&&n.timestamp>=m.last_read_timestamp)m.last_read_timestamp=n.timestamp;if(n.offline_threading_id!==n.message_id)m.last_message_timestamp=n.timestamp;this.$MercuryThreads21(m,n.author);break;case c('MercuryActionType').SEND_MESSAGE:var q=n.log_message_type;if(q==c('MercuryLogMessageType').THREAD_IMAGE){m.image_src=n.log_message_data.image?n.log_message_data.image.preview_url:null;this.$MercuryThreads22(n.thread_id);}if(q!==c('MercuryLogMessageType').SUBSCRIBE&&q!==c('MercuryLogMessageType').UNSUBSCRIBE)m.snippet_attachments=n.attachments;break;case c('MercuryActionType').LOG_MESSAGE:var q=n.log_message_type;if(q==c('MercuryLogMessageType').SUBSCRIBE){this.$MercuryThreads23(m,n.log_message_data.added_participants);this.$MercuryThreads22(n.thread_id);}else if(q==c('MercuryLogMessageType').UNSUBSCRIBE){this.$MercuryThreads24(m,n.log_message_data.removed_participants);this.$MercuryThreads22(n.thread_id);}else if(q==c('MercuryLogMessageType').THREAD_IMAGE){if(!o)m.image_src=n.log_message_data.image?n.log_message_data.image.preview_url:null;}else if(q==c('MercuryLogMessageType').THREAD_NAME){if(m.name!==n.log_message_data.name)this.$MercuryThreads22(n.thread_id);m.name=n.log_message_data.name;}else if(q===c('MercuryLogMessageType').GENERIC_ADMIN_TEXT)this.$MercuryThreads25(m,n);break;case c('MercuryActionType').CHANGE_READ_STATUS:var r=this.$MercuryThreads26(m,n,n.mark_as_read);if(r)m.last_read_timestamp=m.last_message_timestamp;var s=!m.read_only&&m.folder===c('MessagingTag').INBOX;if(r&&o)this.$MercuryThreads2.changeThreadReadStatus(m.thread_id,n.mark_as_read,n.source,m.last_read_timestamp,m.titan_originated_thread_id,s,m.last_message_type);break;case c('MercuryActionType').CHANGE_ARCHIVED_STATUS:if(m.is_archived!=n.archived){m.is_archived=n.archived;this.$MercuryThreads22(n.thread_id);}break;case c('MercuryActionType').CHANGE_FOLDER:if(m.folder!=n.new_folder){m.folder=n.new_folder;this.$MercuryThreads22(n.thread_id);}break;case c('MercuryActionType').DELETE_MESSAGES:if(o){m.snippet='...';m.snippet_attachments=null;m.snippet_sender=null;this.$MercuryThreads22(n.thread_id);}else if(n.message_ids){m.message_count-=n.message_ids.length;c('ifRequired')('MercuryMessages',function(u){u=u.getForFBID(this.$MercuryThreads1);for(var v=n.message_ids,w=Array.isArray(v),x=0,v=w?v:v[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var y;if(w){if(x>=v.length)break;y=v[x++];}else{x=v.next();if(x.done)break;y=x.value;}var z=y,aa=u.getMessagesFromIDs([z]),ba=aa[0];if(ba&&ba.timestamp>m.last_read_timestamp)m.unread_count=Math.max(0,m.unread_count-1);}this.$MercuryThreads22(n.thread_id);}.bind(this),c('emptyFunction'));}break;case c('MercuryActionType').UPDATE_SNIPPET:c('ifRequired')('MercuryMessages',function(u){u=u.getForFBID(this.$MercuryThreads1);var v=0,w=1,x=u.getThreadMessagesRangeNow(n.thread_id,v,w),y=x[0];if(y){m.snippet=y.body;m.snippet_attachments=y.attachments;m.snippet_sender=y.author;}else{m.snippet='...';m.snippet_attachments=null;m.snippet_sender=null;u.getThreadMessagesRange(n.thread_id,v,w,function(z){if(z.length)this.$MercuryThreads5.handleUpdate({from_client:true,actions:[{thread_id:n.thread_id,action_type:c('MercuryActionType').UPDATE_SNIPPET,deleted_ids:n.deleted_ids}]});}.bind(this));}this.$MercuryThreads22(n.thread_id);}.bind(this),c('emptyFunction'));break;case c('MercuryActionType').CHANGE_MUTE_SETTINGS:if(n.hasOwnProperty('mentions_mute_mode')){m.mentions_mute_mode=n.mentions_mute_mode;}else m.mute_until=!n.mute_until?undefined:n.mute_until;this.$MercuryThreads22(m.thread_id);break;case c('MercuryActionType').ADD_PARTICIPANTS:this.$MercuryThreads23(m,n.participants);this.$MercuryThreads22(m.thread_id);break;case c('MercuryActionType').CHANGE_FLAG:this.$MercuryThreads27(m,n.mark_as_flag);this.$MercuryThreads22(m.thread_id);break;case c('MercuryActionType').UPDATE_PRIORITY:this.$MercuryThreads28(m,n.mark_as_priority);this.$MercuryThreads22(m.thread_id);break;case c('MercuryActionType').MOVE_PENDING_TO_INBOX:this.$MercuryThreads29(m);this.$MercuryThreads22(m.thread_id);break;case c('MercuryActionType').UPDATE_CUSTOM_LIKE:m.custom_like_icon=n.custom_like;this.$MercuryThreads22(m.thread_id);break;case c('MercuryActionType').ADD_GROUP_ADMINS:m.admin_ids=m.admin_ids.concat(n.added_admin_ids.filter(function(u){return m.admin_ids.indexOf(u)===-1;}));this.$MercuryThreads22(n.thread_id);break;case c('MercuryActionType').REMOVE_GROUP_ADMINS:m.admin_ids=m.admin_ids.filter(function(u){return n.removed_admin_ids.indexOf(u)===-1;});this.$MercuryThreads22(n.thread_id);break;case c('MercuryActionType').JOINABLE_MODE:m.joinable_mode=n.joinable_mode;this.$MercuryThreads22(n.thread_id);break;case c('MercuryActionType').APPROVAL_MODE:m.approval_mode=n.approval_mode;this.$MercuryThreads22(n.thread_id);break;case c('MercuryActionType').APPROVAL_QUEUE:if(n.added_id&&m.approval_queue_ids&&m.approval_queue_ids.indexOf(n.added_id)===-1)m.approval_queue_ids=m.approval_queue_ids.concat(n.added_id);if(n.removed_id&&m.approval_queue_ids)m.approval_queue_ids=m.approval_queue_ids.filter(function(u){return n.removed_id!==u;});this.$MercuryThreads22(n.thread_id);break;case c('MercuryActionType').IS_PIN_PROTECTED:m.is_pin_protected=n.is_pin_protected;this.$MercuryThreads22(n.thread_id);break;case c('MercuryActionType').UPDATE_RTC_CALL_DATA:var t=n.initiator_fbid||(m.rtc_call_data?m.rtc_call_data.initiator_fbid:undefined);m.rtc_call_data=new (c('ImmutableObject'))({call_state:n.call_state,server_info_data:n.server_info_data,initiator_fbid:t});this.$MercuryThreads22(n.thread_id);break;}};k.prototype.$MercuryThreads25=function(m,n){var o,p=this;if(n.log_message_data&&n.log_message_data.untypedData)(function(){var q=n.log_message_data.untypedData;switch(n.log_message_data.message_type){case c('MessagingGenericAdminTextType').THREAD_EPHEMERAL_SEND_MODE:var r=parseInt(q.ttl,10);if(r!==null&&m.ephemeral_ttl_mode!==r){m.ephemeral_ttl_mode=r;p.$MercuryThreads22(n.thread_id);}break;case c('MessagingGenericAdminTextType').CHANGE_THREAD_NICKNAME:var s={};for(var t in m.custom_nickname){if(t==q.participant_id&&q.nickname.trim().length==0)continue;s[t]=m.custom_nickname[t];}if(q.nickname.trim().length>0)s[q.participant_id]=q.nickname;m.custom_nickname=s;p.$MercuryThreads22(n.thread_id);break;case c('MessagingGenericAdminTextType').CHANGE_THREAD_ICON:c('requireWeak')('MercuryThreadActions',function(v){v.getForFBID(this.$MercuryThreads1).updateCustomLike(n.thread_id,q.thread_icon);}.bind(p));break;case c('MessagingGenericAdminTextType').CHANGE_THREAD_THEME:var u=q.theme_color;if(u.length>0){m.custom_color='#'.concat(u.substring(2));}else m.custom_color=null;p.$MercuryThreads22(n.thread_id);break;}})();};k.prototype.$MercuryThreads17=function(m){var n=c('MercuryIDs').tokenize(m.thread_id),o=n.type,p=n.value,q=m.specific_to_list&&this.$MercuryThreads15(m.specific_to_list);return new (c('ImmutableObject'))({thread_id:m.thread_id,participants:m.specific_to_list,name:null,snippet:m.body,snippet_attachments:[],snippet_sender:m.author,unread_count:0,message_count:0,image_src:null,timestamp:m.timestamp,other_user_fbid:o==='user'?p:null,is_canonical_user:o==='user',is_canonical:q,is_subscribed:true,folder:c('MessagingTag').INBOX,is_archived:false});};k.prototype.$MercuryThreads26=function(m,n,o){if(n.timestamp)this.$MercuryThreads30(m.thread_id,o,n.timestamp);if(!m||!m.thread_id)return false;if(!m.timestamp){this.$MercuryThreads9.add(m.thread_id);return false;}var p=!m.unread_count;if(o==p)return false;m.unread_count=o?0:1;this.$MercuryThreads22(m.thread_id);return true;};k.prototype.$MercuryThreads31=function(m){var n=this.$MercuryThreads8.getAllResources();for(var o in n)if(n.hasOwnProperty(o)){var p=n[o];if(p.folder==m){this.$MercuryThreads8.setResource(o,c('ImmutableObject').setProperty(p,'unread_count',0));this.$MercuryThreads22(o);}}};k.prototype.$MercuryThreads23=function(m,n){var o=new (c('Set'))(m.participants);m.participants=Array.from(m.participants);n.forEach(function(p){if(!o.has(p)){m.participants.push(p);if(p===this.$MercuryThreads4){m.is_subscribed=true;m.can_reply=true;m.cannot_reply_reason=null;this.$MercuryThreads6.sendThreadDFF(undefined,m.thread_fbid);}}}.bind(this));};k.prototype.$MercuryThreads24=function(m,n){var o=new (c('Set'))(n);m.participants=m.participants.filter(function(p){return !o.has(p);});m.admin_ids=m.admin_ids.filter(function(p){return !o.has(p);});if(o.has(this.$MercuryThreads4))m.is_subscribed=false;this.$MercuryThreads2.fetchThreadData([m.thread_id]);};k.prototype.$MercuryThreads21=function(m,n){if(!m.participants){var o=JSON.stringify({thread_info:m,participant:n});j.debug('missing_participants',o);return;}var p=m.participants.indexOf(n);if(p>0)m.participants=[n].concat(m.participants.slice(0,p),m.participants.slice(p+1));};k.prototype.$MercuryThreads19=function(m,n){var o=n.body,p=n.subject,q='';if(p){p=p.toLowerCase();if(o.slice(0,p.length).toLowerCase()==p){q=o;}else if(o){q=p+' \u00B7 '+o;}else q=p;}else q=o;if(n.is_filtered_content)q=c('MercuryDisplayTimeFilterMessageRenderer').renderFilteredContent(n);if(c('MessagingGiftWrapChecker').shouldRenderWithGiftWrap(n)){var r=n.author,s=r==this.$MercuryThreads4,t=null;if(!s){t=m.custom_nickname&&m.custom_nickname[c('MercuryIDs').getUserIDFromParticipantID(r)];if(!t){var u=c('MercuryParticipants').getNow(r);if(u!=null)t=u.short_name;}}q=c('MercuryGiftSnippetRenderer').renderText(s,t);}m.snippet=q;if(n.raw_attachments&&n.raw_attachments.length>0){var v=c('MercuryAttachment').convertRaw(n.raw_attachments);m.snippet_attachments=v;}else m.snippet_attachments=n.attachments;if(n.log_message_type){m.snippet_sender=null;}else m.snippet_sender=n.author;};k.prototype.$MercuryThreads27=function(m,n){m.page_thread_info=babelHelpers['extends']({},m.page_thread_info,{flagged:n});};k.prototype.$MercuryThreads28=function(m,n){m.page_thread_info=babelHelpers['extends']({},m.page_thread_info,{is_priority:n});};k.prototype.$MercuryThreads29=function(m){if(m.folder!==c('MessagingTag').PENDING)return;m.folder=c('MessagingTag').INBOX;};k.prototype.$MercuryThreads15=function(m){return m.filter(function(n){return n!=this.$MercuryThreads4;}.bind(this)).length<=1;};k.prototype.$MercuryThreads13=function(){this.$MercuryThreads5.subscribe('invalidate-thread-state',function(m,n){return this.$MercuryThreads32(n);}.bind(this));this.$MercuryThreads5.subscribe('invalidate-global-state',function(m,n){return this.$MercuryThreads33();}.bind(this));this.$MercuryThreads5.subscribe('update-threads',function(m,n){var o=(n.actions||[]).filter(function(p){return p.thread_id;});if(n.threads&&n.payload_source==c('MercuryPayloadSource').SERVER_FETCH_THREAD_INFO)n.threads.forEach(function(p){var q=p.thread_id;if(this.$MercuryThreads9.has(q)){this.$MercuryThreads9['delete'](q);if(p.unread_count)this.$MercuryThreads2.changeThreadReadStatus(p.thread_id,true);}}.bind(this));this.$MercuryThreads34(n.threads);this.$MercuryThreads16(o,n.from_client);n.threads&&n.threads.forEach(function(p){this.$MercuryThreads22(p.thread_id);}.bind(this));if(n.global_actions)n.global_actions.forEach(function(p){if(p.action_type==c('MercuryGlobalActionType').MARK_ALL_READ)this.$MercuryThreads31(p.folder);}.bind(this));if(this.$MercuryThreads7){this.$MercuryThreads7=false;i.emit('change');}}.bind(this));};k.prototype.$MercuryThreads34=function(m){if(!m||!m.length)return;var n={},o=[];m.forEach(function(p){var q=new (c('ImmutableObject'))(p);n[p.thread_id]=q;o.push(c('MercuryLoggingHelper').obfuscateThread(q));});o.length&&j.debug('threads_added',JSON.stringify({threads:o}));this.$MercuryThreads8.addResourcesAndExecute(n);};k.prototype.$MercuryThreads22=function(m){this.$MercuryThreads7=true;this.$MercuryThreads3.updatedThread(m);};k.prototype.$MercuryThreads20=function(m){this.$MercuryThreads7=true;this.$MercuryThreads3.deletedThread(m);};k.prototype.$MercuryThreads30=function(m,n,o){this.$MercuryThreads7=true;this.$MercuryThreads3.changedThreadReadState(m,n,o);};k.prototype.$MercuryThreads32=function(m){this.$MercuryThreads8.setResource(m,undefined);};k.prototype.$MercuryThreads33=function(){this.$MercuryThreads7=false;this.$MercuryThreads8=new (c('KeyedCallbackManager'))();this.$MercuryThreads9=new (c('Set'))();this.$MercuryThreads10=false;this.$MercuryThreads11=new (c('Set'))();this.$MercuryThreads12=new (c('Set'))();};var l=new (c('MercurySingletonProvider'))(k);f.exports=k;}),null);